var os=Object.defineProperty;var re=a=>{throw TypeError(a)};var ns=(a,p,m)=>p in a?os(a,p,{enumerable:!0,configurable:!0,writable:!0,value:m}):a[p]=m;var oe=(a,p,m)=>ns(a,typeof p!="symbol"?p+"":p,m),_t=(a,p,m)=>p.has(a)||re("Cannot "+m);var ht=(a,p,m)=>(_t(a,p,"read from private field"),m?m.call(a):p.get(a)),Bt=(a,p,m)=>p.has(a)?re("Cannot add the same private member more than once"):p instanceof WeakSet?p.add(a):p.set(a,m),Ot=(a,p,m,d)=>(_t(a,p,"write to private field"),d?d.call(a,m):p.set(a,m),m),Wt=(a,p,m)=>(_t(a,p,"access private method"),m);import{j as F,u as Rt,n as is,L as Ct,r as ut,I as ls,a as hs,N as Qt}from"./index-D61AWjnF.js";function us(a){return a&&a.__esModule&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a}function fe(a){if(Object.prototype.hasOwnProperty.call(a,"__esModule"))return a;var p=a.default;if(typeof p=="function"){var m=function d(){return this instanceof d?Reflect.construct(p,arguments,this.constructor):p.apply(this,arguments)};m.prototype=p.prototype}else m={};return Object.defineProperty(m,"__esModule",{value:!0}),Object.keys(a).forEach(function(d){var M=Object.getOwnPropertyDescriptor(a,d);Object.defineProperty(m,d,M.get?M:{enumerable:!0,get:function(){return a[d]}})}),m}function It({icon:a,children:p,onClick:m,className:d,disabled:M}){return F.jsxs("button",{className:`flex items-center gap-2 p-[1rem] w-fit cursor-pointer disabled:bg-gray-300 disabled:text-gray-500 ${d}`,onClick:m,disabled:M,children:[F.jsx("img",{src:a,alt:"icon"}),p]})}function pt({children:a,className:p,style:m}){return F.jsx("p",{style:m,className:`font-[Poppins] text-white font-semibold ${p}`,children:a})}const fs="data:image/svg+xml,%3csvg%20width='24'%20height='25'%20viewBox='0%200%2024%2025'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cg%20id='menu_24px'%3e%3cpath%20id='icon/navigation/menu_24px'%20fill-rule='evenodd'%20clip-rule='evenodd'%20d='M4%208.10925C3.45%208.10925%203%207.65925%203%207.10925C3%206.55925%203.45%206.10925%204%206.10925H20C20.55%206.10925%2021%206.55925%2021%207.10925C21%207.65925%2020.55%208.10925%2020%208.10925H4ZM4%2013.1093H20C20.55%2013.1093%2021%2012.6593%2021%2012.1093C21%2011.5593%2020.55%2011.1093%2020%2011.1093H4C3.45%2011.1093%203%2011.5593%203%2012.1093C3%2012.6593%203.45%2013.1093%204%2013.1093ZM4%2018.1093H20C20.55%2018.1093%2021%2017.6593%2021%2017.1093C21%2016.5593%2020.55%2016.1093%2020%2016.1093H4C3.45%2016.1093%203%2016.5593%203%2017.1093C3%2017.6593%203.45%2018.1093%204%2018.1093Z'%20fill='black'%20fill-opacity='0.54'/%3e%3c/g%3e%3c/svg%3e";function cs(){const{isExpanded:a,onChangeAction:p}=Rt(),m="shrink-0 h-full w-[80%] overflow-hidden relative",d=a?m+" left-0":m+" left-[-100%]";return F.jsx("div",{className:d,children:F.jsx("ul",{className:"h-full flex flex-col justify-center [&>li>button]:px-[2rem]",children:is.map(M=>F.jsx("li",{children:F.jsx(It,{icon:M.icon,onClick:()=>p(M.action),children:F.jsx(pt,{children:M.text})})}))})})}function as({children:a}){const{isExpanded:p,onExpand:m}=Rt(),d="shrink-0 h-full w-full overflow-hidden absolute top-0",M=p?d+" left-[80%]":d+" left-0";return F.jsx("div",{className:M,children:F.jsxs("div",{className:`flex flex-col overflow-auto bg-white h-full w-full shadow-xl rounded-2xl ${p?"scale-80 opacity-90":""}`,children:[F.jsxs("nav",{className:"sticky h-[4rem] w-full flex items-center justify-between px-[0.8rem] z-2",children:[F.jsx(It,{icon:fs,onClick:m}),F.jsx(Ct,{className:"justify-self-center [&>path]:fill-purple-600",isFull:!0}),F.jsx("div",{className:"w-[3.5rem]"})]}),F.jsx("div",{className:"flex-grow w-full overflow-auto p-[0.625rem]",children:a})]})})}function gs({children:a}){const{isExpanded:p}=Rt();return F.jsx("div",{className:"flex items-center justify-center w-[100vw] h-[100vh]",children:F.jsx("div",{className:`flex w-[100vw] h-[100vh] relative overflow-hidden md:w-[20rem] md:h-[35.5rem] md:rounded-3xl bg-gradient-to-br ${p?" from-fuchsia-600 via-violet-600 to-purple-600 !transition-none":" from-fuchsia-50 to-fuchsia-50 !transition !delay-[0.3s]"}`,children:a})})}const ce=ut.createContext(void 0);function ms({children:a}){const[p,m]=ut.useState(null),[d,M]=ut.useState(null),[q,T]=ut.useState(!1),[I,z]=ut.useState(!1),[U,G]=ut.useState(null),[Q,st]=ut.useState(null),W=ut.useRef(null),ft=()=>{m(null),M(null),T(!1),z(!1),G(null),st(null)};return F.jsx(ce.Provider,{value:{image:p,setImage:m,preview:d,setPreview:M,loading:q,setLoading:T,isGenerating:I,setIsGenerating:z,palette:U,setPalette:G,selectedHex:Q,setSelectedHex:st,setInitialState:ft,fileInputRef:W},children:F.jsxs("div",{className:"w-full h-full flex flex-col gap-10 items-center justify-center",children:[a,I&&F.jsx(Ct,{className:"h-10 w-10 animate-spin [&>path]:fill-purple-500"})]})})}function Vt(){const a=ut.useContext(ce);if(!a)throw new Error("useGenerate must be used within the Generate Provider");return a}function ws(){const{fileInputRef:a,setLoading:p,setImage:m,setPalette:d,setPreview:M}=Vt(),q=T=>{var z;const I=(z=T.target.files)==null?void 0:z[0];if(I&&I.type.startsWith("image/")){p(!0),m(I),d(null),setTimeout(()=>{M(URL.createObjectURL(I)),p(!1)},500);return}alert("Please select a valid image file.")};return F.jsx("input",{type:"file",accept:"image/*",ref:a,onChange:q,className:"hidden"})}function ps(){const{isGenerating:a,palette:p,image:m,preview:d,loading:M}=Vt();return!a&&!p&&m?F.jsx("div",{className:"h-[18rem] w-[18rem] bg-violet-400 rounded-2xl p-[0.625rem] flex items-center justify-center",children:!M&&d?F.jsx("img",{className:"w-full h-full object-contain rounded-lg",src:d,alt:"image to process"}):F.jsx(Ct,{className:"h-5 w-5 animate-spin"})}):null}function ds(){const{palette:a,selectedHex:p,setSelectedHex:m}=Vt();return a?F.jsxs(F.Fragment,{children:[F.jsx(Ct,{className:"mb-10 [&>path]:cursor-pointer",colorPaths:a,onClickHex:d=>m(d||null)}),F.jsxs("div",{className:"flex items-center justify-center gap-2",children:[F.jsx("div",{style:{backgroundColor:p||"transparent"},className:"h-5 w-5 rounded-full"}),F.jsx(pt,{style:{color:p||"transparent"},children:p})]})]}):null}const ys="data:image/svg+xml,%3csvg%20width='24'%20height='25'%20viewBox='0%200%2024%2025'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cg%20id='upload_24px'%3e%3cpath%20id='icon/file/upload_24px'%20fill-rule='evenodd'%20clip-rule='evenodd'%20d='M14%2016.5147H10C9.45%2016.5147%209%2016.0647%209%2015.5147V10.5147H7.41C6.52%2010.5147%206.08%209.43473%206.71%208.80473L11.3%204.21473C11.4868%204.02747%2011.7405%203.92224%2012.005%203.92224C12.2695%203.92224%2012.5232%204.02747%2012.71%204.21473L17.3%208.80473C17.93%209.43473%2017.48%2010.5147%2016.59%2010.5147H15V15.5147C15%2016.0647%2014.55%2016.5147%2014%2016.5147ZM18%2018.5147H6C5.45%2018.5147%205%2018.9647%205%2019.5147C5%2020.0647%205.45%2020.5147%206%2020.5147H18C18.55%2020.5147%2019%2020.0647%2019%2019.5147C19%2018.9647%2018.55%2018.5147%2018%2018.5147Z'%20fill='black'%20fill-opacity='0.54'/%3e%3c/g%3e%3c/svg%3e";function Ut(a,p){let m=0;for(let d=0;d<a.length;d++)m+=(a[d]-p[d])*(a[d]-p[d]);return m}const Jt={distanceFunction:Ut};function js(a,p,m=Jt){const d=m.distanceFunction||Jt.distanceFunction,M=m.similarityFunction||Jt.similarityFunction;let q=-1;if(typeof M=="function"){let T=Number.MIN_VALUE;for(let I=0;I<a.length;I++){const z=M(p,a[I]);z>T&&(T=z,q=I)}}else if(typeof d=="function"){let T=Number.MAX_VALUE;for(let I=0;I<a.length;I++){const z=d(p,a[I]);z<T&&(T=z,q=I)}}else throw new Error("A similarity or distance function it's required");return q}function bs(a,p){let m=new Array(a.length);for(let d=0;d<a.length;++d)for(let M=d;M<a.length;++M){m[d]||(m[d]=new Array(a.length)),m[M]||(m[M]=new Array(a.length));const q=p(a[d],a[M]);m[d][M]=q,m[M][d]=q}return m}function ae(a,p,m,d){for(let M=0;M<a.length;M++)m[M]=js(p,a[M],{distanceFunction:d});return m}function Ss(a,p,m,d){const M=p[0].length;let q=new Array(d),T=new Array(d);for(let I=0;I<d;I++){q[I]=new Array(M),T[I]=0;for(let z=0;z<M;z++)q[I][z]=0}for(let I=0;I<p.length;I++){T[m[I]]++;for(let z=0;z<M;z++)q[m[I]][z]+=p[I][z]}for(let I=0;I<d;I++)for(let z=0;z<M;z++)T[I]?q[I][z]/=T[I]:q[I][z]=a[I][z];return q}function Ms(a,p,m,d){for(let M=0;M<a.length;M++)if(m(a[M],p[M])>d)return!1;return!0}class Es{constructor(p,m,d,M,q){this.clusters=p,this.centroids=m,this.converged=d,this.iterations=M,this.distance=q}nearest(p){const m=new Array(p.length);return ae(p,this.centroids,m,this.distance)}computeInformation(p){let m=this.centroids.map(d=>({centroid:d,error:0,size:0}));for(let d=0;d<p.length;d++)m[this.clusters[d]].error+=this.distance(p[d],this.centroids[this.clusters[d]]),m[this.clusters[d]].size++;for(let d=0;d<this.centroids.length;d++){let M=m[d].error;m[d].size&&M!==-1?M/=m[d].size:m[d].error=-1}return m}}function vs(a,p){throw new Error(`${p}: "${String(a)}"`)}function ks(a,p){if(p>a.length||!Number.isInteger(p))throw new Error("K should be a positive integer smaller than the number of points")}var V={};const Is=Object.prototype.toString;function Nt(a){const p=Is.call(a);return p.endsWith("Array]")&&!p.includes("Big")}const Ns=Object.freeze(Object.defineProperty({__proto__:null,isAnyArray:Nt},Symbol.toStringTag,{value:"Module"})),Rs=fe(Ns);function Cs(a){var p=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!Nt(a))throw new TypeError("input must be an array");if(a.length===0)throw new TypeError("input must not be empty");var m=p.fromIndex,d=m===void 0?0:m,M=p.toIndex,q=M===void 0?a.length:M;if(d<0||d>=a.length||!Number.isInteger(d))throw new Error("fromIndex must be a positive integer smaller than length");if(q<=d||q>a.length||!Number.isInteger(q))throw new Error("toIndex must be an integer greater than fromIndex and at most equal to length");for(var T=a[d],I=d+1;I<q;I++)a[I]>T&&(T=a[I]);return T}function xs(a){var p=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!Nt(a))throw new TypeError("input must be an array");if(a.length===0)throw new TypeError("input must not be empty");var m=p.fromIndex,d=m===void 0?0:m,M=p.toIndex,q=M===void 0?a.length:M;if(d<0||d>=a.length||!Number.isInteger(d))throw new Error("fromIndex must be a positive integer smaller than length");if(q<=d||q>a.length||!Number.isInteger(q))throw new Error("toIndex must be an integer greater than fromIndex and at most equal to length");for(var T=a[d],I=d+1;I<q;I++)a[I]<T&&(T=a[I]);return T}function Ts(a){var p=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(Nt(a)){if(a.length===0)throw new TypeError("input must not be empty")}else throw new TypeError("input must be an array");var m;if(p.output!==void 0){if(!Nt(p.output))throw new TypeError("output option must be an array if specified");m=p.output}else m=new Array(a.length);var d=xs(a),M=Cs(a);if(d===M)throw new RangeError("minimum and maximum input values are equal. Cannot rescale a constant array");var q=p.min,T=q===void 0?p.autoMinMax?d:0:q,I=p.max,z=I===void 0?p.autoMinMax?M:1:I;if(T>=z)throw new RangeError("min option must be smaller than max option");for(var U=(z-T)/(M-d),G=0;G<a.length;G++)m[G]=(a[G]-d)*U+T;return m}const qs=Object.freeze(Object.defineProperty({__proto__:null,default:Ts},Symbol.toStringTag,{value:"Module"})),Ps=fe(qs);var ne;function Fs(){var kt,Yt,rt;if(ne)return V;ne=1,Object.defineProperty(V,"__esModule",{value:!0});var a=Rs,p=Ps;const m=" ".repeat(2),d=" ".repeat(4);function M(){return q(this)}function q(n,r={}){const{maxRows:e=15,maxColumns:t=10,maxNumSize:s=8,padMinus:o="auto"}=r;return`${n.constructor.name} {
${m}[
${d}${T(n,e,t,s,o)}
${m}]
${m}rows: ${n.rows}
${m}columns: ${n.columns}
}`}function T(n,r,e,t,s){const{rows:o,columns:i}=n,l=Math.min(o,r),h=Math.min(i,e),u=[];if(s==="auto"){s=!1;t:for(let w=0;w<l;w++)for(let f=0;f<h;f++)if(n.get(w,f)<0){s=!0;break t}}for(let w=0;w<l;w++){let f=[];for(let j=0;j<h;j++)f.push(I(n.get(w,j),t,s));u.push(`${f.join(" ")}`)}return h!==i&&(u[u.length-1]+=` ... ${i-e} more columns`),l!==o&&u.push(`... ${o-r} more rows`),u.join(`
${d}`)}function I(n,r,e){return(n>=0&&e?` ${z(n,r-1)}`:z(n,r)).padEnd(r)}function z(n,r){let e=n.toString();if(e.length<=r)return e;let t=n.toFixed(r);if(t.length>r&&(t=n.toFixed(Math.max(0,r-(t.length-r)))),t.length<=r&&!t.startsWith("0.000")&&!t.startsWith("-0.000"))return t;let s=n.toExponential(r);return s.length>r&&(s=n.toExponential(Math.max(0,r-(s.length-r)))),s.slice(0)}function U(n,r){n.prototype.add=function(t){return typeof t=="number"?this.addS(t):this.addM(t)},n.prototype.addS=function(t){for(let s=0;s<this.rows;s++)for(let o=0;o<this.columns;o++)this.set(s,o,this.get(s,o)+t);return this},n.prototype.addM=function(t){if(t=r.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let s=0;s<this.rows;s++)for(let o=0;o<this.columns;o++)this.set(s,o,this.get(s,o)+t.get(s,o));return this},n.add=function(t,s){return new r(t).add(s)},n.prototype.sub=function(t){return typeof t=="number"?this.subS(t):this.subM(t)},n.prototype.subS=function(t){for(let s=0;s<this.rows;s++)for(let o=0;o<this.columns;o++)this.set(s,o,this.get(s,o)-t);return this},n.prototype.subM=function(t){if(t=r.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let s=0;s<this.rows;s++)for(let o=0;o<this.columns;o++)this.set(s,o,this.get(s,o)-t.get(s,o));return this},n.sub=function(t,s){return new r(t).sub(s)},n.prototype.subtract=n.prototype.sub,n.prototype.subtractS=n.prototype.subS,n.prototype.subtractM=n.prototype.subM,n.subtract=n.sub,n.prototype.mul=function(t){return typeof t=="number"?this.mulS(t):this.mulM(t)},n.prototype.mulS=function(t){for(let s=0;s<this.rows;s++)for(let o=0;o<this.columns;o++)this.set(s,o,this.get(s,o)*t);return this},n.prototype.mulM=function(t){if(t=r.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let s=0;s<this.rows;s++)for(let o=0;o<this.columns;o++)this.set(s,o,this.get(s,o)*t.get(s,o));return this},n.mul=function(t,s){return new r(t).mul(s)},n.prototype.multiply=n.prototype.mul,n.prototype.multiplyS=n.prototype.mulS,n.prototype.multiplyM=n.prototype.mulM,n.multiply=n.mul,n.prototype.div=function(t){return typeof t=="number"?this.divS(t):this.divM(t)},n.prototype.divS=function(t){for(let s=0;s<this.rows;s++)for(let o=0;o<this.columns;o++)this.set(s,o,this.get(s,o)/t);return this},n.prototype.divM=function(t){if(t=r.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let s=0;s<this.rows;s++)for(let o=0;o<this.columns;o++)this.set(s,o,this.get(s,o)/t.get(s,o));return this},n.div=function(t,s){return new r(t).div(s)},n.prototype.divide=n.prototype.div,n.prototype.divideS=n.prototype.divS,n.prototype.divideM=n.prototype.divM,n.divide=n.div,n.prototype.mod=function(t){return typeof t=="number"?this.modS(t):this.modM(t)},n.prototype.modS=function(t){for(let s=0;s<this.rows;s++)for(let o=0;o<this.columns;o++)this.set(s,o,this.get(s,o)%t);return this},n.prototype.modM=function(t){if(t=r.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let s=0;s<this.rows;s++)for(let o=0;o<this.columns;o++)this.set(s,o,this.get(s,o)%t.get(s,o));return this},n.mod=function(t,s){return new r(t).mod(s)},n.prototype.modulus=n.prototype.mod,n.prototype.modulusS=n.prototype.modS,n.prototype.modulusM=n.prototype.modM,n.modulus=n.mod,n.prototype.and=function(t){return typeof t=="number"?this.andS(t):this.andM(t)},n.prototype.andS=function(t){for(let s=0;s<this.rows;s++)for(let o=0;o<this.columns;o++)this.set(s,o,this.get(s,o)&t);return this},n.prototype.andM=function(t){if(t=r.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let s=0;s<this.rows;s++)for(let o=0;o<this.columns;o++)this.set(s,o,this.get(s,o)&t.get(s,o));return this},n.and=function(t,s){return new r(t).and(s)},n.prototype.or=function(t){return typeof t=="number"?this.orS(t):this.orM(t)},n.prototype.orS=function(t){for(let s=0;s<this.rows;s++)for(let o=0;o<this.columns;o++)this.set(s,o,this.get(s,o)|t);return this},n.prototype.orM=function(t){if(t=r.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let s=0;s<this.rows;s++)for(let o=0;o<this.columns;o++)this.set(s,o,this.get(s,o)|t.get(s,o));return this},n.or=function(t,s){return new r(t).or(s)},n.prototype.xor=function(t){return typeof t=="number"?this.xorS(t):this.xorM(t)},n.prototype.xorS=function(t){for(let s=0;s<this.rows;s++)for(let o=0;o<this.columns;o++)this.set(s,o,this.get(s,o)^t);return this},n.prototype.xorM=function(t){if(t=r.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let s=0;s<this.rows;s++)for(let o=0;o<this.columns;o++)this.set(s,o,this.get(s,o)^t.get(s,o));return this},n.xor=function(t,s){return new r(t).xor(s)},n.prototype.leftShift=function(t){return typeof t=="number"?this.leftShiftS(t):this.leftShiftM(t)},n.prototype.leftShiftS=function(t){for(let s=0;s<this.rows;s++)for(let o=0;o<this.columns;o++)this.set(s,o,this.get(s,o)<<t);return this},n.prototype.leftShiftM=function(t){if(t=r.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let s=0;s<this.rows;s++)for(let o=0;o<this.columns;o++)this.set(s,o,this.get(s,o)<<t.get(s,o));return this},n.leftShift=function(t,s){return new r(t).leftShift(s)},n.prototype.signPropagatingRightShift=function(t){return typeof t=="number"?this.signPropagatingRightShiftS(t):this.signPropagatingRightShiftM(t)},n.prototype.signPropagatingRightShiftS=function(t){for(let s=0;s<this.rows;s++)for(let o=0;o<this.columns;o++)this.set(s,o,this.get(s,o)>>t);return this},n.prototype.signPropagatingRightShiftM=function(t){if(t=r.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let s=0;s<this.rows;s++)for(let o=0;o<this.columns;o++)this.set(s,o,this.get(s,o)>>t.get(s,o));return this},n.signPropagatingRightShift=function(t,s){return new r(t).signPropagatingRightShift(s)},n.prototype.rightShift=function(t){return typeof t=="number"?this.rightShiftS(t):this.rightShiftM(t)},n.prototype.rightShiftS=function(t){for(let s=0;s<this.rows;s++)for(let o=0;o<this.columns;o++)this.set(s,o,this.get(s,o)>>>t);return this},n.prototype.rightShiftM=function(t){if(t=r.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let s=0;s<this.rows;s++)for(let o=0;o<this.columns;o++)this.set(s,o,this.get(s,o)>>>t.get(s,o));return this},n.rightShift=function(t,s){return new r(t).rightShift(s)},n.prototype.zeroFillRightShift=n.prototype.rightShift,n.prototype.zeroFillRightShiftS=n.prototype.rightShiftS,n.prototype.zeroFillRightShiftM=n.prototype.rightShiftM,n.zeroFillRightShift=n.rightShift,n.prototype.not=function(){for(let t=0;t<this.rows;t++)for(let s=0;s<this.columns;s++)this.set(t,s,~this.get(t,s));return this},n.not=function(t){return new r(t).not()},n.prototype.abs=function(){for(let t=0;t<this.rows;t++)for(let s=0;s<this.columns;s++)this.set(t,s,Math.abs(this.get(t,s)));return this},n.abs=function(t){return new r(t).abs()},n.prototype.acos=function(){for(let t=0;t<this.rows;t++)for(let s=0;s<this.columns;s++)this.set(t,s,Math.acos(this.get(t,s)));return this},n.acos=function(t){return new r(t).acos()},n.prototype.acosh=function(){for(let t=0;t<this.rows;t++)for(let s=0;s<this.columns;s++)this.set(t,s,Math.acosh(this.get(t,s)));return this},n.acosh=function(t){return new r(t).acosh()},n.prototype.asin=function(){for(let t=0;t<this.rows;t++)for(let s=0;s<this.columns;s++)this.set(t,s,Math.asin(this.get(t,s)));return this},n.asin=function(t){return new r(t).asin()},n.prototype.asinh=function(){for(let t=0;t<this.rows;t++)for(let s=0;s<this.columns;s++)this.set(t,s,Math.asinh(this.get(t,s)));return this},n.asinh=function(t){return new r(t).asinh()},n.prototype.atan=function(){for(let t=0;t<this.rows;t++)for(let s=0;s<this.columns;s++)this.set(t,s,Math.atan(this.get(t,s)));return this},n.atan=function(t){return new r(t).atan()},n.prototype.atanh=function(){for(let t=0;t<this.rows;t++)for(let s=0;s<this.columns;s++)this.set(t,s,Math.atanh(this.get(t,s)));return this},n.atanh=function(t){return new r(t).atanh()},n.prototype.cbrt=function(){for(let t=0;t<this.rows;t++)for(let s=0;s<this.columns;s++)this.set(t,s,Math.cbrt(this.get(t,s)));return this},n.cbrt=function(t){return new r(t).cbrt()},n.prototype.ceil=function(){for(let t=0;t<this.rows;t++)for(let s=0;s<this.columns;s++)this.set(t,s,Math.ceil(this.get(t,s)));return this},n.ceil=function(t){return new r(t).ceil()},n.prototype.clz32=function(){for(let t=0;t<this.rows;t++)for(let s=0;s<this.columns;s++)this.set(t,s,Math.clz32(this.get(t,s)));return this},n.clz32=function(t){return new r(t).clz32()},n.prototype.cos=function(){for(let t=0;t<this.rows;t++)for(let s=0;s<this.columns;s++)this.set(t,s,Math.cos(this.get(t,s)));return this},n.cos=function(t){return new r(t).cos()},n.prototype.cosh=function(){for(let t=0;t<this.rows;t++)for(let s=0;s<this.columns;s++)this.set(t,s,Math.cosh(this.get(t,s)));return this},n.cosh=function(t){return new r(t).cosh()},n.prototype.exp=function(){for(let t=0;t<this.rows;t++)for(let s=0;s<this.columns;s++)this.set(t,s,Math.exp(this.get(t,s)));return this},n.exp=function(t){return new r(t).exp()},n.prototype.expm1=function(){for(let t=0;t<this.rows;t++)for(let s=0;s<this.columns;s++)this.set(t,s,Math.expm1(this.get(t,s)));return this},n.expm1=function(t){return new r(t).expm1()},n.prototype.floor=function(){for(let t=0;t<this.rows;t++)for(let s=0;s<this.columns;s++)this.set(t,s,Math.floor(this.get(t,s)));return this},n.floor=function(t){return new r(t).floor()},n.prototype.fround=function(){for(let t=0;t<this.rows;t++)for(let s=0;s<this.columns;s++)this.set(t,s,Math.fround(this.get(t,s)));return this},n.fround=function(t){return new r(t).fround()},n.prototype.log=function(){for(let t=0;t<this.rows;t++)for(let s=0;s<this.columns;s++)this.set(t,s,Math.log(this.get(t,s)));return this},n.log=function(t){return new r(t).log()},n.prototype.log1p=function(){for(let t=0;t<this.rows;t++)for(let s=0;s<this.columns;s++)this.set(t,s,Math.log1p(this.get(t,s)));return this},n.log1p=function(t){return new r(t).log1p()},n.prototype.log10=function(){for(let t=0;t<this.rows;t++)for(let s=0;s<this.columns;s++)this.set(t,s,Math.log10(this.get(t,s)));return this},n.log10=function(t){return new r(t).log10()},n.prototype.log2=function(){for(let t=0;t<this.rows;t++)for(let s=0;s<this.columns;s++)this.set(t,s,Math.log2(this.get(t,s)));return this},n.log2=function(t){return new r(t).log2()},n.prototype.round=function(){for(let t=0;t<this.rows;t++)for(let s=0;s<this.columns;s++)this.set(t,s,Math.round(this.get(t,s)));return this},n.round=function(t){return new r(t).round()},n.prototype.sign=function(){for(let t=0;t<this.rows;t++)for(let s=0;s<this.columns;s++)this.set(t,s,Math.sign(this.get(t,s)));return this},n.sign=function(t){return new r(t).sign()},n.prototype.sin=function(){for(let t=0;t<this.rows;t++)for(let s=0;s<this.columns;s++)this.set(t,s,Math.sin(this.get(t,s)));return this},n.sin=function(t){return new r(t).sin()},n.prototype.sinh=function(){for(let t=0;t<this.rows;t++)for(let s=0;s<this.columns;s++)this.set(t,s,Math.sinh(this.get(t,s)));return this},n.sinh=function(t){return new r(t).sinh()},n.prototype.sqrt=function(){for(let t=0;t<this.rows;t++)for(let s=0;s<this.columns;s++)this.set(t,s,Math.sqrt(this.get(t,s)));return this},n.sqrt=function(t){return new r(t).sqrt()},n.prototype.tan=function(){for(let t=0;t<this.rows;t++)for(let s=0;s<this.columns;s++)this.set(t,s,Math.tan(this.get(t,s)));return this},n.tan=function(t){return new r(t).tan()},n.prototype.tanh=function(){for(let t=0;t<this.rows;t++)for(let s=0;s<this.columns;s++)this.set(t,s,Math.tanh(this.get(t,s)));return this},n.tanh=function(t){return new r(t).tanh()},n.prototype.trunc=function(){for(let t=0;t<this.rows;t++)for(let s=0;s<this.columns;s++)this.set(t,s,Math.trunc(this.get(t,s)));return this},n.trunc=function(t){return new r(t).trunc()},n.pow=function(t,s){return new r(t).pow(s)},n.prototype.pow=function(t){return typeof t=="number"?this.powS(t):this.powM(t)},n.prototype.powS=function(t){for(let s=0;s<this.rows;s++)for(let o=0;o<this.columns;o++)this.set(s,o,this.get(s,o)**t);return this},n.prototype.powM=function(t){if(t=r.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let s=0;s<this.rows;s++)for(let o=0;o<this.columns;o++)this.set(s,o,this.get(s,o)**t.get(s,o));return this}}function G(n,r,e){let t=e?n.rows:n.rows-1;if(r<0||r>t)throw new RangeError("Row index out of range")}function Q(n,r,e){let t=e?n.columns:n.columns-1;if(r<0||r>t)throw new RangeError("Column index out of range")}function st(n,r){if(r.to1DArray&&(r=r.to1DArray()),r.length!==n.columns)throw new RangeError("vector size must be the same as the number of columns");return r}function W(n,r){if(r.to1DArray&&(r=r.to1DArray()),r.length!==n.rows)throw new RangeError("vector size must be the same as the number of rows");return r}function ft(n,r){if(!a.isAnyArray(r))throw new TypeError("row indices must be an array");for(let e=0;e<r.length;e++)if(r[e]<0||r[e]>=n.rows)throw new RangeError("row indices are out of range")}function Et(n,r){if(!a.isAnyArray(r))throw new TypeError("column indices must be an array");for(let e=0;e<r.length;e++)if(r[e]<0||r[e]>=n.columns)throw new RangeError("column indices are out of range")}function vt(n,r,e,t,s){if(arguments.length!==5)throw new RangeError("expected 4 arguments");if(yt("startRow",r),yt("endRow",e),yt("startColumn",t),yt("endColumn",s),r>e||t>s||r<0||r>=n.rows||e<0||e>=n.rows||t<0||t>=n.columns||s<0||s>=n.columns)throw new RangeError("Submatrix indices are out of range")}function dt(n,r=0){let e=[];for(let t=0;t<n;t++)e.push(r);return e}function yt(n,r){if(typeof r!="number")throw new TypeError(`${n} must be a number`)}function at(n){if(n.isEmpty())throw new Error("Empty matrix has no elements to index")}function bt(n){let r=dt(n.rows);for(let e=0;e<n.rows;++e)for(let t=0;t<n.columns;++t)r[e]+=n.get(e,t);return r}function xt(n){let r=dt(n.columns);for(let e=0;e<n.rows;++e)for(let t=0;t<n.columns;++t)r[t]+=n.get(e,t);return r}function Tt(n){let r=0;for(let e=0;e<n.rows;e++)for(let t=0;t<n.columns;t++)r+=n.get(e,t);return r}function ge(n){let r=dt(n.rows,1);for(let e=0;e<n.rows;++e)for(let t=0;t<n.columns;++t)r[e]*=n.get(e,t);return r}function me(n){let r=dt(n.columns,1);for(let e=0;e<n.rows;++e)for(let t=0;t<n.columns;++t)r[t]*=n.get(e,t);return r}function we(n){let r=1;for(let e=0;e<n.rows;e++)for(let t=0;t<n.columns;t++)r*=n.get(e,t);return r}function pe(n,r,e){const t=n.rows,s=n.columns,o=[];for(let i=0;i<t;i++){let l=0,h=0,u=0;for(let w=0;w<s;w++)u=n.get(i,w)-e[i],l+=u,h+=u*u;r?o.push((h-l*l/s)/(s-1)):o.push((h-l*l/s)/s)}return o}function de(n,r,e){const t=n.rows,s=n.columns,o=[];for(let i=0;i<s;i++){let l=0,h=0,u=0;for(let w=0;w<t;w++)u=n.get(w,i)-e[i],l+=u,h+=u*u;r?o.push((h-l*l/t)/(t-1)):o.push((h-l*l/t)/t)}return o}function ye(n,r,e){const t=n.rows,s=n.columns,o=t*s;let i=0,l=0,h=0;for(let u=0;u<t;u++)for(let w=0;w<s;w++)h=n.get(u,w)-e,i+=h,l+=h*h;return r?(l-i*i/o)/(o-1):(l-i*i/o)/o}function je(n,r){for(let e=0;e<n.rows;e++)for(let t=0;t<n.columns;t++)n.set(e,t,n.get(e,t)-r[e])}function be(n,r){for(let e=0;e<n.rows;e++)for(let t=0;t<n.columns;t++)n.set(e,t,n.get(e,t)-r[t])}function Se(n,r){for(let e=0;e<n.rows;e++)for(let t=0;t<n.columns;t++)n.set(e,t,n.get(e,t)-r)}function Me(n){const r=[];for(let e=0;e<n.rows;e++){let t=0;for(let s=0;s<n.columns;s++)t+=n.get(e,s)**2/(n.columns-1);r.push(Math.sqrt(t))}return r}function Ee(n,r){for(let e=0;e<n.rows;e++)for(let t=0;t<n.columns;t++)n.set(e,t,n.get(e,t)/r[e])}function ve(n){const r=[];for(let e=0;e<n.columns;e++){let t=0;for(let s=0;s<n.rows;s++)t+=n.get(s,e)**2/(n.rows-1);r.push(Math.sqrt(t))}return r}function ke(n,r){for(let e=0;e<n.rows;e++)for(let t=0;t<n.columns;t++)n.set(e,t,n.get(e,t)/r[t])}function Ie(n){const r=n.size-1;let e=0;for(let t=0;t<n.columns;t++)for(let s=0;s<n.rows;s++)e+=n.get(s,t)**2/r;return Math.sqrt(e)}function Ne(n,r){for(let e=0;e<n.rows;e++)for(let t=0;t<n.columns;t++)n.set(e,t,n.get(e,t)/r)}class O{static from1DArray(r,e,t){if(r*e!==t.length)throw new RangeError("data length does not match given dimensions");let o=new N(r,e);for(let i=0;i<r;i++)for(let l=0;l<e;l++)o.set(i,l,t[i*e+l]);return o}static rowVector(r){let e=new N(1,r.length);for(let t=0;t<r.length;t++)e.set(0,t,r[t]);return e}static columnVector(r){let e=new N(r.length,1);for(let t=0;t<r.length;t++)e.set(t,0,r[t]);return e}static zeros(r,e){return new N(r,e)}static ones(r,e){return new N(r,e).fill(1)}static rand(r,e,t={}){if(typeof t!="object")throw new TypeError("options must be an object");const{random:s=Math.random}=t;let o=new N(r,e);for(let i=0;i<r;i++)for(let l=0;l<e;l++)o.set(i,l,s());return o}static randInt(r,e,t={}){if(typeof t!="object")throw new TypeError("options must be an object");const{min:s=0,max:o=1e3,random:i=Math.random}=t;if(!Number.isInteger(s))throw new TypeError("min must be an integer");if(!Number.isInteger(o))throw new TypeError("max must be an integer");if(s>=o)throw new RangeError("min must be smaller than max");let l=o-s,h=new N(r,e);for(let u=0;u<r;u++)for(let w=0;w<e;w++){let f=s+Math.round(i()*l);h.set(u,w,f)}return h}static eye(r,e,t){e===void 0&&(e=r),t===void 0&&(t=1);let s=Math.min(r,e),o=this.zeros(r,e);for(let i=0;i<s;i++)o.set(i,i,t);return o}static diag(r,e,t){let s=r.length;e===void 0&&(e=s),t===void 0&&(t=e);let o=Math.min(s,e,t),i=this.zeros(e,t);for(let l=0;l<o;l++)i.set(l,l,r[l]);return i}static min(r,e){r=this.checkMatrix(r),e=this.checkMatrix(e);let t=r.rows,s=r.columns,o=new N(t,s);for(let i=0;i<t;i++)for(let l=0;l<s;l++)o.set(i,l,Math.min(r.get(i,l),e.get(i,l)));return o}static max(r,e){r=this.checkMatrix(r),e=this.checkMatrix(e);let t=r.rows,s=r.columns,o=new this(t,s);for(let i=0;i<t;i++)for(let l=0;l<s;l++)o.set(i,l,Math.max(r.get(i,l),e.get(i,l)));return o}static checkMatrix(r){return O.isMatrix(r)?r:new N(r)}static isMatrix(r){return r!=null&&r.klass==="Matrix"}get size(){return this.rows*this.columns}apply(r){if(typeof r!="function")throw new TypeError("callback must be a function");for(let e=0;e<this.rows;e++)for(let t=0;t<this.columns;t++)r.call(this,e,t);return this}to1DArray(){let r=[];for(let e=0;e<this.rows;e++)for(let t=0;t<this.columns;t++)r.push(this.get(e,t));return r}to2DArray(){let r=[];for(let e=0;e<this.rows;e++){r.push([]);for(let t=0;t<this.columns;t++)r[e].push(this.get(e,t))}return r}toJSON(){return this.to2DArray()}isRowVector(){return this.rows===1}isColumnVector(){return this.columns===1}isVector(){return this.rows===1||this.columns===1}isSquare(){return this.rows===this.columns}isEmpty(){return this.rows===0||this.columns===0}isSymmetric(){if(this.isSquare()){for(let r=0;r<this.rows;r++)for(let e=0;e<=r;e++)if(this.get(r,e)!==this.get(e,r))return!1;return!0}return!1}isDistance(){if(!this.isSymmetric())return!1;for(let r=0;r<this.rows;r++)if(this.get(r,r)!==0)return!1;return!0}isEchelonForm(){let r=0,e=0,t=-1,s=!0,o=!1;for(;r<this.rows&&s;){for(e=0,o=!1;e<this.columns&&o===!1;)this.get(r,e)===0?e++:this.get(r,e)===1&&e>t?(o=!0,t=e):(s=!1,o=!0);r++}return s}isReducedEchelonForm(){let r=0,e=0,t=-1,s=!0,o=!1;for(;r<this.rows&&s;){for(e=0,o=!1;e<this.columns&&o===!1;)this.get(r,e)===0?e++:this.get(r,e)===1&&e>t?(o=!0,t=e):(s=!1,o=!0);for(let i=e+1;i<this.rows;i++)this.get(r,i)!==0&&(s=!1);r++}return s}echelonForm(){let r=this.clone(),e=0,t=0;for(;e<r.rows&&t<r.columns;){let s=e;for(let o=e;o<r.rows;o++)r.get(o,t)>r.get(s,t)&&(s=o);if(r.get(s,t)===0)t++;else{r.swapRows(e,s);let o=r.get(e,t);for(let i=t;i<r.columns;i++)r.set(e,i,r.get(e,i)/o);for(let i=e+1;i<r.rows;i++){let l=r.get(i,t)/r.get(e,t);r.set(i,t,0);for(let h=t+1;h<r.columns;h++)r.set(i,h,r.get(i,h)-r.get(e,h)*l)}e++,t++}}return r}reducedEchelonForm(){let r=this.echelonForm(),e=r.columns,t=r.rows,s=t-1;for(;s>=0;)if(r.maxRow(s)===0)s--;else{let o=0,i=!1;for(;o<t&&i===!1;)r.get(s,o)===1?i=!0:o++;for(let l=0;l<s;l++){let h=r.get(l,o);for(let u=o;u<e;u++){let w=r.get(l,u)-h*r.get(s,u);r.set(l,u,w)}}s--}return r}set(){throw new Error("set method is unimplemented")}get(){throw new Error("get method is unimplemented")}repeat(r={}){if(typeof r!="object")throw new TypeError("options must be an object");const{rows:e=1,columns:t=1}=r;if(!Number.isInteger(e)||e<=0)throw new TypeError("rows must be a positive integer");if(!Number.isInteger(t)||t<=0)throw new TypeError("columns must be a positive integer");let s=new N(this.rows*e,this.columns*t);for(let o=0;o<e;o++)for(let i=0;i<t;i++)s.setSubMatrix(this,this.rows*o,this.columns*i);return s}fill(r){for(let e=0;e<this.rows;e++)for(let t=0;t<this.columns;t++)this.set(e,t,r);return this}neg(){return this.mulS(-1)}getRow(r){G(this,r);let e=[];for(let t=0;t<this.columns;t++)e.push(this.get(r,t));return e}getRowVector(r){return N.rowVector(this.getRow(r))}setRow(r,e){G(this,r),e=st(this,e);for(let t=0;t<this.columns;t++)this.set(r,t,e[t]);return this}swapRows(r,e){G(this,r),G(this,e);for(let t=0;t<this.columns;t++){let s=this.get(r,t);this.set(r,t,this.get(e,t)),this.set(e,t,s)}return this}getColumn(r){Q(this,r);let e=[];for(let t=0;t<this.rows;t++)e.push(this.get(t,r));return e}getColumnVector(r){return N.columnVector(this.getColumn(r))}setColumn(r,e){Q(this,r),e=W(this,e);for(let t=0;t<this.rows;t++)this.set(t,r,e[t]);return this}swapColumns(r,e){Q(this,r),Q(this,e);for(let t=0;t<this.rows;t++){let s=this.get(t,r);this.set(t,r,this.get(t,e)),this.set(t,e,s)}return this}addRowVector(r){r=st(this,r);for(let e=0;e<this.rows;e++)for(let t=0;t<this.columns;t++)this.set(e,t,this.get(e,t)+r[t]);return this}subRowVector(r){r=st(this,r);for(let e=0;e<this.rows;e++)for(let t=0;t<this.columns;t++)this.set(e,t,this.get(e,t)-r[t]);return this}mulRowVector(r){r=st(this,r);for(let e=0;e<this.rows;e++)for(let t=0;t<this.columns;t++)this.set(e,t,this.get(e,t)*r[t]);return this}divRowVector(r){r=st(this,r);for(let e=0;e<this.rows;e++)for(let t=0;t<this.columns;t++)this.set(e,t,this.get(e,t)/r[t]);return this}addColumnVector(r){r=W(this,r);for(let e=0;e<this.rows;e++)for(let t=0;t<this.columns;t++)this.set(e,t,this.get(e,t)+r[e]);return this}subColumnVector(r){r=W(this,r);for(let e=0;e<this.rows;e++)for(let t=0;t<this.columns;t++)this.set(e,t,this.get(e,t)-r[e]);return this}mulColumnVector(r){r=W(this,r);for(let e=0;e<this.rows;e++)for(let t=0;t<this.columns;t++)this.set(e,t,this.get(e,t)*r[e]);return this}divColumnVector(r){r=W(this,r);for(let e=0;e<this.rows;e++)for(let t=0;t<this.columns;t++)this.set(e,t,this.get(e,t)/r[e]);return this}mulRow(r,e){G(this,r);for(let t=0;t<this.columns;t++)this.set(r,t,this.get(r,t)*e);return this}mulColumn(r,e){Q(this,r);for(let t=0;t<this.rows;t++)this.set(t,r,this.get(t,r)*e);return this}max(r){if(this.isEmpty())return NaN;switch(r){case"row":{const e=new Array(this.rows).fill(Number.NEGATIVE_INFINITY);for(let t=0;t<this.rows;t++)for(let s=0;s<this.columns;s++)this.get(t,s)>e[t]&&(e[t]=this.get(t,s));return e}case"column":{const e=new Array(this.columns).fill(Number.NEGATIVE_INFINITY);for(let t=0;t<this.rows;t++)for(let s=0;s<this.columns;s++)this.get(t,s)>e[s]&&(e[s]=this.get(t,s));return e}case void 0:{let e=this.get(0,0);for(let t=0;t<this.rows;t++)for(let s=0;s<this.columns;s++)this.get(t,s)>e&&(e=this.get(t,s));return e}default:throw new Error(`invalid option: ${r}`)}}maxIndex(){at(this);let r=this.get(0,0),e=[0,0];for(let t=0;t<this.rows;t++)for(let s=0;s<this.columns;s++)this.get(t,s)>r&&(r=this.get(t,s),e[0]=t,e[1]=s);return e}min(r){if(this.isEmpty())return NaN;switch(r){case"row":{const e=new Array(this.rows).fill(Number.POSITIVE_INFINITY);for(let t=0;t<this.rows;t++)for(let s=0;s<this.columns;s++)this.get(t,s)<e[t]&&(e[t]=this.get(t,s));return e}case"column":{const e=new Array(this.columns).fill(Number.POSITIVE_INFINITY);for(let t=0;t<this.rows;t++)for(let s=0;s<this.columns;s++)this.get(t,s)<e[s]&&(e[s]=this.get(t,s));return e}case void 0:{let e=this.get(0,0);for(let t=0;t<this.rows;t++)for(let s=0;s<this.columns;s++)this.get(t,s)<e&&(e=this.get(t,s));return e}default:throw new Error(`invalid option: ${r}`)}}minIndex(){at(this);let r=this.get(0,0),e=[0,0];for(let t=0;t<this.rows;t++)for(let s=0;s<this.columns;s++)this.get(t,s)<r&&(r=this.get(t,s),e[0]=t,e[1]=s);return e}maxRow(r){if(G(this,r),this.isEmpty())return NaN;let e=this.get(r,0);for(let t=1;t<this.columns;t++)this.get(r,t)>e&&(e=this.get(r,t));return e}maxRowIndex(r){G(this,r),at(this);let e=this.get(r,0),t=[r,0];for(let s=1;s<this.columns;s++)this.get(r,s)>e&&(e=this.get(r,s),t[1]=s);return t}minRow(r){if(G(this,r),this.isEmpty())return NaN;let e=this.get(r,0);for(let t=1;t<this.columns;t++)this.get(r,t)<e&&(e=this.get(r,t));return e}minRowIndex(r){G(this,r),at(this);let e=this.get(r,0),t=[r,0];for(let s=1;s<this.columns;s++)this.get(r,s)<e&&(e=this.get(r,s),t[1]=s);return t}maxColumn(r){if(Q(this,r),this.isEmpty())return NaN;let e=this.get(0,r);for(let t=1;t<this.rows;t++)this.get(t,r)>e&&(e=this.get(t,r));return e}maxColumnIndex(r){Q(this,r),at(this);let e=this.get(0,r),t=[0,r];for(let s=1;s<this.rows;s++)this.get(s,r)>e&&(e=this.get(s,r),t[0]=s);return t}minColumn(r){if(Q(this,r),this.isEmpty())return NaN;let e=this.get(0,r);for(let t=1;t<this.rows;t++)this.get(t,r)<e&&(e=this.get(t,r));return e}minColumnIndex(r){Q(this,r),at(this);let e=this.get(0,r),t=[0,r];for(let s=1;s<this.rows;s++)this.get(s,r)<e&&(e=this.get(s,r),t[0]=s);return t}diag(){let r=Math.min(this.rows,this.columns),e=[];for(let t=0;t<r;t++)e.push(this.get(t,t));return e}norm(r="frobenius"){switch(r){case"max":return this.max();case"frobenius":return Math.sqrt(this.dot(this));default:throw new RangeError(`unknown norm type: ${r}`)}}cumulativeSum(){let r=0;for(let e=0;e<this.rows;e++)for(let t=0;t<this.columns;t++)r+=this.get(e,t),this.set(e,t,r);return this}dot(r){O.isMatrix(r)&&(r=r.to1DArray());let e=this.to1DArray();if(e.length!==r.length)throw new RangeError("vectors do not have the same size");let t=0;for(let s=0;s<e.length;s++)t+=e[s]*r[s];return t}mmul(r){r=N.checkMatrix(r);let e=this.rows,t=this.columns,s=r.columns,o=new N(e,s),i=new Float64Array(t);for(let l=0;l<s;l++){for(let h=0;h<t;h++)i[h]=r.get(h,l);for(let h=0;h<e;h++){let u=0;for(let w=0;w<t;w++)u+=this.get(h,w)*i[w];o.set(h,l,u)}}return o}mpow(r){if(!this.isSquare())throw new RangeError("Matrix must be square");if(!Number.isInteger(r)||r<0)throw new RangeError("Exponent must be a non-negative integer");let e=N.eye(this.rows),t=this;for(let s=r;s>=1;s/=2)(s&1)!==0&&(e=e.mmul(t)),t=t.mmul(t);return e}strassen2x2(r){r=N.checkMatrix(r);let e=new N(2,2);const t=this.get(0,0),s=r.get(0,0),o=this.get(0,1),i=r.get(0,1),l=this.get(1,0),h=r.get(1,0),u=this.get(1,1),w=r.get(1,1),f=(t+u)*(s+w),j=(l+u)*s,k=t*(i-w),y=u*(h-s),b=(t+o)*w,R=(l-t)*(s+i),c=(o-u)*(h+w),v=f+y-b+c,x=k+b,$=j+y,L=f-j+k+R;return e.set(0,0,v),e.set(0,1,x),e.set(1,0,$),e.set(1,1,L),e}strassen3x3(r){r=N.checkMatrix(r);let e=new N(3,3);const t=this.get(0,0),s=this.get(0,1),o=this.get(0,2),i=this.get(1,0),l=this.get(1,1),h=this.get(1,2),u=this.get(2,0),w=this.get(2,1),f=this.get(2,2),j=r.get(0,0),k=r.get(0,1),y=r.get(0,2),b=r.get(1,0),R=r.get(1,1),c=r.get(1,2),v=r.get(2,0),x=r.get(2,1),$=r.get(2,2),L=(t+s+o-i-l-w-f)*R,X=(t-i)*(-k+R),P=l*(-j+k+b-R-c-v+$),D=(-t+i+l)*(j-k+R),J=(i+l)*(-j+k),g=t*j,S=(-t+u+w)*(j-y+c),C=(-t+u)*(y-c),E=(u+w)*(-j+y),Z=(t+s+o-l-h-u-w)*c,B=w*(-j+y+b-R-c-v+x),Y=(-o+w+f)*(R+v-x),K=(o-f)*(R-x),tt=o*v,lt=(w+f)*(-v+x),A=(-o+l+h)*(c+v-$),ct=(o-h)*(c-$),wt=(l+h)*(-v+$),_=s*b,et=h*x,nt=i*y,it=u*k,H=f*$,Xe=g+tt+_,Ze=L+D+J+g+Y+tt+lt,Ke=g+S+E+Z+tt+A+wt,Ae=X+P+D+g+tt+A+ct,He=X+D+J+g+et,ts=tt+A+ct+wt+nt,es=g+S+C+B+Y+K+tt,ss=Y+K+tt+lt+it,rs=g+S+C+E+H;return e.set(0,0,Xe),e.set(0,1,Ze),e.set(0,2,Ke),e.set(1,0,Ae),e.set(1,1,He),e.set(1,2,ts),e.set(2,0,es),e.set(2,1,ss),e.set(2,2,rs),e}mmulStrassen(r){r=N.checkMatrix(r);let e=this.clone(),t=e.rows,s=e.columns,o=r.rows,i=r.columns;s!==o&&console.warn(`Multiplying ${t} x ${s} and ${o} x ${i} matrix: dimensions do not match.`);function l(f,j,k){let y=f.rows,b=f.columns;if(y===j&&b===k)return f;{let R=O.zeros(j,k);return R=R.setSubMatrix(f,0,0),R}}let h=Math.max(t,o),u=Math.max(s,i);e=l(e,h,u),r=l(r,h,u);function w(f,j,k,y){if(k<=512||y<=512)return f.mmul(j);k%2===1&&y%2===1?(f=l(f,k+1,y+1),j=l(j,k+1,y+1)):k%2===1?(f=l(f,k+1,y),j=l(j,k+1,y)):y%2===1&&(f=l(f,k,y+1),j=l(j,k,y+1));let b=parseInt(f.rows/2,10),R=parseInt(f.columns/2,10),c=f.subMatrix(0,b-1,0,R-1),v=j.subMatrix(0,b-1,0,R-1),x=f.subMatrix(0,b-1,R,f.columns-1),$=j.subMatrix(0,b-1,R,j.columns-1),L=f.subMatrix(b,f.rows-1,0,R-1),X=j.subMatrix(b,j.rows-1,0,R-1),P=f.subMatrix(b,f.rows-1,R,f.columns-1),D=j.subMatrix(b,j.rows-1,R,j.columns-1),J=w(O.add(c,P),O.add(v,D),b,R),g=w(O.add(L,P),v,b,R),S=w(c,O.sub($,D),b,R),C=w(P,O.sub(X,v),b,R),E=w(O.add(c,x),D,b,R),Z=w(O.sub(L,c),O.add(v,$),b,R),B=w(O.sub(x,P),O.add(X,D),b,R),Y=O.add(J,C);Y.sub(E),Y.add(B);let K=O.add(S,E),tt=O.add(g,C),lt=O.sub(J,g);lt.add(S),lt.add(Z);let A=O.zeros(2*Y.rows,2*Y.columns);return A=A.setSubMatrix(Y,0,0),A=A.setSubMatrix(K,Y.rows,0),A=A.setSubMatrix(tt,0,Y.columns),A=A.setSubMatrix(lt,Y.rows,Y.columns),A.subMatrix(0,k-1,0,y-1)}return w(e,r,h,u)}scaleRows(r={}){if(typeof r!="object")throw new TypeError("options must be an object");const{min:e=0,max:t=1}=r;if(!Number.isFinite(e))throw new TypeError("min must be a number");if(!Number.isFinite(t))throw new TypeError("max must be a number");if(e>=t)throw new RangeError("min must be smaller than max");let s=new N(this.rows,this.columns);for(let o=0;o<this.rows;o++){const i=this.getRow(o);i.length>0&&p(i,{min:e,max:t,output:i}),s.setRow(o,i)}return s}scaleColumns(r={}){if(typeof r!="object")throw new TypeError("options must be an object");const{min:e=0,max:t=1}=r;if(!Number.isFinite(e))throw new TypeError("min must be a number");if(!Number.isFinite(t))throw new TypeError("max must be a number");if(e>=t)throw new RangeError("min must be smaller than max");let s=new N(this.rows,this.columns);for(let o=0;o<this.columns;o++){const i=this.getColumn(o);i.length&&p(i,{min:e,max:t,output:i}),s.setColumn(o,i)}return s}flipRows(){const r=Math.ceil(this.columns/2);for(let e=0;e<this.rows;e++)for(let t=0;t<r;t++){let s=this.get(e,t),o=this.get(e,this.columns-1-t);this.set(e,t,o),this.set(e,this.columns-1-t,s)}return this}flipColumns(){const r=Math.ceil(this.rows/2);for(let e=0;e<this.columns;e++)for(let t=0;t<r;t++){let s=this.get(t,e),o=this.get(this.rows-1-t,e);this.set(t,e,o),this.set(this.rows-1-t,e,s)}return this}kroneckerProduct(r){r=N.checkMatrix(r);let e=this.rows,t=this.columns,s=r.rows,o=r.columns,i=new N(e*s,t*o);for(let l=0;l<e;l++)for(let h=0;h<t;h++)for(let u=0;u<s;u++)for(let w=0;w<o;w++)i.set(s*l+u,o*h+w,this.get(l,h)*r.get(u,w));return i}kroneckerSum(r){if(r=N.checkMatrix(r),!this.isSquare()||!r.isSquare())throw new Error("Kronecker Sum needs two Square Matrices");let e=this.rows,t=r.rows,s=this.kroneckerProduct(N.eye(t,t)),o=N.eye(e,e).kroneckerProduct(r);return s.add(o)}transpose(){let r=new N(this.columns,this.rows);for(let e=0;e<this.rows;e++)for(let t=0;t<this.columns;t++)r.set(t,e,this.get(e,t));return r}sortRows(r=Kt){for(let e=0;e<this.rows;e++)this.setRow(e,this.getRow(e).sort(r));return this}sortColumns(r=Kt){for(let e=0;e<this.columns;e++)this.setColumn(e,this.getColumn(e).sort(r));return this}subMatrix(r,e,t,s){vt(this,r,e,t,s);let o=new N(e-r+1,s-t+1);for(let i=r;i<=e;i++)for(let l=t;l<=s;l++)o.set(i-r,l-t,this.get(i,l));return o}subMatrixRow(r,e,t){if(e===void 0&&(e=0),t===void 0&&(t=this.columns-1),e>t||e<0||e>=this.columns||t<0||t>=this.columns)throw new RangeError("Argument out of range");let s=new N(r.length,t-e+1);for(let o=0;o<r.length;o++)for(let i=e;i<=t;i++){if(r[o]<0||r[o]>=this.rows)throw new RangeError(`Row index out of range: ${r[o]}`);s.set(o,i-e,this.get(r[o],i))}return s}subMatrixColumn(r,e,t){if(e===void 0&&(e=0),t===void 0&&(t=this.rows-1),e>t||e<0||e>=this.rows||t<0||t>=this.rows)throw new RangeError("Argument out of range");let s=new N(t-e+1,r.length);for(let o=0;o<r.length;o++)for(let i=e;i<=t;i++){if(r[o]<0||r[o]>=this.columns)throw new RangeError(`Column index out of range: ${r[o]}`);s.set(i-e,o,this.get(i,r[o]))}return s}setSubMatrix(r,e,t){if(r=N.checkMatrix(r),r.isEmpty())return this;let s=e+r.rows-1,o=t+r.columns-1;vt(this,e,s,t,o);for(let i=0;i<r.rows;i++)for(let l=0;l<r.columns;l++)this.set(e+i,t+l,r.get(i,l));return this}selection(r,e){ft(this,r),Et(this,e);let t=new N(r.length,e.length);for(let s=0;s<r.length;s++){let o=r[s];for(let i=0;i<e.length;i++){let l=e[i];t.set(s,i,this.get(o,l))}}return t}trace(){let r=Math.min(this.rows,this.columns),e=0;for(let t=0;t<r;t++)e+=this.get(t,t);return e}clone(){return this.constructor.copy(this,new N(this.rows,this.columns))}static copy(r,e){for(const[t,s,o]of r.entries())e.set(t,s,o);return e}sum(r){switch(r){case"row":return bt(this);case"column":return xt(this);case void 0:return Tt(this);default:throw new Error(`invalid option: ${r}`)}}product(r){switch(r){case"row":return ge(this);case"column":return me(this);case void 0:return we(this);default:throw new Error(`invalid option: ${r}`)}}mean(r){const e=this.sum(r);switch(r){case"row":{for(let t=0;t<this.rows;t++)e[t]/=this.columns;return e}case"column":{for(let t=0;t<this.columns;t++)e[t]/=this.rows;return e}case void 0:return e/this.size;default:throw new Error(`invalid option: ${r}`)}}variance(r,e={}){if(typeof r=="object"&&(e=r,r=void 0),typeof e!="object")throw new TypeError("options must be an object");const{unbiased:t=!0,mean:s=this.mean(r)}=e;if(typeof t!="boolean")throw new TypeError("unbiased must be a boolean");switch(r){case"row":{if(!a.isAnyArray(s))throw new TypeError("mean must be an array");return pe(this,t,s)}case"column":{if(!a.isAnyArray(s))throw new TypeError("mean must be an array");return de(this,t,s)}case void 0:{if(typeof s!="number")throw new TypeError("mean must be a number");return ye(this,t,s)}default:throw new Error(`invalid option: ${r}`)}}standardDeviation(r,e){typeof r=="object"&&(e=r,r=void 0);const t=this.variance(r,e);if(r===void 0)return Math.sqrt(t);for(let s=0;s<t.length;s++)t[s]=Math.sqrt(t[s]);return t}center(r,e={}){if(typeof r=="object"&&(e=r,r=void 0),typeof e!="object")throw new TypeError("options must be an object");const{center:t=this.mean(r)}=e;switch(r){case"row":{if(!a.isAnyArray(t))throw new TypeError("center must be an array");return je(this,t),this}case"column":{if(!a.isAnyArray(t))throw new TypeError("center must be an array");return be(this,t),this}case void 0:{if(typeof t!="number")throw new TypeError("center must be a number");return Se(this,t),this}default:throw new Error(`invalid option: ${r}`)}}scale(r,e={}){if(typeof r=="object"&&(e=r,r=void 0),typeof e!="object")throw new TypeError("options must be an object");let t=e.scale;switch(r){case"row":{if(t===void 0)t=Me(this);else if(!a.isAnyArray(t))throw new TypeError("scale must be an array");return Ee(this,t),this}case"column":{if(t===void 0)t=ve(this);else if(!a.isAnyArray(t))throw new TypeError("scale must be an array");return ke(this,t),this}case void 0:{if(t===void 0)t=Ie(this);else if(typeof t!="number")throw new TypeError("scale must be a number");return Ne(this,t),this}default:throw new Error(`invalid option: ${r}`)}}toString(r){return q(this,r)}[Symbol.iterator](){return this.entries()}*entries(){for(let r=0;r<this.rows;r++)for(let e=0;e<this.columns;e++)yield[r,e,this.get(r,e)]}*values(){for(let r=0;r<this.rows;r++)for(let e=0;e<this.columns;e++)yield this.get(r,e)}}O.prototype.klass="Matrix",typeof Symbol<"u"&&(O.prototype[Symbol.for("nodejs.util.inspect.custom")]=M);function Kt(n,r){return n-r}function Re(n){return n.every(r=>typeof r=="number")}O.random=O.rand,O.randomInt=O.randInt,O.diagonal=O.diag,O.prototype.diagonal=O.prototype.diag,O.identity=O.eye,O.prototype.negate=O.prototype.neg,O.prototype.tensorProduct=O.prototype.kroneckerProduct;const $t=class $t extends O{constructor(e,t){super();Bt(this,kt);oe(this,"data");if($t.isMatrix(e))Wt(this,kt,Yt).call(this,e.rows,e.columns),$t.copy(e,this);else if(Number.isInteger(e)&&e>=0)Wt(this,kt,Yt).call(this,e,t);else if(a.isAnyArray(e)){const s=e;if(e=s.length,t=e?s[0].length:0,typeof t!="number")throw new TypeError("Data must be a 2D array with at least one element");this.data=[];for(let o=0;o<e;o++){if(s[o].length!==t)throw new RangeError("Inconsistent array dimensions");if(!Re(s[o]))throw new TypeError("Input data contains non-numeric values");this.data.push(Float64Array.from(s[o]))}this.rows=e,this.columns=t}else throw new TypeError("First argument must be a positive number or an array")}set(e,t,s){return this.data[e][t]=s,this}get(e,t){return this.data[e][t]}removeRow(e){return G(this,e),this.data.splice(e,1),this.rows-=1,this}addRow(e,t){return t===void 0&&(t=e,e=this.rows),G(this,e,!0),t=Float64Array.from(st(this,t)),this.data.splice(e,0,t),this.rows+=1,this}removeColumn(e){Q(this,e);for(let t=0;t<this.rows;t++){const s=new Float64Array(this.columns-1);for(let o=0;o<e;o++)s[o]=this.data[t][o];for(let o=e+1;o<this.columns;o++)s[o-1]=this.data[t][o];this.data[t]=s}return this.columns-=1,this}addColumn(e,t){typeof t>"u"&&(t=e,e=this.columns),Q(this,e,!0),t=W(this,t);for(let s=0;s<this.rows;s++){const o=new Float64Array(this.columns+1);let i=0;for(;i<e;i++)o[i]=this.data[s][i];for(o[i++]=t[s];i<this.columns+1;i++)o[i]=this.data[s][i-1];this.data[s]=o}return this.columns+=1,this}};kt=new WeakSet,Yt=function(e,t){if(this.data=[],Number.isInteger(t)&&t>=0)for(let s=0;s<e;s++)this.data.push(new Float64Array(t));else throw new TypeError("nColumns must be a positive integer");this.rows=e,this.columns=t};let N=$t;U(O,N);const Lt=class Lt extends O{constructor(e){super();Bt(this,rt);if(N.isMatrix(e)){if(!e.isSymmetric())throw new TypeError("not symmetric data");Ot(this,rt,N.copy(e,new N(e.rows,e.rows)))}else if(Number.isInteger(e)&&e>=0)Ot(this,rt,new N(e,e));else if(Ot(this,rt,new N(e)),!this.isSymmetric())throw new TypeError("not symmetric data")}get size(){return ht(this,rt).size}get rows(){return ht(this,rt).rows}get columns(){return ht(this,rt).columns}get diagonalSize(){return this.rows}static isSymmetricMatrix(e){return N.isMatrix(e)&&e.klassType==="SymmetricMatrix"}static zeros(e){return new this(e)}static ones(e){return new this(e).fill(1)}clone(){const e=new Lt(this.diagonalSize);for(const[t,s,o]of this.upperRightEntries())e.set(t,s,o);return e}toMatrix(){return new N(this)}get(e,t){return ht(this,rt).get(e,t)}set(e,t,s){return ht(this,rt).set(e,t,s),ht(this,rt).set(t,e,s),this}removeCross(e){return ht(this,rt).removeRow(e),ht(this,rt).removeColumn(e),this}addCross(e,t){t===void 0&&(t=e,e=this.diagonalSize);const s=t.slice();return s.splice(e,1),ht(this,rt).addRow(e,s),ht(this,rt).addColumn(e,t),this}applyMask(e){if(e.length!==this.diagonalSize)throw new RangeError("Mask size do not match with matrix size");const t=[];for(const[s,o]of e.entries())o||t.push(s);t.reverse();for(const s of t)this.removeCross(s);return this}toCompact(){const{diagonalSize:e}=this,t=new Array(e*(e+1)/2);for(let s=0,o=0,i=0;i<t.length;i++)t[i]=this.get(o,s),++s>=e&&(s=++o);return t}static fromCompact(e){const t=e.length,s=(Math.sqrt(8*t+1)-1)/2;if(!Number.isInteger(s))throw new TypeError(`This array is not a compact representation of a Symmetric Matrix, ${JSON.stringify(e)}`);const o=new Lt(s);for(let i=0,l=0,h=0;h<t;h++)o.set(i,l,e[h]),++i>=s&&(i=++l);return o}*upperRightEntries(){for(let e=0,t=0;e<this.diagonalSize;void 0){const s=this.get(e,t);yield[e,t,s],++t>=this.diagonalSize&&(t=++e)}}*upperRightValues(){for(let e=0,t=0;e<this.diagonalSize;void 0)yield this.get(e,t),++t>=this.diagonalSize&&(t=++e)}};rt=new WeakMap;let jt=Lt;jt.prototype.klassType="SymmetricMatrix";class qt extends jt{static isDistanceMatrix(r){return jt.isSymmetricMatrix(r)&&r.klassSubType==="DistanceMatrix"}constructor(r){if(super(r),!this.isDistance())throw new TypeError("Provided arguments do no produce a distance matrix")}set(r,e,t){return r===e&&(t=0),super.set(r,e,t)}addCross(r,e){return e===void 0&&(e=r,r=this.diagonalSize),e=e.slice(),e[r]=0,super.addCross(r,e)}toSymmetricMatrix(){return new jt(this)}clone(){const r=new qt(this.diagonalSize);for(const[e,t,s]of this.upperRightEntries())e!==t&&r.set(e,t,s);return r}toCompact(){const{diagonalSize:r}=this,e=(r-1)*r/2,t=new Array(e);for(let s=1,o=0,i=0;i<t.length;i++)t[i]=this.get(o,s),++s>=r&&(s=++o+1);return t}static fromCompact(r){const e=r.length;if(e===0)return new this(0);const t=(Math.sqrt(8*e+1)+1)/2;if(!Number.isInteger(t))throw new TypeError(`This array is not a compact representation of a DistanceMatrix, ${JSON.stringify(r)}`);const s=new this(t);for(let o=1,i=0,l=0;l<e;l++)s.set(o,i,r[l]),++o>=t&&(o=++i+1);return s}}qt.prototype.klassSubType="DistanceMatrix";class gt extends O{constructor(r,e,t){super(),this.matrix=r,this.rows=e,this.columns=t}}class Ce extends gt{constructor(r,e){Q(r,e),super(r,r.rows,1),this.column=e}set(r,e,t){return this.matrix.set(r,this.column,t),this}get(r){return this.matrix.get(r,this.column)}}class xe extends gt{constructor(r,e){Et(r,e),super(r,r.rows,e.length),this.columnIndices=e}set(r,e,t){return this.matrix.set(r,this.columnIndices[e],t),this}get(r,e){return this.matrix.get(r,this.columnIndices[e])}}class Te extends gt{constructor(r){super(r,r.rows,r.columns)}set(r,e,t){return this.matrix.set(r,this.columns-e-1,t),this}get(r,e){return this.matrix.get(r,this.columns-e-1)}}class qe extends gt{constructor(r){super(r,r.rows,r.columns)}set(r,e,t){return this.matrix.set(this.rows-r-1,e,t),this}get(r,e){return this.matrix.get(this.rows-r-1,e)}}class Pe extends gt{constructor(r,e){G(r,e),super(r,1,r.columns),this.row=e}set(r,e,t){return this.matrix.set(this.row,e,t),this}get(r,e){return this.matrix.get(this.row,e)}}class Fe extends gt{constructor(r,e){ft(r,e),super(r,e.length,r.columns),this.rowIndices=e}set(r,e,t){return this.matrix.set(this.rowIndices[r],e,t),this}get(r,e){return this.matrix.get(this.rowIndices[r],e)}}class Pt extends gt{constructor(r,e,t){ft(r,e),Et(r,t),super(r,e.length,t.length),this.rowIndices=e,this.columnIndices=t}set(r,e,t){return this.matrix.set(this.rowIndices[r],this.columnIndices[e],t),this}get(r,e){return this.matrix.get(this.rowIndices[r],this.columnIndices[e])}}class De extends gt{constructor(r,e,t,s,o){vt(r,e,t,s,o),super(r,t-e+1,o-s+1),this.startRow=e,this.startColumn=s}set(r,e,t){return this.matrix.set(this.startRow+r,this.startColumn+e,t),this}get(r,e){return this.matrix.get(this.startRow+r,this.startColumn+e)}}class ze extends gt{constructor(r){super(r,r.columns,r.rows)}set(r,e,t){return this.matrix.set(e,r,t),this}get(r,e){return this.matrix.get(e,r)}}class At extends O{constructor(r,e={}){const{rows:t=1}=e;if(r.length%t!==0)throw new Error("the data length is not divisible by the number of rows");super(),this.rows=t,this.columns=r.length/t,this.data=r}set(r,e,t){let s=this._calculateIndex(r,e);return this.data[s]=t,this}get(r,e){let t=this._calculateIndex(r,e);return this.data[t]}_calculateIndex(r,e){return r*this.columns+e}}class ot extends O{constructor(r){super(),this.data=r,this.rows=r.length,this.columns=r[0].length}set(r,e,t){return this.data[r][e]=t,this}get(r,e){return this.data[r][e]}}function $e(n,r){if(a.isAnyArray(n))return n[0]&&a.isAnyArray(n[0])?new ot(n):new At(n,r);throw new Error("the argument is not an array")}class Ft{constructor(r){r=ot.checkMatrix(r);let e=r.clone(),t=e.rows,s=e.columns,o=new Float64Array(t),i=1,l,h,u,w,f,j,k,y,b;for(l=0;l<t;l++)o[l]=l;for(y=new Float64Array(t),h=0;h<s;h++){for(l=0;l<t;l++)y[l]=e.get(l,h);for(l=0;l<t;l++){for(b=Math.min(l,h),f=0,u=0;u<b;u++)f+=e.get(l,u)*y[u];y[l]-=f,e.set(l,h,y[l])}for(w=h,l=h+1;l<t;l++)Math.abs(y[l])>Math.abs(y[w])&&(w=l);if(w!==h){for(u=0;u<s;u++)j=e.get(w,u),e.set(w,u,e.get(h,u)),e.set(h,u,j);k=o[w],o[w]=o[h],o[h]=k,i=-i}if(h<t&&e.get(h,h)!==0)for(l=h+1;l<t;l++)e.set(l,h,e.get(l,h)/e.get(h,h))}this.LU=e,this.pivotVector=o,this.pivotSign=i}isSingular(){let r=this.LU,e=r.columns;for(let t=0;t<e;t++)if(r.get(t,t)===0)return!0;return!1}solve(r){r=N.checkMatrix(r);let e=this.LU;if(e.rows!==r.rows)throw new Error("Invalid matrix dimensions");if(this.isSingular())throw new Error("LU matrix is singular");let s=r.columns,o=r.subMatrixRow(this.pivotVector,0,s-1),i=e.columns,l,h,u;for(u=0;u<i;u++)for(l=u+1;l<i;l++)for(h=0;h<s;h++)o.set(l,h,o.get(l,h)-o.get(u,h)*e.get(l,u));for(u=i-1;u>=0;u--){for(h=0;h<s;h++)o.set(u,h,o.get(u,h)/e.get(u,u));for(l=0;l<u;l++)for(h=0;h<s;h++)o.set(l,h,o.get(l,h)-o.get(u,h)*e.get(l,u))}return o}get determinant(){let r=this.LU;if(!r.isSquare())throw new Error("Matrix must be square");let e=this.pivotSign,t=r.columns;for(let s=0;s<t;s++)e*=r.get(s,s);return e}get lowerTriangularMatrix(){let r=this.LU,e=r.rows,t=r.columns,s=new N(e,t);for(let o=0;o<e;o++)for(let i=0;i<t;i++)o>i?s.set(o,i,r.get(o,i)):o===i?s.set(o,i,1):s.set(o,i,0);return s}get upperTriangularMatrix(){let r=this.LU,e=r.rows,t=r.columns,s=new N(e,t);for(let o=0;o<e;o++)for(let i=0;i<t;i++)o<=i?s.set(o,i,r.get(o,i)):s.set(o,i,0);return s}get pivotPermutationVector(){return Array.from(this.pivotVector)}}function mt(n,r){let e=0;return Math.abs(n)>Math.abs(r)?(e=r/n,Math.abs(n)*Math.sqrt(1+e*e)):r!==0?(e=n/r,Math.abs(r)*Math.sqrt(1+e*e)):0}class Gt{constructor(r){r=ot.checkMatrix(r);let e=r.clone(),t=r.rows,s=r.columns,o=new Float64Array(s),i,l,h,u;for(h=0;h<s;h++){let w=0;for(i=h;i<t;i++)w=mt(w,e.get(i,h));if(w!==0){for(e.get(h,h)<0&&(w=-w),i=h;i<t;i++)e.set(i,h,e.get(i,h)/w);for(e.set(h,h,e.get(h,h)+1),l=h+1;l<s;l++){for(u=0,i=h;i<t;i++)u+=e.get(i,h)*e.get(i,l);for(u=-u/e.get(h,h),i=h;i<t;i++)e.set(i,l,e.get(i,l)+u*e.get(i,h))}}o[h]=-w}this.QR=e,this.Rdiag=o}solve(r){r=N.checkMatrix(r);let e=this.QR,t=e.rows;if(r.rows!==t)throw new Error("Matrix row dimensions must agree");if(!this.isFullRank())throw new Error("Matrix is rank deficient");let s=r.columns,o=r.clone(),i=e.columns,l,h,u,w;for(u=0;u<i;u++)for(h=0;h<s;h++){for(w=0,l=u;l<t;l++)w+=e.get(l,u)*o.get(l,h);for(w=-w/e.get(u,u),l=u;l<t;l++)o.set(l,h,o.get(l,h)+w*e.get(l,u))}for(u=i-1;u>=0;u--){for(h=0;h<s;h++)o.set(u,h,o.get(u,h)/this.Rdiag[u]);for(l=0;l<u;l++)for(h=0;h<s;h++)o.set(l,h,o.get(l,h)-o.get(u,h)*e.get(l,u))}return o.subMatrix(0,i-1,0,s-1)}isFullRank(){let r=this.QR.columns;for(let e=0;e<r;e++)if(this.Rdiag[e]===0)return!1;return!0}get upperTriangularMatrix(){let r=this.QR,e=r.columns,t=new N(e,e),s,o;for(s=0;s<e;s++)for(o=0;o<e;o++)s<o?t.set(s,o,r.get(s,o)):s===o?t.set(s,o,this.Rdiag[s]):t.set(s,o,0);return t}get orthogonalMatrix(){let r=this.QR,e=r.rows,t=r.columns,s=new N(e,t),o,i,l,h;for(l=t-1;l>=0;l--){for(o=0;o<e;o++)s.set(o,l,0);for(s.set(l,l,1),i=l;i<t;i++)if(r.get(l,l)!==0){for(h=0,o=l;o<e;o++)h+=r.get(o,l)*s.get(o,i);for(h=-h/r.get(l,l),o=l;o<e;o++)s.set(o,i,s.get(o,i)+h*r.get(o,l))}}return s}}class St{constructor(r,e={}){if(r=ot.checkMatrix(r),r.isEmpty())throw new Error("Matrix must be non-empty");let t=r.rows,s=r.columns;const{computeLeftSingularVectors:o=!0,computeRightSingularVectors:i=!0,autoTranspose:l=!1}=e;let h=!!o,u=!!i,w=!1,f;if(t<s)if(!l)f=r.clone(),console.warn("Computing SVD on a matrix with more columns than rows. Consider enabling autoTranspose");else{f=r.transpose(),t=f.rows,s=f.columns,w=!0;let g=h;h=u,u=g}else f=r.clone();let j=Math.min(t,s),k=Math.min(t+1,s),y=new Float64Array(k),b=new N(t,j),R=new N(s,s),c=new Float64Array(s),v=new Float64Array(t),x=new Float64Array(k);for(let g=0;g<k;g++)x[g]=g;let $=Math.min(t-1,s),L=Math.max(0,Math.min(s-2,t)),X=Math.max($,L);for(let g=0;g<X;g++){if(g<$){y[g]=0;for(let S=g;S<t;S++)y[g]=mt(y[g],f.get(S,g));if(y[g]!==0){f.get(g,g)<0&&(y[g]=-y[g]);for(let S=g;S<t;S++)f.set(S,g,f.get(S,g)/y[g]);f.set(g,g,f.get(g,g)+1)}y[g]=-y[g]}for(let S=g+1;S<s;S++){if(g<$&&y[g]!==0){let C=0;for(let E=g;E<t;E++)C+=f.get(E,g)*f.get(E,S);C=-C/f.get(g,g);for(let E=g;E<t;E++)f.set(E,S,f.get(E,S)+C*f.get(E,g))}c[S]=f.get(g,S)}if(h&&g<$)for(let S=g;S<t;S++)b.set(S,g,f.get(S,g));if(g<L){c[g]=0;for(let S=g+1;S<s;S++)c[g]=mt(c[g],c[S]);if(c[g]!==0){c[g+1]<0&&(c[g]=0-c[g]);for(let S=g+1;S<s;S++)c[S]/=c[g];c[g+1]+=1}if(c[g]=-c[g],g+1<t&&c[g]!==0){for(let S=g+1;S<t;S++)v[S]=0;for(let S=g+1;S<t;S++)for(let C=g+1;C<s;C++)v[S]+=c[C]*f.get(S,C);for(let S=g+1;S<s;S++){let C=-c[S]/c[g+1];for(let E=g+1;E<t;E++)f.set(E,S,f.get(E,S)+C*v[E])}}if(u)for(let S=g+1;S<s;S++)R.set(S,g,c[S])}}let P=Math.min(s,t+1);if($<s&&(y[$]=f.get($,$)),t<P&&(y[P-1]=0),L+1<P&&(c[L]=f.get(L,P-1)),c[P-1]=0,h){for(let g=$;g<j;g++){for(let S=0;S<t;S++)b.set(S,g,0);b.set(g,g,1)}for(let g=$-1;g>=0;g--)if(y[g]!==0){for(let S=g+1;S<j;S++){let C=0;for(let E=g;E<t;E++)C+=b.get(E,g)*b.get(E,S);C=-C/b.get(g,g);for(let E=g;E<t;E++)b.set(E,S,b.get(E,S)+C*b.get(E,g))}for(let S=g;S<t;S++)b.set(S,g,-b.get(S,g));b.set(g,g,1+b.get(g,g));for(let S=0;S<g-1;S++)b.set(S,g,0)}else{for(let S=0;S<t;S++)b.set(S,g,0);b.set(g,g,1)}}if(u)for(let g=s-1;g>=0;g--){if(g<L&&c[g]!==0)for(let S=g+1;S<s;S++){let C=0;for(let E=g+1;E<s;E++)C+=R.get(E,g)*R.get(E,S);C=-C/R.get(g+1,g);for(let E=g+1;E<s;E++)R.set(E,S,R.get(E,S)+C*R.get(E,g))}for(let S=0;S<s;S++)R.set(S,g,0);R.set(g,g,1)}let D=P-1,J=Number.EPSILON;for(;P>0;){let g,S;for(g=P-2;g>=-1&&g!==-1;g--){const C=Number.MIN_VALUE+J*Math.abs(y[g]+Math.abs(y[g+1]));if(Math.abs(c[g])<=C||Number.isNaN(c[g])){c[g]=0;break}}if(g===P-2)S=4;else{let C;for(C=P-1;C>=g&&C!==g;C--){let E=(C!==P?Math.abs(c[C]):0)+(C!==g+1?Math.abs(c[C-1]):0);if(Math.abs(y[C])<=J*E){y[C]=0;break}}C===g?S=3:C===P-1?S=1:(S=2,g=C)}switch(g++,S){case 1:{let C=c[P-2];c[P-2]=0;for(let E=P-2;E>=g;E--){let Z=mt(y[E],C),B=y[E]/Z,Y=C/Z;if(y[E]=Z,E!==g&&(C=-Y*c[E-1],c[E-1]=B*c[E-1]),u)for(let K=0;K<s;K++)Z=B*R.get(K,E)+Y*R.get(K,P-1),R.set(K,P-1,-Y*R.get(K,E)+B*R.get(K,P-1)),R.set(K,E,Z)}break}case 2:{let C=c[g-1];c[g-1]=0;for(let E=g;E<P;E++){let Z=mt(y[E],C),B=y[E]/Z,Y=C/Z;if(y[E]=Z,C=-Y*c[E],c[E]=B*c[E],h)for(let K=0;K<t;K++)Z=B*b.get(K,E)+Y*b.get(K,g-1),b.set(K,g-1,-Y*b.get(K,E)+B*b.get(K,g-1)),b.set(K,E,Z)}break}case 3:{const C=Math.max(Math.abs(y[P-1]),Math.abs(y[P-2]),Math.abs(c[P-2]),Math.abs(y[g]),Math.abs(c[g])),E=y[P-1]/C,Z=y[P-2]/C,B=c[P-2]/C,Y=y[g]/C,K=c[g]/C,tt=((Z+E)*(Z-E)+B*B)/2,lt=E*B*(E*B);let A=0;(tt!==0||lt!==0)&&(tt<0?A=0-Math.sqrt(tt*tt+lt):A=Math.sqrt(tt*tt+lt),A=lt/(tt+A));let ct=(Y+E)*(Y-E)+A,wt=Y*K;for(let _=g;_<P-1;_++){let et=mt(ct,wt);et===0&&(et=Number.MIN_VALUE);let nt=ct/et,it=wt/et;if(_!==g&&(c[_-1]=et),ct=nt*y[_]+it*c[_],c[_]=nt*c[_]-it*y[_],wt=it*y[_+1],y[_+1]=nt*y[_+1],u)for(let H=0;H<s;H++)et=nt*R.get(H,_)+it*R.get(H,_+1),R.set(H,_+1,-it*R.get(H,_)+nt*R.get(H,_+1)),R.set(H,_,et);if(et=mt(ct,wt),et===0&&(et=Number.MIN_VALUE),nt=ct/et,it=wt/et,y[_]=et,ct=nt*c[_]+it*y[_+1],y[_+1]=-it*c[_]+nt*y[_+1],wt=it*c[_+1],c[_+1]=nt*c[_+1],h&&_<t-1)for(let H=0;H<t;H++)et=nt*b.get(H,_)+it*b.get(H,_+1),b.set(H,_+1,-it*b.get(H,_)+nt*b.get(H,_+1)),b.set(H,_,et)}c[P-2]=ct;break}case 4:{if(y[g]<=0&&(y[g]=y[g]<0?-y[g]:0,u))for(let C=0;C<=D;C++)R.set(C,g,-R.get(C,g));for(;g<D&&!(y[g]>=y[g+1]);){let C=y[g];if(y[g]=y[g+1],y[g+1]=C,u&&g<s-1)for(let E=0;E<s;E++)C=R.get(E,g+1),R.set(E,g+1,R.get(E,g)),R.set(E,g,C);if(h&&g<t-1)for(let E=0;E<t;E++)C=b.get(E,g+1),b.set(E,g+1,b.get(E,g)),b.set(E,g,C);g++}P--;break}}}if(w){let g=R;R=b,b=g}this.m=t,this.n=s,this.s=y,this.U=b,this.V=R}solve(r){let e=r,t=this.threshold,s=this.s.length,o=N.zeros(s,s);for(let j=0;j<s;j++)Math.abs(this.s[j])<=t?o.set(j,j,0):o.set(j,j,1/this.s[j]);let i=this.U,l=this.rightSingularVectors,h=l.mmul(o),u=l.rows,w=i.rows,f=N.zeros(u,w);for(let j=0;j<u;j++)for(let k=0;k<w;k++){let y=0;for(let b=0;b<s;b++)y+=h.get(j,b)*i.get(k,b);f.set(j,k,y)}return f.mmul(e)}solveForDiagonal(r){return this.solve(N.diag(r))}inverse(){let r=this.V,e=this.threshold,t=r.rows,s=r.columns,o=new N(t,this.s.length);for(let w=0;w<t;w++)for(let f=0;f<s;f++)Math.abs(this.s[f])>e&&o.set(w,f,r.get(w,f)/this.s[f]);let i=this.U,l=i.rows,h=i.columns,u=new N(t,l);for(let w=0;w<t;w++)for(let f=0;f<l;f++){let j=0;for(let k=0;k<h;k++)j+=o.get(w,k)*i.get(f,k);u.set(w,f,j)}return u}get condition(){return this.s[0]/this.s[Math.min(this.m,this.n)-1]}get norm2(){return this.s[0]}get rank(){let r=Math.max(this.m,this.n)*this.s[0]*Number.EPSILON,e=0,t=this.s;for(let s=0,o=t.length;s<o;s++)t[s]>r&&e++;return e}get diagonal(){return Array.from(this.s)}get threshold(){return Number.EPSILON/2*Math.max(this.m,this.n)*this.s[0]}get leftSingularVectors(){return this.U}get rightSingularVectors(){return this.V}get diagonalMatrix(){return N.diag(this.s)}}function Le(n,r=!1){return n=ot.checkMatrix(n),r?new St(n).inverse():Ht(n,N.eye(n.rows))}function Ht(n,r,e=!1){return n=ot.checkMatrix(n),r=ot.checkMatrix(r),e?new St(n).solve(r):n.isSquare()?new Ft(n).solve(r):new Gt(n).solve(r)}function Dt(n){if(n=N.checkMatrix(n),n.isSquare()){if(n.columns===0)return 1;let r,e,t,s;if(n.columns===2)return r=n.get(0,0),e=n.get(0,1),t=n.get(1,0),s=n.get(1,1),r*s-e*t;if(n.columns===3){let o,i,l;return o=new Pt(n,[1,2],[1,2]),i=new Pt(n,[1,2],[0,2]),l=new Pt(n,[1,2],[0,1]),r=n.get(0,0),e=n.get(0,1),t=n.get(0,2),r*Dt(o)-e*Dt(i)+t*Dt(l)}else return new Ft(n).determinant}else throw Error("determinant can only be calculated for a square matrix")}function Oe(n,r){let e=[];for(let t=0;t<n;t++)t!==r&&e.push(t);return e}function Ve(n,r,e,t=1e-9,s=1e-9){if(n>s)return new Array(r.rows+1).fill(0);{let o=r.addRow(e,[0]);for(let i=0;i<o.rows;i++)Math.abs(o.get(i,0))<t&&o.set(i,0,0);return o.to1DArray()}}function Ue(n,r={}){const{thresholdValue:e=1e-9,thresholdError:t=1e-9}=r;n=N.checkMatrix(n);let s=n.rows,o=new N(s,s);for(let i=0;i<s;i++){let l=N.columnVector(n.getRow(i)),h=n.subMatrixRow(Oe(s,i)).transpose(),w=new St(h).solve(l),f=N.sub(l,h.mmul(w)).abs().max();o.setRow(i,Ve(f,w,i,e,t))}return o}function Ge(n,r=Number.EPSILON){if(n=N.checkMatrix(n),n.isEmpty())return n.transpose();let e=new St(n,{autoTranspose:!0}),t=e.leftSingularVectors,s=e.rightSingularVectors,o=e.diagonal;for(let i=0;i<o.length;i++)Math.abs(o[i])>r?o[i]=1/o[i]:o[i]=0;return s.mmul(N.diag(o).mmul(t.transpose()))}function _e(n,r=n,e={}){n=new N(n);let t=!1;if(typeof r=="object"&&!N.isMatrix(r)&&!a.isAnyArray(r)?(e=r,r=n,t=!0):r=new N(r),n.rows!==r.rows)throw new TypeError("Both matrices must have the same number of rows");const{center:s=!0}=e;s&&(n=n.center("column"),t||(r=r.center("column")));const o=n.transpose().mmul(r);for(let i=0;i<o.rows;i++)for(let l=0;l<o.columns;l++)o.set(i,l,o.get(i,l)*(1/(n.rows-1)));return o}function Be(n,r=n,e={}){n=new N(n);let t=!1;if(typeof r=="object"&&!N.isMatrix(r)&&!a.isAnyArray(r)?(e=r,r=n,t=!0):r=new N(r),n.rows!==r.rows)throw new TypeError("Both matrices must have the same number of rows");const{center:s=!0,scale:o=!0}=e;s&&(n.center("column"),t||r.center("column")),o&&(n.scale("column"),t||r.scale("column"));const i=n.standardDeviation("column",{unbiased:!0}),l=t?i:r.standardDeviation("column",{unbiased:!0}),h=n.transpose().mmul(r);for(let u=0;u<h.rows;u++)for(let w=0;w<h.columns;w++)h.set(u,w,h.get(u,w)*(1/(i[u]*l[w]))*(1/(n.rows-1)));return h}class te{constructor(r,e={}){const{assumeSymmetric:t=!1}=e;if(r=ot.checkMatrix(r),!r.isSquare())throw new Error("Matrix is not a square matrix");if(r.isEmpty())throw new Error("Matrix must be non-empty");let s=r.columns,o=new N(s,s),i=new Float64Array(s),l=new Float64Array(s),h=r,u,w,f=!1;if(t?f=!0:f=r.isSymmetric(),f){for(u=0;u<s;u++)for(w=0;w<s;w++)o.set(u,w,h.get(u,w));We(s,l,i,o),Je(s,l,i,o)}else{let j=new N(s,s),k=new Float64Array(s);for(w=0;w<s;w++)for(u=0;u<s;u++)j.set(u,w,h.get(u,w));Qe(s,j,k,o),Ye(s,l,i,o,j)}this.n=s,this.e=l,this.d=i,this.V=o}get realEigenvalues(){return Array.from(this.d)}get imaginaryEigenvalues(){return Array.from(this.e)}get eigenvectorMatrix(){return this.V}get diagonalMatrix(){let r=this.n,e=this.e,t=this.d,s=new N(r,r),o,i;for(o=0;o<r;o++){for(i=0;i<r;i++)s.set(o,i,0);s.set(o,o,t[o]),e[o]>0?s.set(o,o+1,e[o]):e[o]<0&&s.set(o,o-1,e[o])}return s}}function We(n,r,e,t){let s,o,i,l,h,u,w,f;for(h=0;h<n;h++)e[h]=t.get(n-1,h);for(l=n-1;l>0;l--){for(f=0,i=0,u=0;u<l;u++)f=f+Math.abs(e[u]);if(f===0)for(r[l]=e[l-1],h=0;h<l;h++)e[h]=t.get(l-1,h),t.set(l,h,0),t.set(h,l,0);else{for(u=0;u<l;u++)e[u]/=f,i+=e[u]*e[u];for(s=e[l-1],o=Math.sqrt(i),s>0&&(o=-o),r[l]=f*o,i=i-s*o,e[l-1]=s-o,h=0;h<l;h++)r[h]=0;for(h=0;h<l;h++){for(s=e[h],t.set(h,l,s),o=r[h]+t.get(h,h)*s,u=h+1;u<=l-1;u++)o+=t.get(u,h)*e[u],r[u]+=t.get(u,h)*s;r[h]=o}for(s=0,h=0;h<l;h++)r[h]/=i,s+=r[h]*e[h];for(w=s/(i+i),h=0;h<l;h++)r[h]-=w*e[h];for(h=0;h<l;h++){for(s=e[h],o=r[h],u=h;u<=l-1;u++)t.set(u,h,t.get(u,h)-(s*r[u]+o*e[u]));e[h]=t.get(l-1,h),t.set(l,h,0)}}e[l]=i}for(l=0;l<n-1;l++){if(t.set(n-1,l,t.get(l,l)),t.set(l,l,1),i=e[l+1],i!==0){for(u=0;u<=l;u++)e[u]=t.get(u,l+1)/i;for(h=0;h<=l;h++){for(o=0,u=0;u<=l;u++)o+=t.get(u,l+1)*t.get(u,h);for(u=0;u<=l;u++)t.set(u,h,t.get(u,h)-o*e[u])}}for(u=0;u<=l;u++)t.set(u,l+1,0)}for(h=0;h<n;h++)e[h]=t.get(n-1,h),t.set(n-1,h,0);t.set(n-1,n-1,1),r[0]=0}function Je(n,r,e,t){let s,o,i,l,h,u,w,f,j,k,y,b,R,c,v,x;for(i=1;i<n;i++)r[i-1]=r[i];r[n-1]=0;let $=0,L=0,X=Number.EPSILON;for(u=0;u<n;u++){for(L=Math.max(L,Math.abs(e[u])+Math.abs(r[u])),w=u;w<n&&!(Math.abs(r[w])<=X*L);)w++;if(w>u)do{for(s=e[u],f=(e[u+1]-s)/(2*r[u]),j=mt(f,1),f<0&&(j=-j),e[u]=r[u]/(f+j),e[u+1]=r[u]*(f+j),k=e[u+1],o=s-e[u],i=u+2;i<n;i++)e[i]-=o;for($=$+o,f=e[w],y=1,b=y,R=y,c=r[u+1],v=0,x=0,i=w-1;i>=u;i--)for(R=b,b=y,x=v,s=y*r[i],o=y*f,j=mt(f,r[i]),r[i+1]=v*j,v=r[i]/j,y=f/j,f=y*e[i]-v*s,e[i+1]=o+v*(y*s+v*e[i]),h=0;h<n;h++)o=t.get(h,i+1),t.set(h,i+1,v*t.get(h,i)+y*o),t.set(h,i,y*t.get(h,i)-v*o);f=-v*x*R*c*r[u]/k,r[u]=v*f,e[u]=y*f}while(Math.abs(r[u])>X*L);e[u]=e[u]+$,r[u]=0}for(i=0;i<n-1;i++){for(h=i,f=e[i],l=i+1;l<n;l++)e[l]<f&&(h=l,f=e[l]);if(h!==i)for(e[h]=e[i],e[i]=f,l=0;l<n;l++)f=t.get(l,i),t.set(l,i,t.get(l,h)),t.set(l,h,f)}}function Qe(n,r,e,t){let s=0,o=n-1,i,l,h,u,w,f,j;for(f=s+1;f<=o-1;f++){for(j=0,u=f;u<=o;u++)j=j+Math.abs(r.get(u,f-1));if(j!==0){for(h=0,u=o;u>=f;u--)e[u]=r.get(u,f-1)/j,h+=e[u]*e[u];for(l=Math.sqrt(h),e[f]>0&&(l=-l),h=h-e[f]*l,e[f]=e[f]-l,w=f;w<n;w++){for(i=0,u=o;u>=f;u--)i+=e[u]*r.get(u,w);for(i=i/h,u=f;u<=o;u++)r.set(u,w,r.get(u,w)-i*e[u])}for(u=0;u<=o;u++){for(i=0,w=o;w>=f;w--)i+=e[w]*r.get(u,w);for(i=i/h,w=f;w<=o;w++)r.set(u,w,r.get(u,w)-i*e[w])}e[f]=j*e[f],r.set(f,f-1,j*l)}}for(u=0;u<n;u++)for(w=0;w<n;w++)t.set(u,w,u===w?1:0);for(f=o-1;f>=s+1;f--)if(r.get(f,f-1)!==0){for(u=f+1;u<=o;u++)e[u]=r.get(u,f-1);for(w=f;w<=o;w++){for(l=0,u=f;u<=o;u++)l+=e[u]*t.get(u,w);for(l=l/e[f]/r.get(f,f-1),u=f;u<=o;u++)t.set(u,w,t.get(u,w)+l*e[u])}}}function Ye(n,r,e,t,s){let o=n-1,i=0,l=n-1,h=Number.EPSILON,u=0,w=0,f=0,j=0,k=0,y=0,b=0,R=0,c,v,x,$,L,X,P,D,J,g,S,C,E,Z,B;for(c=0;c<n;c++)for((c<i||c>l)&&(e[c]=s.get(c,c),r[c]=0),v=Math.max(c-1,0);v<n;v++)w=w+Math.abs(s.get(c,v));for(;o>=i;){for($=o;$>i&&(y=Math.abs(s.get($-1,$-1))+Math.abs(s.get($,$)),y===0&&(y=w),!(Math.abs(s.get($,$-1))<h*y));)$--;if($===o)s.set(o,o,s.get(o,o)+u),e[o]=s.get(o,o),r[o]=0,o--,R=0;else if($===o-1){if(P=s.get(o,o-1)*s.get(o-1,o),f=(s.get(o-1,o-1)-s.get(o,o))/2,j=f*f+P,b=Math.sqrt(Math.abs(j)),s.set(o,o,s.get(o,o)+u),s.set(o-1,o-1,s.get(o-1,o-1)+u),D=s.get(o,o),j>=0){for(b=f>=0?f+b:f-b,e[o-1]=D+b,e[o]=e[o-1],b!==0&&(e[o]=D-P/b),r[o-1]=0,r[o]=0,D=s.get(o,o-1),y=Math.abs(D)+Math.abs(b),f=D/y,j=b/y,k=Math.sqrt(f*f+j*j),f=f/k,j=j/k,v=o-1;v<n;v++)b=s.get(o-1,v),s.set(o-1,v,j*b+f*s.get(o,v)),s.set(o,v,j*s.get(o,v)-f*b);for(c=0;c<=o;c++)b=s.get(c,o-1),s.set(c,o-1,j*b+f*s.get(c,o)),s.set(c,o,j*s.get(c,o)-f*b);for(c=i;c<=l;c++)b=t.get(c,o-1),t.set(c,o-1,j*b+f*t.get(c,o)),t.set(c,o,j*t.get(c,o)-f*b)}else e[o-1]=D+f,e[o]=D+f,r[o-1]=b,r[o]=-b;o=o-2,R=0}else{if(D=s.get(o,o),J=0,P=0,$<o&&(J=s.get(o-1,o-1),P=s.get(o,o-1)*s.get(o-1,o)),R===10){for(u+=D,c=i;c<=o;c++)s.set(c,c,s.get(c,c)-D);y=Math.abs(s.get(o,o-1))+Math.abs(s.get(o-1,o-2)),D=J=.75*y,P=-.4375*y*y}if(R===30&&(y=(J-D)/2,y=y*y+P,y>0)){for(y=Math.sqrt(y),J<D&&(y=-y),y=D-P/((J-D)/2+y),c=i;c<=o;c++)s.set(c,c,s.get(c,c)-y);u+=y,D=J=P=.964}for(R=R+1,L=o-2;L>=$&&(b=s.get(L,L),k=D-b,y=J-b,f=(k*y-P)/s.get(L+1,L)+s.get(L,L+1),j=s.get(L+1,L+1)-b-k-y,k=s.get(L+2,L+1),y=Math.abs(f)+Math.abs(j)+Math.abs(k),f=f/y,j=j/y,k=k/y,!(L===$||Math.abs(s.get(L,L-1))*(Math.abs(j)+Math.abs(k))<h*(Math.abs(f)*(Math.abs(s.get(L-1,L-1))+Math.abs(b)+Math.abs(s.get(L+1,L+1))))));)L--;for(c=L+2;c<=o;c++)s.set(c,c-2,0),c>L+2&&s.set(c,c-3,0);for(x=L;x<=o-1&&(Z=x!==o-1,x!==L&&(f=s.get(x,x-1),j=s.get(x+1,x-1),k=Z?s.get(x+2,x-1):0,D=Math.abs(f)+Math.abs(j)+Math.abs(k),D!==0&&(f=f/D,j=j/D,k=k/D)),D!==0);x++)if(y=Math.sqrt(f*f+j*j+k*k),f<0&&(y=-y),y!==0){for(x!==L?s.set(x,x-1,-y*D):$!==L&&s.set(x,x-1,-s.get(x,x-1)),f=f+y,D=f/y,J=j/y,b=k/y,j=j/f,k=k/f,v=x;v<n;v++)f=s.get(x,v)+j*s.get(x+1,v),Z&&(f=f+k*s.get(x+2,v),s.set(x+2,v,s.get(x+2,v)-f*b)),s.set(x,v,s.get(x,v)-f*D),s.set(x+1,v,s.get(x+1,v)-f*J);for(c=0;c<=Math.min(o,x+3);c++)f=D*s.get(c,x)+J*s.get(c,x+1),Z&&(f=f+b*s.get(c,x+2),s.set(c,x+2,s.get(c,x+2)-f*k)),s.set(c,x,s.get(c,x)-f),s.set(c,x+1,s.get(c,x+1)-f*j);for(c=i;c<=l;c++)f=D*t.get(c,x)+J*t.get(c,x+1),Z&&(f=f+b*t.get(c,x+2),t.set(c,x+2,t.get(c,x+2)-f*k)),t.set(c,x,t.get(c,x)-f),t.set(c,x+1,t.get(c,x+1)-f*j)}}}if(w!==0){for(o=n-1;o>=0;o--)if(f=e[o],j=r[o],j===0)for($=o,s.set(o,o,1),c=o-1;c>=0;c--){for(P=s.get(c,c)-f,k=0,v=$;v<=o;v++)k=k+s.get(c,v)*s.get(v,o);if(r[c]<0)b=P,y=k;else if($=c,r[c]===0?s.set(c,o,P!==0?-k/P:-k/(h*w)):(D=s.get(c,c+1),J=s.get(c+1,c),j=(e[c]-f)*(e[c]-f)+r[c]*r[c],X=(D*y-b*k)/j,s.set(c,o,X),s.set(c+1,o,Math.abs(D)>Math.abs(b)?(-k-P*X)/D:(-y-J*X)/b)),X=Math.abs(s.get(c,o)),h*X*X>1)for(v=c;v<=o;v++)s.set(v,o,s.get(v,o)/X)}else if(j<0)for($=o-1,Math.abs(s.get(o,o-1))>Math.abs(s.get(o-1,o))?(s.set(o-1,o-1,j/s.get(o,o-1)),s.set(o-1,o,-(s.get(o,o)-f)/s.get(o,o-1))):(B=zt(0,-s.get(o-1,o),s.get(o-1,o-1)-f,j),s.set(o-1,o-1,B[0]),s.set(o-1,o,B[1])),s.set(o,o-1,0),s.set(o,o,1),c=o-2;c>=0;c--){for(g=0,S=0,v=$;v<=o;v++)g=g+s.get(c,v)*s.get(v,o-1),S=S+s.get(c,v)*s.get(v,o);if(P=s.get(c,c)-f,r[c]<0)b=P,k=g,y=S;else if($=c,r[c]===0?(B=zt(-g,-S,P,j),s.set(c,o-1,B[0]),s.set(c,o,B[1])):(D=s.get(c,c+1),J=s.get(c+1,c),C=(e[c]-f)*(e[c]-f)+r[c]*r[c]-j*j,E=(e[c]-f)*2*j,C===0&&E===0&&(C=h*w*(Math.abs(P)+Math.abs(j)+Math.abs(D)+Math.abs(J)+Math.abs(b))),B=zt(D*k-b*g+j*S,D*y-b*S-j*g,C,E),s.set(c,o-1,B[0]),s.set(c,o,B[1]),Math.abs(D)>Math.abs(b)+Math.abs(j)?(s.set(c+1,o-1,(-g-P*s.get(c,o-1)+j*s.get(c,o))/D),s.set(c+1,o,(-S-P*s.get(c,o)-j*s.get(c,o-1))/D)):(B=zt(-k-J*s.get(c,o-1),-y-J*s.get(c,o),b,j),s.set(c+1,o-1,B[0]),s.set(c+1,o,B[1]))),X=Math.max(Math.abs(s.get(c,o-1)),Math.abs(s.get(c,o))),h*X*X>1)for(v=c;v<=o;v++)s.set(v,o-1,s.get(v,o-1)/X),s.set(v,o,s.get(v,o)/X)}for(c=0;c<n;c++)if(c<i||c>l)for(v=c;v<n;v++)t.set(c,v,s.get(c,v));for(v=n-1;v>=i;v--)for(c=i;c<=l;c++){for(b=0,x=i;x<=Math.min(v,l);x++)b=b+t.get(c,x)*s.get(x,v);t.set(c,v,b)}}}function zt(n,r,e,t){let s,o;return Math.abs(e)>Math.abs(t)?(s=t/e,o=e+s*t,[(n+s*r)/o,(r-s*n)/o]):(s=e/t,o=t+s*e,[(s*n+r)/o,(s*r-n)/o])}class ee{constructor(r){if(r=ot.checkMatrix(r),!r.isSymmetric())throw new Error("Matrix is not symmetric");let e=r,t=e.rows,s=new N(t,t),o=!0,i,l,h;for(l=0;l<t;l++){let u=0;for(h=0;h<l;h++){let w=0;for(i=0;i<h;i++)w+=s.get(h,i)*s.get(l,i);w=(e.get(l,h)-w)/s.get(h,h),s.set(l,h,w),u=u+w*w}for(u=e.get(l,l)-u,o&&(o=u>0),s.set(l,l,Math.sqrt(Math.max(u,0))),h=l+1;h<t;h++)s.set(l,h,0)}this.L=s,this.positiveDefinite=o}isPositiveDefinite(){return this.positiveDefinite}solve(r){r=ot.checkMatrix(r);let e=this.L,t=e.rows;if(r.rows!==t)throw new Error("Matrix dimensions do not match");if(this.isPositiveDefinite()===!1)throw new Error("Matrix is not positive definite");let s=r.columns,o=r.clone(),i,l,h;for(h=0;h<t;h++)for(l=0;l<s;l++){for(i=0;i<h;i++)o.set(h,l,o.get(h,l)-o.get(i,l)*e.get(h,i));o.set(h,l,o.get(h,l)/e.get(h,h))}for(h=t-1;h>=0;h--)for(l=0;l<s;l++){for(i=h+1;i<t;i++)o.set(h,l,o.get(h,l)-o.get(i,l)*e.get(i,h));o.set(h,l,o.get(h,l)/e.get(h,h))}return o}get lowerTriangularMatrix(){return this.L}}class se{constructor(r,e={}){r=ot.checkMatrix(r);let{Y:t}=e;const{scaleScores:s=!1,maxIterations:o=1e3,terminationCriteria:i=1e-10}=e;let l;if(t){if(a.isAnyArray(t)&&typeof t[0]=="number"?t=N.columnVector(t):t=ot.checkMatrix(t),t.rows!==r.rows)throw new Error("Y should have the same number of rows as X");l=t.getColumnVector(0)}else l=r.getColumnVector(0);let h=1,u,w,f,j;for(let k=0;k<o&&h>i;k++)f=r.transpose().mmul(l).div(l.transpose().mmul(l).get(0,0)),f=f.div(f.norm()),u=r.mmul(f).div(f.transpose().mmul(f).get(0,0)),k>0&&(h=u.clone().sub(j).pow(2).sum()),j=u.clone(),t?(w=t.transpose().mmul(u).div(u.transpose().mmul(u).get(0,0)),w=w.div(w.norm()),l=t.mmul(w).div(w.transpose().mmul(w).get(0,0))):l=u;if(t){let k=r.transpose().mmul(u).div(u.transpose().mmul(u).get(0,0));k=k.div(k.norm());let y=r.clone().sub(u.clone().mmul(k.transpose())),b=l.transpose().mmul(u).div(u.transpose().mmul(u).get(0,0)),R=t.clone().sub(u.clone().mulS(b.get(0,0)).mmul(w.transpose()));this.t=u,this.p=k.transpose(),this.w=f.transpose(),this.q=w,this.u=l,this.s=u.transpose().mmul(u),this.xResidual=y,this.yResidual=R,this.betas=b}else this.w=f.transpose(),this.s=u.transpose().mmul(u).sqrt(),s?this.t=u.clone().div(this.s.get(0,0)):this.t=u,this.xResidual=r.sub(u.mmul(f.transpose()))}}return V.AbstractMatrix=O,V.CHO=ee,V.CholeskyDecomposition=ee,V.DistanceMatrix=qt,V.EVD=te,V.EigenvalueDecomposition=te,V.LU=Ft,V.LuDecomposition=Ft,V.Matrix=N,V.MatrixColumnSelectionView=xe,V.MatrixColumnView=Ce,V.MatrixFlipColumnView=Te,V.MatrixFlipRowView=qe,V.MatrixRowSelectionView=Fe,V.MatrixRowView=Pe,V.MatrixSelectionView=Pt,V.MatrixSubView=De,V.MatrixTransposeView=ze,V.NIPALS=se,V.Nipals=se,V.QR=Gt,V.QrDecomposition=Gt,V.SVD=St,V.SingularValueDecomposition=St,V.SymmetricMatrix=jt,V.WrapperMatrix1D=At,V.WrapperMatrix2D=ot,V.correlation=Be,V.covariance=_e,V.default=N,V.determinant=Dt,V.inverse=Le,V.linearDependencies=Ue,V.pseudoInverse=Ge,V.solve=Ht,V.wrap=$e,V}var Xt=Fs();const ie=us(Xt),Mt=Xt.Matrix;ie.Matrix?ie.Matrix:Xt.Matrix;const le=8,Ds=1/16777216,zs=15,$s=18,Ls=11;function Os(a,p){a>>>=0,p>>>=0;const m=a&65535;return((a-m)*p>>>0)+m*p>>>0}class Vs{constructor(p=Date.now()){this.state=new Uint32Array(4),this.init(p),this.random=this.getFloat.bind(this)}getUint32(){return this.nextState(),this.state[3]+this.state[2]>>>0}getFloat(){return(this.getUint32()>>>8)*Ds}init(p){if(!Number.isInteger(p))throw new TypeError("seed must be an integer");this.state[0]=p,this.state[1]=0,this.state[2]=0,this.state[3]=0;for(let m=1;m<le;m++)this.state[m&3]^=m+Os(1812433253,this.state[m-1&3]^this.state[m-1&3]>>>30>>>0)>>>0;this.periodCertification();for(let m=0;m<le;m++)this.nextState()}periodCertification(){this.state[0]===0&&this.state[1]===0&&this.state[2]===0&&this.state[3]===0&&(this.state[0]=88,this.state[1]=83,this.state[2]=65,this.state[3]=68)}nextState(){let p=this.state[0];p^=p<<zs,p^=p>>>$s,p^=this.state[3]<<Ls,this.state[0]=this.state[1],this.state[1]=this.state[2],this.state[2]=this.state[3],this.state[3]=p}}const Us=1e-8;function he(a,p={},m=Math.random){const{size:d=1,replace:M=!1,probabilities:q}=p;let T,I;if(typeof a=="number"?T=Gs(a):T=a.slice(),q){if(!M)throw new Error("choice with probabilities and no replacement is not implemented");if(q.length!==T.length)throw new Error("the length of probabilities option should be equal to the number of choices");I=[q[0]];for(let U=1;U<q.length;U++)I[U]=I[U-1]+q[U];if(Math.abs(1-I[I.length-1])>Us)throw new Error(`probabilities should sum to 1, but instead sums to ${I[I.length-1]}`)}if(M===!1&&d>T.length)throw new Error("size option is too large");const z=[];for(let U=0;U<d;U++){const G=_s(T.length,m,I);z.push(T[G]),M||T.splice(G,1)}return z}function Gs(a){const p=[];for(let m=0;m<a;m++)p.push(m);return p}function _s(a,p,m){const d=p();if(m){let M=0;for(;d>m[M];)M++;return M}else return Math.floor(d*a)}class Zt{constructor(p=Math.random){if(typeof p=="number"){const m=new Vs(p);this.randomGenerator=m.random}else this.randomGenerator=p}choice(p,m){return typeof p=="number"?he(p,m,this.randomGenerator):he(p,m,this.randomGenerator)}random(){return this.randomGenerator()}randInt(p,m){return m===void 0&&(m=p,p=0),p+Math.floor(this.randomGenerator()*(m-p))}randomSample(p){const m=[];for(let d=0;d<p;d++)m.push(this.random());return m}}function Bs(a,p,m){return new Zt(m).choice(a,{size:p})}function Ws(a,p,m,d){const M=new Zt(d);let q=new Array(p);q[0]=Math.floor(M.random()*a.length);{let T={dist:-1,index:-1};for(let I=0;I<a.length;++I)m[q[0]][I]>T.dist&&(T.dist=m[q[0]][I],T.index=I);q[1]=T.index;for(let I=2;I<p;++I){let z={dist:-1,index:-1};for(let U=0;U<a.length;++U){let G={dist:Number.MAX_VALUE,index:-1};for(let Q=0;Q<I;++Q)m[Q][U]<G.dist&&!q.includes(U)&&(G={dist:m[Q][U],index:U});G.dist!==Number.MAX_VALUE&&G.dist>z.dist&&(z={...G})}q[I]=z.index}}return q.map(T=>a[T])}function Js(a,p,m={}){const d=new Mt(a),M=d.rows,q=new Zt(m.seed),T=[],I=m.localTrials||2+Math.floor(Math.log(p)),z=q.randInt(M);T.push(d.getRow(z));let U=new Mt(1,d.rows);for(let W=0;W<d.rows;W++)U.set(0,W,Ut(d.getRow(W),T[0]));let G=[ue(U.getRow(0))];const Q=1/G[0][M-1];let st=Mt.mul(U,Q);for(let W=1;W<p;W++){const ft=q.choice(M,{replace:!0,size:I,probabilities:st.getRow(0)}),Et=d.selection(ft,Ys(d.columns)),vt=Qs(Et,d);let dt=1/0,yt=1/0,at=U;for(let bt=0;bt<I;bt++){const xt=Mt.min(U,[vt.getRow(bt)]),Tt=xt.sum();Tt<yt&&(dt=ft[bt],yt=Tt,at=xt)}T[W]=d.getRow(dt),U=at,G=[ue(U.getRow(0))],st=Mt.mul(U,1/G[0][M-1])}return T}function Qs(a,p){const m=new Mt(a.rows,p.rows);for(let d=0;d<a.rows;d++)for(let M=0;M<p.rows;M++)m.set(d,M,Ut(a.getRow(d),p.getRow(M)));return m}function Ys(a){let p=[];for(let m=0;m<a;m++)p.push(m);return p}function ue(a){let p=[a[0]];for(let m=1;m<a.length;m++)p[m]=p[m-1]+a[m];return p}const Xs={maxIterations:100,tolerance:1e-6,initialization:"kmeans++",distanceFunction:Ut};function Zs(a,p,m,d,M,q){m=ae(p,a,m,M.distanceFunction);let T=Ss(a,p,m,d),I=Ms(T,a,M.distanceFunction,M.tolerance);return new Es(m,T,I,q,M.distanceFunction)}function Ks(a,p,m){const d=Hs(m);ks(a,p);let M=As(a,p,d);d.maxIterations===0&&(d.maxIterations=Number.MAX_VALUE);let q=new Array(a.length),T=!1,I=0,z;for(;!T&&I<d.maxIterations;)z=Zs(M,a,q,p,d,++I),T=z.converged,M=z.centroids;if(!z)throw new Error("unreachable: no kmeans step executed");return z}function As(a,p,m){let d;if(Array.isArray(m.initialization)){if(m.initialization.length!==p)throw new Error("The initial centers should have the same length as K");d=m.initialization}else switch(m.initialization){case"kmeans++":d=Js(a,p,m);break;case"random":d=Bs(a,p,m.seed);break;case"mostDistant":d=Ws(a,p,bs(a,m.distanceFunction),m.seed);break;default:vs(m.initialization,"Unknown initialization method")}return d}function Hs(a){return{...Xs,...a}}function tr([a,p,m]){return`#${(1<<24|a<<16|p<<8|m).toString(16).slice(1).toUpperCase()}`}function er(a){return Ks(a,4,{}).centroids.map(tr)}function sr(a){return new Promise((p,m)=>{const d=document.createElement("canvas"),M=new Image;M.src=a,M.onload=()=>{d.width=M.width,d.height=M.height;const q=d.getContext("2d",{willReadFrequently:!0});if(!q)return m("Could not get canvas context");q.drawImage(M,0,0,M.width,M.height);const T=q.getImageData(0,0,M.width,M.height).data,I=[];for(let U=0;U<T.length;U+=4){const G=T[U],Q=T[U+1],st=T[U+2];I.push([G,Q,st])}const z=er(I);p(z)},M.onerror=()=>m("Failed to load image")})}function rr(){const{loading:a,preview:p,palette:m,image:d,isGenerating:M,fileInputRef:q,setIsGenerating:T,setPalette:I,setInitialState:z}=Vt(),{onChangeAction:U}=Rt(),G=()=>{var W;(W=q.current)==null||W.click()},Q=async()=>{try{if(T(!0),!p)throw new Error("Image has not loaded!");const W=await sr(p);I(W),T(!1)}catch(W){console.error(W)}},st=()=>{T(!0);const W=localStorage.getItem("saved_palettes");let ft=W?JSON.parse(W):[];localStorage.setItem("saved_palettes",JSON.stringify([...ft,{name:d==null?void 0:d.name,palette:m}])),setTimeout(()=>{z(),U(Qt.SAVELIST)},500)};return M?null:F.jsxs("div",{className:"flex flex-col gap-5 justify-center",children:[!m&&!d&&F.jsx(pt,{className:"!text-gray-500 text-center",children:"Upload a photo to generate its palette"}),F.jsxs("div",{className:"flex items-center justify-center gap-2",children:[d&&!m&&F.jsx(It,{className:"rounded-full bg-purple-500 !py-[0.5rem]",icon:ls,onClick:Q,disabled:a,children:F.jsx(pt,{children:"Generate"})}),m&&F.jsx(It,{className:"rounded-full bg-purple-500 !py-[0.5rem]",icon:hs,onClick:st,children:F.jsx(pt,{children:"Save"})}),F.jsx(It,{className:"rounded-full bg-purple-500 !py-[0.5rem]",icon:ys,onClick:G,children:F.jsx(pt,{children:d?"Replace":"Upload"})})]})]})}function or(){return F.jsxs(ms,{children:[F.jsx(ws,{}),F.jsx(ds,{}),F.jsx(ps,{}),F.jsx(rr,{})]})}function nr(){const[a,p]=ut.useState([]);return ut.useEffect(()=>{const m=localStorage.getItem("saved_palettes");m&&p(JSON.parse(m))},[]),F.jsxs("div",{className:"h-full w-full flex flex-wrap py-[2rem]",children:[a.length<1&&F.jsx(pt,{className:"text-center !text-gray-500",children:"No Saved Palette"}),a.map(m=>F.jsxs("div",{className:"flex flex-col items-center justify-center h-fit w-1/2 p-[1rem] cursor-pointer",children:[F.jsx(Ct,{className:"h-10 w-10 mb-10 cursorpointer",colorPaths:m.palette}),F.jsx(pt,{className:"w-full !text-gray-500 truncate text-ellipsis",children:m.name})]},JSON.stringify(m.palette)))]})}function hr(){const{action:a}=Rt(),p=()=>{if(a===Qt.GENERATE)return F.jsx(or,{});if(a===Qt.SAVELIST)return F.jsx(nr,{})};return F.jsxs(gs,{children:[F.jsx(cs,{}),F.jsx(as,{children:p()})]})}export{hr as default};
