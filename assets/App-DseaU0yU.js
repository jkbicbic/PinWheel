var os=Object.defineProperty;var re=a=>{throw TypeError(a)};var is=(a,w,p)=>w in a?os(a,w,{enumerable:!0,configurable:!0,writable:!0,value:p}):a[w]=p;var ne=(a,w,p)=>is(a,typeof w!="symbol"?w+"":w,p),Bt=(a,w,p)=>w.has(a)||re("Cannot "+p);var ht=(a,w,p)=>(Bt(a,w,"read from private field"),p?p.call(a):w.get(a)),Wt=(a,w,p)=>w.has(a)?re("Cannot add the same private member more than once"):w instanceof WeakSet?w.add(a):w.set(a,p),Ot=(a,w,p,d)=>(Bt(a,w,"write to private field"),d?d.call(a,p):w.set(a,p),p),Jt=(a,w,p)=>(Bt(a,w,"access private method"),p);import{j as P,u as vt,n as ls,L as xt,r as ut,I as fe,a as hs,N as Vt}from"./index-U2HJZOxY.js";function us(a){return a&&a.__esModule&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a}function ce(a){if(Object.prototype.hasOwnProperty.call(a,"__esModule"))return a;var w=a.default;if(typeof w=="function"){var p=function d(){return this instanceof d?Reflect.construct(w,arguments,this.constructor):w.apply(this,arguments)};p.prototype=w.prototype}else p={};return Object.defineProperty(p,"__esModule",{value:!0}),Object.keys(a).forEach(function(d){var M=Object.getOwnPropertyDescriptor(a,d);Object.defineProperty(p,d,M.get?M:{enumerable:!0,get:function(){return a[d]}})}),p}function Et({icon:a,children:w,onClick:p,className:d,disabled:M}){return P.jsxs("button",{className:`flex items-center gap-2 p-[1rem] w-fit cursor-pointer disabled:bg-gray-300 disabled:text-gray-500 ${d}`,onClick:p,disabled:M,children:[P.jsx("img",{src:a,alt:"icon"}),w]})}function at({children:a,className:w,style:p}){return P.jsx("p",{style:p,className:`font-[Poppins] text-white font-semibold ${w}`,children:a})}const fs="data:image/svg+xml,%3csvg%20width='24'%20height='25'%20viewBox='0%200%2024%2025'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cg%20id='menu_24px'%3e%3cpath%20id='icon/navigation/menu_24px'%20fill-rule='evenodd'%20clip-rule='evenodd'%20d='M4%208.10925C3.45%208.10925%203%207.65925%203%207.10925C3%206.55925%203.45%206.10925%204%206.10925H20C20.55%206.10925%2021%206.55925%2021%207.10925C21%207.65925%2020.55%208.10925%2020%208.10925H4ZM4%2013.1093H20C20.55%2013.1093%2021%2012.6593%2021%2012.1093C21%2011.5593%2020.55%2011.1093%2020%2011.1093H4C3.45%2011.1093%203%2011.5593%203%2012.1093C3%2012.6593%203.45%2013.1093%204%2013.1093ZM4%2018.1093H20C20.55%2018.1093%2021%2017.6593%2021%2017.1093C21%2016.5593%2020.55%2016.1093%2020%2016.1093H4C3.45%2016.1093%203%2016.5593%203%2017.1093C3%2017.6593%203.45%2018.1093%204%2018.1093Z'%20fill='black'%20fill-opacity='0.54'/%3e%3c/g%3e%3c/svg%3e";function cs(){const{isExpanded:a,onChangeAction:w}=vt(),p="shrink-0 h-full w-[80%] overflow-hidden relative",d=a?p+" left-0":p+" left-[-100%]";return P.jsx("div",{className:d,children:P.jsx("ul",{className:"h-full flex flex-col justify-center [&>li>button]:px-[2rem]",children:ls.map(M=>P.jsx("li",{children:P.jsx(Et,{icon:M.icon,onClick:()=>w(M.action),children:P.jsx(at,{children:M.text})})}))})})}function as({children:a}){const{isExpanded:w,onExpand:p}=vt(),d="shrink-0 h-full w-full overflow-hidden absolute top-0",M=w?d+" left-[80%]":d+" left-0";return P.jsx("div",{className:M,children:P.jsxs("div",{className:`flex flex-col overflow-auto bg-white h-full w-full shadow-xl rounded-2xl ${w?"scale-80 opacity-90":""}`,children:[P.jsxs("nav",{className:"sticky h-[4rem] w-full flex items-center justify-between px-[0.8rem] z-2",children:[P.jsx(Et,{icon:fs,onClick:p}),P.jsx(xt,{className:"justify-self-center [&>path]:fill-purple-600",isFull:!0}),P.jsx("div",{className:"w-[3.5rem]"})]}),P.jsx("div",{className:"flex-grow w-full overflow-auto p-[0.625rem]",children:a})]})})}function gs({children:a}){const{isExpanded:w}=vt();return P.jsx("div",{className:"flex items-center justify-center w-[100vw] h-[100vh]",children:P.jsx("div",{className:`flex w-[100vw] h-[100vh] relative overflow-hidden md:w-[20rem] md:h-[35.5rem] md:rounded-3xl bg-gradient-to-br ${w?" from-fuchsia-600 via-violet-600 to-purple-600 !transition-none":" from-fuchsia-50 to-fuchsia-50 !transition !delay-[0.3s]"}`,children:a})})}const ae=ut.createContext(void 0);function ms({children:a}){const[w,p]=ut.useState(null),[d,M]=ut.useState(null),[q,T]=ut.useState(!1),[N,z]=ut.useState(!1),[U,G]=ut.useState(null),[Q,st]=ut.useState(null),W=ut.useRef(null),ft=()=>{p(null),M(null),T(!1),z(!1),G(null),st(null)};return P.jsx(ae.Provider,{value:{image:w,setImage:p,preview:d,setPreview:M,loading:q,setLoading:T,isGenerating:N,setIsGenerating:z,palette:U,setPalette:G,selectedHex:Q,setSelectedHex:st,setInitialState:ft,fileInputRef:W},children:P.jsxs("div",{className:"w-full h-full flex flex-col gap-10 items-center justify-center",children:[a,N&&P.jsx(xt,{className:"h-10 w-10 animate-spin [&>path]:fill-purple-500"})]})})}function Ut(){const a=ut.useContext(ae);if(!a)throw new Error("useGenerate must be used within the Generate Provider");return a}function ws(){const{fileInputRef:a,setLoading:w,setImage:p,setPalette:d,setPreview:M}=Ut(),q=T=>{var z;const N=(z=T.target.files)==null?void 0:z[0];if(N&&N.type.startsWith("image/")){w(!0),p(N),d(null),setTimeout(()=>{M(URL.createObjectURL(N)),w(!1)},500);return}alert("Please select a valid image file.")};return P.jsx("input",{type:"file",accept:"image/*",ref:a,onChange:q,className:"hidden"})}function ps(){const{isGenerating:a,palette:w,image:p,preview:d,loading:M}=Ut();return!a&&!w&&p?P.jsx("div",{className:"h-[18rem] w-[18rem] bg-violet-400 rounded-2xl p-[0.625rem] flex items-center justify-center",children:!M&&d?P.jsx("img",{className:"w-full h-full object-contain rounded-lg",src:d,alt:"image to process"}):P.jsx(xt,{className:"h-5 w-5 animate-spin"})}):null}function ds(){const{image:a,palette:w,selectedHex:p,setSelectedHex:d}=Ut();return w?P.jsxs(P.Fragment,{children:[P.jsx(xt,{className:"mb-10 [&>path]:cursor-pointer",colorPaths:w,onClickHex:M=>d(M||null)}),P.jsx(at,{className:"!text-gray-500",children:a==null?void 0:a.name}),P.jsxs("div",{className:"flex items-center justify-center gap-2",children:[P.jsx("div",{style:{backgroundColor:p||"transparent"},className:"h-5 w-5 rounded-full"}),P.jsx(at,{style:{color:p||"transparent"},children:p})]})]}):null}const ys="data:image/svg+xml,%3csvg%20width='24'%20height='25'%20viewBox='0%200%2024%2025'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cg%20id='upload_24px'%3e%3cpath%20id='icon/file/upload_24px'%20fill-rule='evenodd'%20clip-rule='evenodd'%20d='M14%2016.5147H10C9.45%2016.5147%209%2016.0647%209%2015.5147V10.5147H7.41C6.52%2010.5147%206.08%209.43473%206.71%208.80473L11.3%204.21473C11.4868%204.02747%2011.7405%203.92224%2012.005%203.92224C12.2695%203.92224%2012.5232%204.02747%2012.71%204.21473L17.3%208.80473C17.93%209.43473%2017.48%2010.5147%2016.59%2010.5147H15V15.5147C15%2016.0647%2014.55%2016.5147%2014%2016.5147ZM18%2018.5147H6C5.45%2018.5147%205%2018.9647%205%2019.5147C5%2020.0647%205.45%2020.5147%206%2020.5147H18C18.55%2020.5147%2019%2020.0647%2019%2019.5147C19%2018.9647%2018.55%2018.5147%2018%2018.5147Z'%20fill='black'%20fill-opacity='0.54'/%3e%3c/g%3e%3c/svg%3e";function Gt(a,w){let p=0;for(let d=0;d<a.length;d++)p+=(a[d]-w[d])*(a[d]-w[d]);return p}const Qt={distanceFunction:Gt};function js(a,w,p=Qt){const d=p.distanceFunction||Qt.distanceFunction,M=p.similarityFunction||Qt.similarityFunction;let q=-1;if(typeof M=="function"){let T=Number.MIN_VALUE;for(let N=0;N<a.length;N++){const z=M(w,a[N]);z>T&&(T=z,q=N)}}else if(typeof d=="function"){let T=Number.MAX_VALUE;for(let N=0;N<a.length;N++){const z=d(w,a[N]);z<T&&(T=z,q=N)}}else throw new Error("A similarity or distance function it's required");return q}function bs(a,w){let p=new Array(a.length);for(let d=0;d<a.length;++d)for(let M=d;M<a.length;++M){p[d]||(p[d]=new Array(a.length)),p[M]||(p[M]=new Array(a.length));const q=w(a[d],a[M]);p[d][M]=q,p[M][d]=q}return p}function ge(a,w,p,d){for(let M=0;M<a.length;M++)p[M]=js(w,a[M],{distanceFunction:d});return p}function Ss(a,w,p,d){const M=w[0].length;let q=new Array(d),T=new Array(d);for(let N=0;N<d;N++){q[N]=new Array(M),T[N]=0;for(let z=0;z<M;z++)q[N][z]=0}for(let N=0;N<w.length;N++){T[p[N]]++;for(let z=0;z<M;z++)q[p[N]][z]+=w[N][z]}for(let N=0;N<d;N++)for(let z=0;z<M;z++)T[N]?q[N][z]/=T[N]:q[N][z]=a[N][z];return q}function Ms(a,w,p,d){for(let M=0;M<a.length;M++)if(p(a[M],w[M])>d)return!1;return!0}class Es{constructor(w,p,d,M,q){this.clusters=w,this.centroids=p,this.converged=d,this.iterations=M,this.distance=q}nearest(w){const p=new Array(w.length);return ge(w,this.centroids,p,this.distance)}computeInformation(w){let p=this.centroids.map(d=>({centroid:d,error:0,size:0}));for(let d=0;d<w.length;d++)p[this.clusters[d]].error+=this.distance(w[d],this.centroids[this.clusters[d]]),p[this.clusters[d]].size++;for(let d=0;d<this.centroids.length;d++){let M=p[d].error;p[d].size&&M!==-1?M/=p[d].size:p[d].error=-1}return p}}function vs(a,w){throw new Error(`${w}: "${String(a)}"`)}function ks(a,w){if(w>a.length||!Number.isInteger(w))throw new Error("K should be a positive integer smaller than the number of points")}var V={};const Ns=Object.prototype.toString;function Rt(a){const w=Ns.call(a);return w.endsWith("Array]")&&!w.includes("Big")}const Is=Object.freeze(Object.defineProperty({__proto__:null,isAnyArray:Rt},Symbol.toStringTag,{value:"Module"})),Rs=ce(Is);function xs(a){var w=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!Rt(a))throw new TypeError("input must be an array");if(a.length===0)throw new TypeError("input must not be empty");var p=w.fromIndex,d=p===void 0?0:p,M=w.toIndex,q=M===void 0?a.length:M;if(d<0||d>=a.length||!Number.isInteger(d))throw new Error("fromIndex must be a positive integer smaller than length");if(q<=d||q>a.length||!Number.isInteger(q))throw new Error("toIndex must be an integer greater than fromIndex and at most equal to length");for(var T=a[d],N=d+1;N<q;N++)a[N]>T&&(T=a[N]);return T}function Cs(a){var w=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!Rt(a))throw new TypeError("input must be an array");if(a.length===0)throw new TypeError("input must not be empty");var p=w.fromIndex,d=p===void 0?0:p,M=w.toIndex,q=M===void 0?a.length:M;if(d<0||d>=a.length||!Number.isInteger(d))throw new Error("fromIndex must be a positive integer smaller than length");if(q<=d||q>a.length||!Number.isInteger(q))throw new Error("toIndex must be an integer greater than fromIndex and at most equal to length");for(var T=a[d],N=d+1;N<q;N++)a[N]<T&&(T=a[N]);return T}function Ts(a){var w=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(Rt(a)){if(a.length===0)throw new TypeError("input must not be empty")}else throw new TypeError("input must be an array");var p;if(w.output!==void 0){if(!Rt(w.output))throw new TypeError("output option must be an array if specified");p=w.output}else p=new Array(a.length);var d=Cs(a),M=xs(a);if(d===M)throw new RangeError("minimum and maximum input values are equal. Cannot rescale a constant array");var q=w.min,T=q===void 0?w.autoMinMax?d:0:q,N=w.max,z=N===void 0?w.autoMinMax?M:1:N;if(T>=z)throw new RangeError("min option must be smaller than max option");for(var U=(z-T)/(M-d),G=0;G<a.length;G++)p[G]=(a[G]-d)*U+T;return p}const qs=Object.freeze(Object.defineProperty({__proto__:null,default:Ts},Symbol.toStringTag,{value:"Module"})),Ps=ce(qs);var oe;function Fs(){var It,Yt,rt;if(oe)return V;oe=1,Object.defineProperty(V,"__esModule",{value:!0});var a=Rs,w=Ps;const p=" ".repeat(2),d=" ".repeat(4);function M(){return q(this)}function q(o,r={}){const{maxRows:e=15,maxColumns:t=10,maxNumSize:s=8,padMinus:n="auto"}=r;return`${o.constructor.name} {
${p}[
${d}${T(o,e,t,s,n)}
${p}]
${p}rows: ${o.rows}
${p}columns: ${o.columns}
}`}function T(o,r,e,t,s){const{rows:n,columns:i}=o,l=Math.min(n,r),h=Math.min(i,e),u=[];if(s==="auto"){s=!1;t:for(let m=0;m<l;m++)for(let f=0;f<h;f++)if(o.get(m,f)<0){s=!0;break t}}for(let m=0;m<l;m++){let f=[];for(let j=0;j<h;j++)f.push(N(o.get(m,j),t,s));u.push(`${f.join(" ")}`)}return h!==i&&(u[u.length-1]+=` ... ${i-e} more columns`),l!==n&&u.push(`... ${n-r} more rows`),u.join(`
${d}`)}function N(o,r,e){return(o>=0&&e?` ${z(o,r-1)}`:z(o,r)).padEnd(r)}function z(o,r){let e=o.toString();if(e.length<=r)return e;let t=o.toFixed(r);if(t.length>r&&(t=o.toFixed(Math.max(0,r-(t.length-r)))),t.length<=r&&!t.startsWith("0.000")&&!t.startsWith("-0.000"))return t;let s=o.toExponential(r);return s.length>r&&(s=o.toExponential(Math.max(0,r-(s.length-r)))),s.slice(0)}function U(o,r){o.prototype.add=function(t){return typeof t=="number"?this.addS(t):this.addM(t)},o.prototype.addS=function(t){for(let s=0;s<this.rows;s++)for(let n=0;n<this.columns;n++)this.set(s,n,this.get(s,n)+t);return this},o.prototype.addM=function(t){if(t=r.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let s=0;s<this.rows;s++)for(let n=0;n<this.columns;n++)this.set(s,n,this.get(s,n)+t.get(s,n));return this},o.add=function(t,s){return new r(t).add(s)},o.prototype.sub=function(t){return typeof t=="number"?this.subS(t):this.subM(t)},o.prototype.subS=function(t){for(let s=0;s<this.rows;s++)for(let n=0;n<this.columns;n++)this.set(s,n,this.get(s,n)-t);return this},o.prototype.subM=function(t){if(t=r.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let s=0;s<this.rows;s++)for(let n=0;n<this.columns;n++)this.set(s,n,this.get(s,n)-t.get(s,n));return this},o.sub=function(t,s){return new r(t).sub(s)},o.prototype.subtract=o.prototype.sub,o.prototype.subtractS=o.prototype.subS,o.prototype.subtractM=o.prototype.subM,o.subtract=o.sub,o.prototype.mul=function(t){return typeof t=="number"?this.mulS(t):this.mulM(t)},o.prototype.mulS=function(t){for(let s=0;s<this.rows;s++)for(let n=0;n<this.columns;n++)this.set(s,n,this.get(s,n)*t);return this},o.prototype.mulM=function(t){if(t=r.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let s=0;s<this.rows;s++)for(let n=0;n<this.columns;n++)this.set(s,n,this.get(s,n)*t.get(s,n));return this},o.mul=function(t,s){return new r(t).mul(s)},o.prototype.multiply=o.prototype.mul,o.prototype.multiplyS=o.prototype.mulS,o.prototype.multiplyM=o.prototype.mulM,o.multiply=o.mul,o.prototype.div=function(t){return typeof t=="number"?this.divS(t):this.divM(t)},o.prototype.divS=function(t){for(let s=0;s<this.rows;s++)for(let n=0;n<this.columns;n++)this.set(s,n,this.get(s,n)/t);return this},o.prototype.divM=function(t){if(t=r.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let s=0;s<this.rows;s++)for(let n=0;n<this.columns;n++)this.set(s,n,this.get(s,n)/t.get(s,n));return this},o.div=function(t,s){return new r(t).div(s)},o.prototype.divide=o.prototype.div,o.prototype.divideS=o.prototype.divS,o.prototype.divideM=o.prototype.divM,o.divide=o.div,o.prototype.mod=function(t){return typeof t=="number"?this.modS(t):this.modM(t)},o.prototype.modS=function(t){for(let s=0;s<this.rows;s++)for(let n=0;n<this.columns;n++)this.set(s,n,this.get(s,n)%t);return this},o.prototype.modM=function(t){if(t=r.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let s=0;s<this.rows;s++)for(let n=0;n<this.columns;n++)this.set(s,n,this.get(s,n)%t.get(s,n));return this},o.mod=function(t,s){return new r(t).mod(s)},o.prototype.modulus=o.prototype.mod,o.prototype.modulusS=o.prototype.modS,o.prototype.modulusM=o.prototype.modM,o.modulus=o.mod,o.prototype.and=function(t){return typeof t=="number"?this.andS(t):this.andM(t)},o.prototype.andS=function(t){for(let s=0;s<this.rows;s++)for(let n=0;n<this.columns;n++)this.set(s,n,this.get(s,n)&t);return this},o.prototype.andM=function(t){if(t=r.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let s=0;s<this.rows;s++)for(let n=0;n<this.columns;n++)this.set(s,n,this.get(s,n)&t.get(s,n));return this},o.and=function(t,s){return new r(t).and(s)},o.prototype.or=function(t){return typeof t=="number"?this.orS(t):this.orM(t)},o.prototype.orS=function(t){for(let s=0;s<this.rows;s++)for(let n=0;n<this.columns;n++)this.set(s,n,this.get(s,n)|t);return this},o.prototype.orM=function(t){if(t=r.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let s=0;s<this.rows;s++)for(let n=0;n<this.columns;n++)this.set(s,n,this.get(s,n)|t.get(s,n));return this},o.or=function(t,s){return new r(t).or(s)},o.prototype.xor=function(t){return typeof t=="number"?this.xorS(t):this.xorM(t)},o.prototype.xorS=function(t){for(let s=0;s<this.rows;s++)for(let n=0;n<this.columns;n++)this.set(s,n,this.get(s,n)^t);return this},o.prototype.xorM=function(t){if(t=r.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let s=0;s<this.rows;s++)for(let n=0;n<this.columns;n++)this.set(s,n,this.get(s,n)^t.get(s,n));return this},o.xor=function(t,s){return new r(t).xor(s)},o.prototype.leftShift=function(t){return typeof t=="number"?this.leftShiftS(t):this.leftShiftM(t)},o.prototype.leftShiftS=function(t){for(let s=0;s<this.rows;s++)for(let n=0;n<this.columns;n++)this.set(s,n,this.get(s,n)<<t);return this},o.prototype.leftShiftM=function(t){if(t=r.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let s=0;s<this.rows;s++)for(let n=0;n<this.columns;n++)this.set(s,n,this.get(s,n)<<t.get(s,n));return this},o.leftShift=function(t,s){return new r(t).leftShift(s)},o.prototype.signPropagatingRightShift=function(t){return typeof t=="number"?this.signPropagatingRightShiftS(t):this.signPropagatingRightShiftM(t)},o.prototype.signPropagatingRightShiftS=function(t){for(let s=0;s<this.rows;s++)for(let n=0;n<this.columns;n++)this.set(s,n,this.get(s,n)>>t);return this},o.prototype.signPropagatingRightShiftM=function(t){if(t=r.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let s=0;s<this.rows;s++)for(let n=0;n<this.columns;n++)this.set(s,n,this.get(s,n)>>t.get(s,n));return this},o.signPropagatingRightShift=function(t,s){return new r(t).signPropagatingRightShift(s)},o.prototype.rightShift=function(t){return typeof t=="number"?this.rightShiftS(t):this.rightShiftM(t)},o.prototype.rightShiftS=function(t){for(let s=0;s<this.rows;s++)for(let n=0;n<this.columns;n++)this.set(s,n,this.get(s,n)>>>t);return this},o.prototype.rightShiftM=function(t){if(t=r.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let s=0;s<this.rows;s++)for(let n=0;n<this.columns;n++)this.set(s,n,this.get(s,n)>>>t.get(s,n));return this},o.rightShift=function(t,s){return new r(t).rightShift(s)},o.prototype.zeroFillRightShift=o.prototype.rightShift,o.prototype.zeroFillRightShiftS=o.prototype.rightShiftS,o.prototype.zeroFillRightShiftM=o.prototype.rightShiftM,o.zeroFillRightShift=o.rightShift,o.prototype.not=function(){for(let t=0;t<this.rows;t++)for(let s=0;s<this.columns;s++)this.set(t,s,~this.get(t,s));return this},o.not=function(t){return new r(t).not()},o.prototype.abs=function(){for(let t=0;t<this.rows;t++)for(let s=0;s<this.columns;s++)this.set(t,s,Math.abs(this.get(t,s)));return this},o.abs=function(t){return new r(t).abs()},o.prototype.acos=function(){for(let t=0;t<this.rows;t++)for(let s=0;s<this.columns;s++)this.set(t,s,Math.acos(this.get(t,s)));return this},o.acos=function(t){return new r(t).acos()},o.prototype.acosh=function(){for(let t=0;t<this.rows;t++)for(let s=0;s<this.columns;s++)this.set(t,s,Math.acosh(this.get(t,s)));return this},o.acosh=function(t){return new r(t).acosh()},o.prototype.asin=function(){for(let t=0;t<this.rows;t++)for(let s=0;s<this.columns;s++)this.set(t,s,Math.asin(this.get(t,s)));return this},o.asin=function(t){return new r(t).asin()},o.prototype.asinh=function(){for(let t=0;t<this.rows;t++)for(let s=0;s<this.columns;s++)this.set(t,s,Math.asinh(this.get(t,s)));return this},o.asinh=function(t){return new r(t).asinh()},o.prototype.atan=function(){for(let t=0;t<this.rows;t++)for(let s=0;s<this.columns;s++)this.set(t,s,Math.atan(this.get(t,s)));return this},o.atan=function(t){return new r(t).atan()},o.prototype.atanh=function(){for(let t=0;t<this.rows;t++)for(let s=0;s<this.columns;s++)this.set(t,s,Math.atanh(this.get(t,s)));return this},o.atanh=function(t){return new r(t).atanh()},o.prototype.cbrt=function(){for(let t=0;t<this.rows;t++)for(let s=0;s<this.columns;s++)this.set(t,s,Math.cbrt(this.get(t,s)));return this},o.cbrt=function(t){return new r(t).cbrt()},o.prototype.ceil=function(){for(let t=0;t<this.rows;t++)for(let s=0;s<this.columns;s++)this.set(t,s,Math.ceil(this.get(t,s)));return this},o.ceil=function(t){return new r(t).ceil()},o.prototype.clz32=function(){for(let t=0;t<this.rows;t++)for(let s=0;s<this.columns;s++)this.set(t,s,Math.clz32(this.get(t,s)));return this},o.clz32=function(t){return new r(t).clz32()},o.prototype.cos=function(){for(let t=0;t<this.rows;t++)for(let s=0;s<this.columns;s++)this.set(t,s,Math.cos(this.get(t,s)));return this},o.cos=function(t){return new r(t).cos()},o.prototype.cosh=function(){for(let t=0;t<this.rows;t++)for(let s=0;s<this.columns;s++)this.set(t,s,Math.cosh(this.get(t,s)));return this},o.cosh=function(t){return new r(t).cosh()},o.prototype.exp=function(){for(let t=0;t<this.rows;t++)for(let s=0;s<this.columns;s++)this.set(t,s,Math.exp(this.get(t,s)));return this},o.exp=function(t){return new r(t).exp()},o.prototype.expm1=function(){for(let t=0;t<this.rows;t++)for(let s=0;s<this.columns;s++)this.set(t,s,Math.expm1(this.get(t,s)));return this},o.expm1=function(t){return new r(t).expm1()},o.prototype.floor=function(){for(let t=0;t<this.rows;t++)for(let s=0;s<this.columns;s++)this.set(t,s,Math.floor(this.get(t,s)));return this},o.floor=function(t){return new r(t).floor()},o.prototype.fround=function(){for(let t=0;t<this.rows;t++)for(let s=0;s<this.columns;s++)this.set(t,s,Math.fround(this.get(t,s)));return this},o.fround=function(t){return new r(t).fround()},o.prototype.log=function(){for(let t=0;t<this.rows;t++)for(let s=0;s<this.columns;s++)this.set(t,s,Math.log(this.get(t,s)));return this},o.log=function(t){return new r(t).log()},o.prototype.log1p=function(){for(let t=0;t<this.rows;t++)for(let s=0;s<this.columns;s++)this.set(t,s,Math.log1p(this.get(t,s)));return this},o.log1p=function(t){return new r(t).log1p()},o.prototype.log10=function(){for(let t=0;t<this.rows;t++)for(let s=0;s<this.columns;s++)this.set(t,s,Math.log10(this.get(t,s)));return this},o.log10=function(t){return new r(t).log10()},o.prototype.log2=function(){for(let t=0;t<this.rows;t++)for(let s=0;s<this.columns;s++)this.set(t,s,Math.log2(this.get(t,s)));return this},o.log2=function(t){return new r(t).log2()},o.prototype.round=function(){for(let t=0;t<this.rows;t++)for(let s=0;s<this.columns;s++)this.set(t,s,Math.round(this.get(t,s)));return this},o.round=function(t){return new r(t).round()},o.prototype.sign=function(){for(let t=0;t<this.rows;t++)for(let s=0;s<this.columns;s++)this.set(t,s,Math.sign(this.get(t,s)));return this},o.sign=function(t){return new r(t).sign()},o.prototype.sin=function(){for(let t=0;t<this.rows;t++)for(let s=0;s<this.columns;s++)this.set(t,s,Math.sin(this.get(t,s)));return this},o.sin=function(t){return new r(t).sin()},o.prototype.sinh=function(){for(let t=0;t<this.rows;t++)for(let s=0;s<this.columns;s++)this.set(t,s,Math.sinh(this.get(t,s)));return this},o.sinh=function(t){return new r(t).sinh()},o.prototype.sqrt=function(){for(let t=0;t<this.rows;t++)for(let s=0;s<this.columns;s++)this.set(t,s,Math.sqrt(this.get(t,s)));return this},o.sqrt=function(t){return new r(t).sqrt()},o.prototype.tan=function(){for(let t=0;t<this.rows;t++)for(let s=0;s<this.columns;s++)this.set(t,s,Math.tan(this.get(t,s)));return this},o.tan=function(t){return new r(t).tan()},o.prototype.tanh=function(){for(let t=0;t<this.rows;t++)for(let s=0;s<this.columns;s++)this.set(t,s,Math.tanh(this.get(t,s)));return this},o.tanh=function(t){return new r(t).tanh()},o.prototype.trunc=function(){for(let t=0;t<this.rows;t++)for(let s=0;s<this.columns;s++)this.set(t,s,Math.trunc(this.get(t,s)));return this},o.trunc=function(t){return new r(t).trunc()},o.pow=function(t,s){return new r(t).pow(s)},o.prototype.pow=function(t){return typeof t=="number"?this.powS(t):this.powM(t)},o.prototype.powS=function(t){for(let s=0;s<this.rows;s++)for(let n=0;n<this.columns;n++)this.set(s,n,this.get(s,n)**t);return this},o.prototype.powM=function(t){if(t=r.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let s=0;s<this.rows;s++)for(let n=0;n<this.columns;n++)this.set(s,n,this.get(s,n)**t.get(s,n));return this}}function G(o,r,e){let t=e?o.rows:o.rows-1;if(r<0||r>t)throw new RangeError("Row index out of range")}function Q(o,r,e){let t=e?o.columns:o.columns-1;if(r<0||r>t)throw new RangeError("Column index out of range")}function st(o,r){if(r.to1DArray&&(r=r.to1DArray()),r.length!==o.columns)throw new RangeError("vector size must be the same as the number of columns");return r}function W(o,r){if(r.to1DArray&&(r=r.to1DArray()),r.length!==o.rows)throw new RangeError("vector size must be the same as the number of rows");return r}function ft(o,r){if(!a.isAnyArray(r))throw new TypeError("row indices must be an array");for(let e=0;e<r.length;e++)if(r[e]<0||r[e]>=o.rows)throw new RangeError("row indices are out of range")}function kt(o,r){if(!a.isAnyArray(r))throw new TypeError("column indices must be an array");for(let e=0;e<r.length;e++)if(r[e]<0||r[e]>=o.columns)throw new RangeError("column indices are out of range")}function Nt(o,r,e,t,s){if(arguments.length!==5)throw new RangeError("expected 4 arguments");if(yt("startRow",r),yt("endRow",e),yt("startColumn",t),yt("endColumn",s),r>e||t>s||r<0||r>=o.rows||e<0||e>=o.rows||t<0||t>=o.columns||s<0||s>=o.columns)throw new RangeError("Submatrix indices are out of range")}function dt(o,r=0){let e=[];for(let t=0;t<o;t++)e.push(r);return e}function yt(o,r){if(typeof r!="number")throw new TypeError(`${o} must be a number`)}function gt(o){if(o.isEmpty())throw new Error("Empty matrix has no elements to index")}function bt(o){let r=dt(o.rows);for(let e=0;e<o.rows;++e)for(let t=0;t<o.columns;++t)r[e]+=o.get(e,t);return r}function Ct(o){let r=dt(o.columns);for(let e=0;e<o.rows;++e)for(let t=0;t<o.columns;++t)r[t]+=o.get(e,t);return r}function Tt(o){let r=0;for(let e=0;e<o.rows;e++)for(let t=0;t<o.columns;t++)r+=o.get(e,t);return r}function me(o){let r=dt(o.rows,1);for(let e=0;e<o.rows;++e)for(let t=0;t<o.columns;++t)r[e]*=o.get(e,t);return r}function we(o){let r=dt(o.columns,1);for(let e=0;e<o.rows;++e)for(let t=0;t<o.columns;++t)r[t]*=o.get(e,t);return r}function pe(o){let r=1;for(let e=0;e<o.rows;e++)for(let t=0;t<o.columns;t++)r*=o.get(e,t);return r}function de(o,r,e){const t=o.rows,s=o.columns,n=[];for(let i=0;i<t;i++){let l=0,h=0,u=0;for(let m=0;m<s;m++)u=o.get(i,m)-e[i],l+=u,h+=u*u;r?n.push((h-l*l/s)/(s-1)):n.push((h-l*l/s)/s)}return n}function ye(o,r,e){const t=o.rows,s=o.columns,n=[];for(let i=0;i<s;i++){let l=0,h=0,u=0;for(let m=0;m<t;m++)u=o.get(m,i)-e[i],l+=u,h+=u*u;r?n.push((h-l*l/t)/(t-1)):n.push((h-l*l/t)/t)}return n}function je(o,r,e){const t=o.rows,s=o.columns,n=t*s;let i=0,l=0,h=0;for(let u=0;u<t;u++)for(let m=0;m<s;m++)h=o.get(u,m)-e,i+=h,l+=h*h;return r?(l-i*i/n)/(n-1):(l-i*i/n)/n}function be(o,r){for(let e=0;e<o.rows;e++)for(let t=0;t<o.columns;t++)o.set(e,t,o.get(e,t)-r[e])}function Se(o,r){for(let e=0;e<o.rows;e++)for(let t=0;t<o.columns;t++)o.set(e,t,o.get(e,t)-r[t])}function Me(o,r){for(let e=0;e<o.rows;e++)for(let t=0;t<o.columns;t++)o.set(e,t,o.get(e,t)-r)}function Ee(o){const r=[];for(let e=0;e<o.rows;e++){let t=0;for(let s=0;s<o.columns;s++)t+=o.get(e,s)**2/(o.columns-1);r.push(Math.sqrt(t))}return r}function ve(o,r){for(let e=0;e<o.rows;e++)for(let t=0;t<o.columns;t++)o.set(e,t,o.get(e,t)/r[e])}function ke(o){const r=[];for(let e=0;e<o.columns;e++){let t=0;for(let s=0;s<o.rows;s++)t+=o.get(s,e)**2/(o.rows-1);r.push(Math.sqrt(t))}return r}function Ne(o,r){for(let e=0;e<o.rows;e++)for(let t=0;t<o.columns;t++)o.set(e,t,o.get(e,t)/r[t])}function Ie(o){const r=o.size-1;let e=0;for(let t=0;t<o.columns;t++)for(let s=0;s<o.rows;s++)e+=o.get(s,t)**2/r;return Math.sqrt(e)}function Re(o,r){for(let e=0;e<o.rows;e++)for(let t=0;t<o.columns;t++)o.set(e,t,o.get(e,t)/r)}class O{static from1DArray(r,e,t){if(r*e!==t.length)throw new RangeError("data length does not match given dimensions");let n=new I(r,e);for(let i=0;i<r;i++)for(let l=0;l<e;l++)n.set(i,l,t[i*e+l]);return n}static rowVector(r){let e=new I(1,r.length);for(let t=0;t<r.length;t++)e.set(0,t,r[t]);return e}static columnVector(r){let e=new I(r.length,1);for(let t=0;t<r.length;t++)e.set(t,0,r[t]);return e}static zeros(r,e){return new I(r,e)}static ones(r,e){return new I(r,e).fill(1)}static rand(r,e,t={}){if(typeof t!="object")throw new TypeError("options must be an object");const{random:s=Math.random}=t;let n=new I(r,e);for(let i=0;i<r;i++)for(let l=0;l<e;l++)n.set(i,l,s());return n}static randInt(r,e,t={}){if(typeof t!="object")throw new TypeError("options must be an object");const{min:s=0,max:n=1e3,random:i=Math.random}=t;if(!Number.isInteger(s))throw new TypeError("min must be an integer");if(!Number.isInteger(n))throw new TypeError("max must be an integer");if(s>=n)throw new RangeError("min must be smaller than max");let l=n-s,h=new I(r,e);for(let u=0;u<r;u++)for(let m=0;m<e;m++){let f=s+Math.round(i()*l);h.set(u,m,f)}return h}static eye(r,e,t){e===void 0&&(e=r),t===void 0&&(t=1);let s=Math.min(r,e),n=this.zeros(r,e);for(let i=0;i<s;i++)n.set(i,i,t);return n}static diag(r,e,t){let s=r.length;e===void 0&&(e=s),t===void 0&&(t=e);let n=Math.min(s,e,t),i=this.zeros(e,t);for(let l=0;l<n;l++)i.set(l,l,r[l]);return i}static min(r,e){r=this.checkMatrix(r),e=this.checkMatrix(e);let t=r.rows,s=r.columns,n=new I(t,s);for(let i=0;i<t;i++)for(let l=0;l<s;l++)n.set(i,l,Math.min(r.get(i,l),e.get(i,l)));return n}static max(r,e){r=this.checkMatrix(r),e=this.checkMatrix(e);let t=r.rows,s=r.columns,n=new this(t,s);for(let i=0;i<t;i++)for(let l=0;l<s;l++)n.set(i,l,Math.max(r.get(i,l),e.get(i,l)));return n}static checkMatrix(r){return O.isMatrix(r)?r:new I(r)}static isMatrix(r){return r!=null&&r.klass==="Matrix"}get size(){return this.rows*this.columns}apply(r){if(typeof r!="function")throw new TypeError("callback must be a function");for(let e=0;e<this.rows;e++)for(let t=0;t<this.columns;t++)r.call(this,e,t);return this}to1DArray(){let r=[];for(let e=0;e<this.rows;e++)for(let t=0;t<this.columns;t++)r.push(this.get(e,t));return r}to2DArray(){let r=[];for(let e=0;e<this.rows;e++){r.push([]);for(let t=0;t<this.columns;t++)r[e].push(this.get(e,t))}return r}toJSON(){return this.to2DArray()}isRowVector(){return this.rows===1}isColumnVector(){return this.columns===1}isVector(){return this.rows===1||this.columns===1}isSquare(){return this.rows===this.columns}isEmpty(){return this.rows===0||this.columns===0}isSymmetric(){if(this.isSquare()){for(let r=0;r<this.rows;r++)for(let e=0;e<=r;e++)if(this.get(r,e)!==this.get(e,r))return!1;return!0}return!1}isDistance(){if(!this.isSymmetric())return!1;for(let r=0;r<this.rows;r++)if(this.get(r,r)!==0)return!1;return!0}isEchelonForm(){let r=0,e=0,t=-1,s=!0,n=!1;for(;r<this.rows&&s;){for(e=0,n=!1;e<this.columns&&n===!1;)this.get(r,e)===0?e++:this.get(r,e)===1&&e>t?(n=!0,t=e):(s=!1,n=!0);r++}return s}isReducedEchelonForm(){let r=0,e=0,t=-1,s=!0,n=!1;for(;r<this.rows&&s;){for(e=0,n=!1;e<this.columns&&n===!1;)this.get(r,e)===0?e++:this.get(r,e)===1&&e>t?(n=!0,t=e):(s=!1,n=!0);for(let i=e+1;i<this.rows;i++)this.get(r,i)!==0&&(s=!1);r++}return s}echelonForm(){let r=this.clone(),e=0,t=0;for(;e<r.rows&&t<r.columns;){let s=e;for(let n=e;n<r.rows;n++)r.get(n,t)>r.get(s,t)&&(s=n);if(r.get(s,t)===0)t++;else{r.swapRows(e,s);let n=r.get(e,t);for(let i=t;i<r.columns;i++)r.set(e,i,r.get(e,i)/n);for(let i=e+1;i<r.rows;i++){let l=r.get(i,t)/r.get(e,t);r.set(i,t,0);for(let h=t+1;h<r.columns;h++)r.set(i,h,r.get(i,h)-r.get(e,h)*l)}e++,t++}}return r}reducedEchelonForm(){let r=this.echelonForm(),e=r.columns,t=r.rows,s=t-1;for(;s>=0;)if(r.maxRow(s)===0)s--;else{let n=0,i=!1;for(;n<t&&i===!1;)r.get(s,n)===1?i=!0:n++;for(let l=0;l<s;l++){let h=r.get(l,n);for(let u=n;u<e;u++){let m=r.get(l,u)-h*r.get(s,u);r.set(l,u,m)}}s--}return r}set(){throw new Error("set method is unimplemented")}get(){throw new Error("get method is unimplemented")}repeat(r={}){if(typeof r!="object")throw new TypeError("options must be an object");const{rows:e=1,columns:t=1}=r;if(!Number.isInteger(e)||e<=0)throw new TypeError("rows must be a positive integer");if(!Number.isInteger(t)||t<=0)throw new TypeError("columns must be a positive integer");let s=new I(this.rows*e,this.columns*t);for(let n=0;n<e;n++)for(let i=0;i<t;i++)s.setSubMatrix(this,this.rows*n,this.columns*i);return s}fill(r){for(let e=0;e<this.rows;e++)for(let t=0;t<this.columns;t++)this.set(e,t,r);return this}neg(){return this.mulS(-1)}getRow(r){G(this,r);let e=[];for(let t=0;t<this.columns;t++)e.push(this.get(r,t));return e}getRowVector(r){return I.rowVector(this.getRow(r))}setRow(r,e){G(this,r),e=st(this,e);for(let t=0;t<this.columns;t++)this.set(r,t,e[t]);return this}swapRows(r,e){G(this,r),G(this,e);for(let t=0;t<this.columns;t++){let s=this.get(r,t);this.set(r,t,this.get(e,t)),this.set(e,t,s)}return this}getColumn(r){Q(this,r);let e=[];for(let t=0;t<this.rows;t++)e.push(this.get(t,r));return e}getColumnVector(r){return I.columnVector(this.getColumn(r))}setColumn(r,e){Q(this,r),e=W(this,e);for(let t=0;t<this.rows;t++)this.set(t,r,e[t]);return this}swapColumns(r,e){Q(this,r),Q(this,e);for(let t=0;t<this.rows;t++){let s=this.get(t,r);this.set(t,r,this.get(t,e)),this.set(t,e,s)}return this}addRowVector(r){r=st(this,r);for(let e=0;e<this.rows;e++)for(let t=0;t<this.columns;t++)this.set(e,t,this.get(e,t)+r[t]);return this}subRowVector(r){r=st(this,r);for(let e=0;e<this.rows;e++)for(let t=0;t<this.columns;t++)this.set(e,t,this.get(e,t)-r[t]);return this}mulRowVector(r){r=st(this,r);for(let e=0;e<this.rows;e++)for(let t=0;t<this.columns;t++)this.set(e,t,this.get(e,t)*r[t]);return this}divRowVector(r){r=st(this,r);for(let e=0;e<this.rows;e++)for(let t=0;t<this.columns;t++)this.set(e,t,this.get(e,t)/r[t]);return this}addColumnVector(r){r=W(this,r);for(let e=0;e<this.rows;e++)for(let t=0;t<this.columns;t++)this.set(e,t,this.get(e,t)+r[e]);return this}subColumnVector(r){r=W(this,r);for(let e=0;e<this.rows;e++)for(let t=0;t<this.columns;t++)this.set(e,t,this.get(e,t)-r[e]);return this}mulColumnVector(r){r=W(this,r);for(let e=0;e<this.rows;e++)for(let t=0;t<this.columns;t++)this.set(e,t,this.get(e,t)*r[e]);return this}divColumnVector(r){r=W(this,r);for(let e=0;e<this.rows;e++)for(let t=0;t<this.columns;t++)this.set(e,t,this.get(e,t)/r[e]);return this}mulRow(r,e){G(this,r);for(let t=0;t<this.columns;t++)this.set(r,t,this.get(r,t)*e);return this}mulColumn(r,e){Q(this,r);for(let t=0;t<this.rows;t++)this.set(t,r,this.get(t,r)*e);return this}max(r){if(this.isEmpty())return NaN;switch(r){case"row":{const e=new Array(this.rows).fill(Number.NEGATIVE_INFINITY);for(let t=0;t<this.rows;t++)for(let s=0;s<this.columns;s++)this.get(t,s)>e[t]&&(e[t]=this.get(t,s));return e}case"column":{const e=new Array(this.columns).fill(Number.NEGATIVE_INFINITY);for(let t=0;t<this.rows;t++)for(let s=0;s<this.columns;s++)this.get(t,s)>e[s]&&(e[s]=this.get(t,s));return e}case void 0:{let e=this.get(0,0);for(let t=0;t<this.rows;t++)for(let s=0;s<this.columns;s++)this.get(t,s)>e&&(e=this.get(t,s));return e}default:throw new Error(`invalid option: ${r}`)}}maxIndex(){gt(this);let r=this.get(0,0),e=[0,0];for(let t=0;t<this.rows;t++)for(let s=0;s<this.columns;s++)this.get(t,s)>r&&(r=this.get(t,s),e[0]=t,e[1]=s);return e}min(r){if(this.isEmpty())return NaN;switch(r){case"row":{const e=new Array(this.rows).fill(Number.POSITIVE_INFINITY);for(let t=0;t<this.rows;t++)for(let s=0;s<this.columns;s++)this.get(t,s)<e[t]&&(e[t]=this.get(t,s));return e}case"column":{const e=new Array(this.columns).fill(Number.POSITIVE_INFINITY);for(let t=0;t<this.rows;t++)for(let s=0;s<this.columns;s++)this.get(t,s)<e[s]&&(e[s]=this.get(t,s));return e}case void 0:{let e=this.get(0,0);for(let t=0;t<this.rows;t++)for(let s=0;s<this.columns;s++)this.get(t,s)<e&&(e=this.get(t,s));return e}default:throw new Error(`invalid option: ${r}`)}}minIndex(){gt(this);let r=this.get(0,0),e=[0,0];for(let t=0;t<this.rows;t++)for(let s=0;s<this.columns;s++)this.get(t,s)<r&&(r=this.get(t,s),e[0]=t,e[1]=s);return e}maxRow(r){if(G(this,r),this.isEmpty())return NaN;let e=this.get(r,0);for(let t=1;t<this.columns;t++)this.get(r,t)>e&&(e=this.get(r,t));return e}maxRowIndex(r){G(this,r),gt(this);let e=this.get(r,0),t=[r,0];for(let s=1;s<this.columns;s++)this.get(r,s)>e&&(e=this.get(r,s),t[1]=s);return t}minRow(r){if(G(this,r),this.isEmpty())return NaN;let e=this.get(r,0);for(let t=1;t<this.columns;t++)this.get(r,t)<e&&(e=this.get(r,t));return e}minRowIndex(r){G(this,r),gt(this);let e=this.get(r,0),t=[r,0];for(let s=1;s<this.columns;s++)this.get(r,s)<e&&(e=this.get(r,s),t[1]=s);return t}maxColumn(r){if(Q(this,r),this.isEmpty())return NaN;let e=this.get(0,r);for(let t=1;t<this.rows;t++)this.get(t,r)>e&&(e=this.get(t,r));return e}maxColumnIndex(r){Q(this,r),gt(this);let e=this.get(0,r),t=[0,r];for(let s=1;s<this.rows;s++)this.get(s,r)>e&&(e=this.get(s,r),t[0]=s);return t}minColumn(r){if(Q(this,r),this.isEmpty())return NaN;let e=this.get(0,r);for(let t=1;t<this.rows;t++)this.get(t,r)<e&&(e=this.get(t,r));return e}minColumnIndex(r){Q(this,r),gt(this);let e=this.get(0,r),t=[0,r];for(let s=1;s<this.rows;s++)this.get(s,r)<e&&(e=this.get(s,r),t[0]=s);return t}diag(){let r=Math.min(this.rows,this.columns),e=[];for(let t=0;t<r;t++)e.push(this.get(t,t));return e}norm(r="frobenius"){switch(r){case"max":return this.max();case"frobenius":return Math.sqrt(this.dot(this));default:throw new RangeError(`unknown norm type: ${r}`)}}cumulativeSum(){let r=0;for(let e=0;e<this.rows;e++)for(let t=0;t<this.columns;t++)r+=this.get(e,t),this.set(e,t,r);return this}dot(r){O.isMatrix(r)&&(r=r.to1DArray());let e=this.to1DArray();if(e.length!==r.length)throw new RangeError("vectors do not have the same size");let t=0;for(let s=0;s<e.length;s++)t+=e[s]*r[s];return t}mmul(r){r=I.checkMatrix(r);let e=this.rows,t=this.columns,s=r.columns,n=new I(e,s),i=new Float64Array(t);for(let l=0;l<s;l++){for(let h=0;h<t;h++)i[h]=r.get(h,l);for(let h=0;h<e;h++){let u=0;for(let m=0;m<t;m++)u+=this.get(h,m)*i[m];n.set(h,l,u)}}return n}mpow(r){if(!this.isSquare())throw new RangeError("Matrix must be square");if(!Number.isInteger(r)||r<0)throw new RangeError("Exponent must be a non-negative integer");let e=I.eye(this.rows),t=this;for(let s=r;s>=1;s/=2)(s&1)!==0&&(e=e.mmul(t)),t=t.mmul(t);return e}strassen2x2(r){r=I.checkMatrix(r);let e=new I(2,2);const t=this.get(0,0),s=r.get(0,0),n=this.get(0,1),i=r.get(0,1),l=this.get(1,0),h=r.get(1,0),u=this.get(1,1),m=r.get(1,1),f=(t+u)*(s+m),j=(l+u)*s,k=t*(i-m),y=u*(h-s),b=(t+n)*m,R=(l-t)*(s+i),c=(n-u)*(h+m),v=f+y-b+c,C=k+b,$=j+y,L=f-j+k+R;return e.set(0,0,v),e.set(0,1,C),e.set(1,0,$),e.set(1,1,L),e}strassen3x3(r){r=I.checkMatrix(r);let e=new I(3,3);const t=this.get(0,0),s=this.get(0,1),n=this.get(0,2),i=this.get(1,0),l=this.get(1,1),h=this.get(1,2),u=this.get(2,0),m=this.get(2,1),f=this.get(2,2),j=r.get(0,0),k=r.get(0,1),y=r.get(0,2),b=r.get(1,0),R=r.get(1,1),c=r.get(1,2),v=r.get(2,0),C=r.get(2,1),$=r.get(2,2),L=(t+s+n-i-l-m-f)*R,X=(t-i)*(-k+R),F=l*(-j+k+b-R-c-v+$),D=(-t+i+l)*(j-k+R),J=(i+l)*(-j+k),g=t*j,S=(-t+u+m)*(j-y+c),x=(-t+u)*(y-c),E=(u+m)*(-j+y),Z=(t+s+n-l-h-u-m)*c,B=m*(-j+y+b-R-c-v+C),Y=(-n+m+f)*(R+v-C),K=(n-f)*(R-C),tt=n*v,lt=(m+f)*(-v+C),A=(-n+l+h)*(c+v-$),ct=(n-h)*(c-$),pt=(l+h)*(-v+$),_=s*b,et=h*C,ot=i*y,it=u*k,H=f*$,Ze=g+tt+_,Ke=L+D+J+g+Y+tt+lt,Ae=g+S+E+Z+tt+A+pt,He=X+F+D+g+tt+A+ct,ts=X+D+J+g+et,es=tt+A+ct+pt+ot,ss=g+S+x+B+Y+K+tt,rs=Y+K+tt+lt+it,ns=g+S+x+E+H;return e.set(0,0,Ze),e.set(0,1,Ke),e.set(0,2,Ae),e.set(1,0,He),e.set(1,1,ts),e.set(1,2,es),e.set(2,0,ss),e.set(2,1,rs),e.set(2,2,ns),e}mmulStrassen(r){r=I.checkMatrix(r);let e=this.clone(),t=e.rows,s=e.columns,n=r.rows,i=r.columns;s!==n&&console.warn(`Multiplying ${t} x ${s} and ${n} x ${i} matrix: dimensions do not match.`);function l(f,j,k){let y=f.rows,b=f.columns;if(y===j&&b===k)return f;{let R=O.zeros(j,k);return R=R.setSubMatrix(f,0,0),R}}let h=Math.max(t,n),u=Math.max(s,i);e=l(e,h,u),r=l(r,h,u);function m(f,j,k,y){if(k<=512||y<=512)return f.mmul(j);k%2===1&&y%2===1?(f=l(f,k+1,y+1),j=l(j,k+1,y+1)):k%2===1?(f=l(f,k+1,y),j=l(j,k+1,y)):y%2===1&&(f=l(f,k,y+1),j=l(j,k,y+1));let b=parseInt(f.rows/2,10),R=parseInt(f.columns/2,10),c=f.subMatrix(0,b-1,0,R-1),v=j.subMatrix(0,b-1,0,R-1),C=f.subMatrix(0,b-1,R,f.columns-1),$=j.subMatrix(0,b-1,R,j.columns-1),L=f.subMatrix(b,f.rows-1,0,R-1),X=j.subMatrix(b,j.rows-1,0,R-1),F=f.subMatrix(b,f.rows-1,R,f.columns-1),D=j.subMatrix(b,j.rows-1,R,j.columns-1),J=m(O.add(c,F),O.add(v,D),b,R),g=m(O.add(L,F),v,b,R),S=m(c,O.sub($,D),b,R),x=m(F,O.sub(X,v),b,R),E=m(O.add(c,C),D,b,R),Z=m(O.sub(L,c),O.add(v,$),b,R),B=m(O.sub(C,F),O.add(X,D),b,R),Y=O.add(J,x);Y.sub(E),Y.add(B);let K=O.add(S,E),tt=O.add(g,x),lt=O.sub(J,g);lt.add(S),lt.add(Z);let A=O.zeros(2*Y.rows,2*Y.columns);return A=A.setSubMatrix(Y,0,0),A=A.setSubMatrix(K,Y.rows,0),A=A.setSubMatrix(tt,0,Y.columns),A=A.setSubMatrix(lt,Y.rows,Y.columns),A.subMatrix(0,k-1,0,y-1)}return m(e,r,h,u)}scaleRows(r={}){if(typeof r!="object")throw new TypeError("options must be an object");const{min:e=0,max:t=1}=r;if(!Number.isFinite(e))throw new TypeError("min must be a number");if(!Number.isFinite(t))throw new TypeError("max must be a number");if(e>=t)throw new RangeError("min must be smaller than max");let s=new I(this.rows,this.columns);for(let n=0;n<this.rows;n++){const i=this.getRow(n);i.length>0&&w(i,{min:e,max:t,output:i}),s.setRow(n,i)}return s}scaleColumns(r={}){if(typeof r!="object")throw new TypeError("options must be an object");const{min:e=0,max:t=1}=r;if(!Number.isFinite(e))throw new TypeError("min must be a number");if(!Number.isFinite(t))throw new TypeError("max must be a number");if(e>=t)throw new RangeError("min must be smaller than max");let s=new I(this.rows,this.columns);for(let n=0;n<this.columns;n++){const i=this.getColumn(n);i.length&&w(i,{min:e,max:t,output:i}),s.setColumn(n,i)}return s}flipRows(){const r=Math.ceil(this.columns/2);for(let e=0;e<this.rows;e++)for(let t=0;t<r;t++){let s=this.get(e,t),n=this.get(e,this.columns-1-t);this.set(e,t,n),this.set(e,this.columns-1-t,s)}return this}flipColumns(){const r=Math.ceil(this.rows/2);for(let e=0;e<this.columns;e++)for(let t=0;t<r;t++){let s=this.get(t,e),n=this.get(this.rows-1-t,e);this.set(t,e,n),this.set(this.rows-1-t,e,s)}return this}kroneckerProduct(r){r=I.checkMatrix(r);let e=this.rows,t=this.columns,s=r.rows,n=r.columns,i=new I(e*s,t*n);for(let l=0;l<e;l++)for(let h=0;h<t;h++)for(let u=0;u<s;u++)for(let m=0;m<n;m++)i.set(s*l+u,n*h+m,this.get(l,h)*r.get(u,m));return i}kroneckerSum(r){if(r=I.checkMatrix(r),!this.isSquare()||!r.isSquare())throw new Error("Kronecker Sum needs two Square Matrices");let e=this.rows,t=r.rows,s=this.kroneckerProduct(I.eye(t,t)),n=I.eye(e,e).kroneckerProduct(r);return s.add(n)}transpose(){let r=new I(this.columns,this.rows);for(let e=0;e<this.rows;e++)for(let t=0;t<this.columns;t++)r.set(t,e,this.get(e,t));return r}sortRows(r=Kt){for(let e=0;e<this.rows;e++)this.setRow(e,this.getRow(e).sort(r));return this}sortColumns(r=Kt){for(let e=0;e<this.columns;e++)this.setColumn(e,this.getColumn(e).sort(r));return this}subMatrix(r,e,t,s){Nt(this,r,e,t,s);let n=new I(e-r+1,s-t+1);for(let i=r;i<=e;i++)for(let l=t;l<=s;l++)n.set(i-r,l-t,this.get(i,l));return n}subMatrixRow(r,e,t){if(e===void 0&&(e=0),t===void 0&&(t=this.columns-1),e>t||e<0||e>=this.columns||t<0||t>=this.columns)throw new RangeError("Argument out of range");let s=new I(r.length,t-e+1);for(let n=0;n<r.length;n++)for(let i=e;i<=t;i++){if(r[n]<0||r[n]>=this.rows)throw new RangeError(`Row index out of range: ${r[n]}`);s.set(n,i-e,this.get(r[n],i))}return s}subMatrixColumn(r,e,t){if(e===void 0&&(e=0),t===void 0&&(t=this.rows-1),e>t||e<0||e>=this.rows||t<0||t>=this.rows)throw new RangeError("Argument out of range");let s=new I(t-e+1,r.length);for(let n=0;n<r.length;n++)for(let i=e;i<=t;i++){if(r[n]<0||r[n]>=this.columns)throw new RangeError(`Column index out of range: ${r[n]}`);s.set(i-e,n,this.get(i,r[n]))}return s}setSubMatrix(r,e,t){if(r=I.checkMatrix(r),r.isEmpty())return this;let s=e+r.rows-1,n=t+r.columns-1;Nt(this,e,s,t,n);for(let i=0;i<r.rows;i++)for(let l=0;l<r.columns;l++)this.set(e+i,t+l,r.get(i,l));return this}selection(r,e){ft(this,r),kt(this,e);let t=new I(r.length,e.length);for(let s=0;s<r.length;s++){let n=r[s];for(let i=0;i<e.length;i++){let l=e[i];t.set(s,i,this.get(n,l))}}return t}trace(){let r=Math.min(this.rows,this.columns),e=0;for(let t=0;t<r;t++)e+=this.get(t,t);return e}clone(){return this.constructor.copy(this,new I(this.rows,this.columns))}static copy(r,e){for(const[t,s,n]of r.entries())e.set(t,s,n);return e}sum(r){switch(r){case"row":return bt(this);case"column":return Ct(this);case void 0:return Tt(this);default:throw new Error(`invalid option: ${r}`)}}product(r){switch(r){case"row":return me(this);case"column":return we(this);case void 0:return pe(this);default:throw new Error(`invalid option: ${r}`)}}mean(r){const e=this.sum(r);switch(r){case"row":{for(let t=0;t<this.rows;t++)e[t]/=this.columns;return e}case"column":{for(let t=0;t<this.columns;t++)e[t]/=this.rows;return e}case void 0:return e/this.size;default:throw new Error(`invalid option: ${r}`)}}variance(r,e={}){if(typeof r=="object"&&(e=r,r=void 0),typeof e!="object")throw new TypeError("options must be an object");const{unbiased:t=!0,mean:s=this.mean(r)}=e;if(typeof t!="boolean")throw new TypeError("unbiased must be a boolean");switch(r){case"row":{if(!a.isAnyArray(s))throw new TypeError("mean must be an array");return de(this,t,s)}case"column":{if(!a.isAnyArray(s))throw new TypeError("mean must be an array");return ye(this,t,s)}case void 0:{if(typeof s!="number")throw new TypeError("mean must be a number");return je(this,t,s)}default:throw new Error(`invalid option: ${r}`)}}standardDeviation(r,e){typeof r=="object"&&(e=r,r=void 0);const t=this.variance(r,e);if(r===void 0)return Math.sqrt(t);for(let s=0;s<t.length;s++)t[s]=Math.sqrt(t[s]);return t}center(r,e={}){if(typeof r=="object"&&(e=r,r=void 0),typeof e!="object")throw new TypeError("options must be an object");const{center:t=this.mean(r)}=e;switch(r){case"row":{if(!a.isAnyArray(t))throw new TypeError("center must be an array");return be(this,t),this}case"column":{if(!a.isAnyArray(t))throw new TypeError("center must be an array");return Se(this,t),this}case void 0:{if(typeof t!="number")throw new TypeError("center must be a number");return Me(this,t),this}default:throw new Error(`invalid option: ${r}`)}}scale(r,e={}){if(typeof r=="object"&&(e=r,r=void 0),typeof e!="object")throw new TypeError("options must be an object");let t=e.scale;switch(r){case"row":{if(t===void 0)t=Ee(this);else if(!a.isAnyArray(t))throw new TypeError("scale must be an array");return ve(this,t),this}case"column":{if(t===void 0)t=ke(this);else if(!a.isAnyArray(t))throw new TypeError("scale must be an array");return Ne(this,t),this}case void 0:{if(t===void 0)t=Ie(this);else if(typeof t!="number")throw new TypeError("scale must be a number");return Re(this,t),this}default:throw new Error(`invalid option: ${r}`)}}toString(r){return q(this,r)}[Symbol.iterator](){return this.entries()}*entries(){for(let r=0;r<this.rows;r++)for(let e=0;e<this.columns;e++)yield[r,e,this.get(r,e)]}*values(){for(let r=0;r<this.rows;r++)for(let e=0;e<this.columns;e++)yield this.get(r,e)}}O.prototype.klass="Matrix",typeof Symbol<"u"&&(O.prototype[Symbol.for("nodejs.util.inspect.custom")]=M);function Kt(o,r){return o-r}function xe(o){return o.every(r=>typeof r=="number")}O.random=O.rand,O.randomInt=O.randInt,O.diagonal=O.diag,O.prototype.diagonal=O.prototype.diag,O.identity=O.eye,O.prototype.negate=O.prototype.neg,O.prototype.tensorProduct=O.prototype.kroneckerProduct;const $t=class $t extends O{constructor(e,t){super();Wt(this,It);ne(this,"data");if($t.isMatrix(e))Jt(this,It,Yt).call(this,e.rows,e.columns),$t.copy(e,this);else if(Number.isInteger(e)&&e>=0)Jt(this,It,Yt).call(this,e,t);else if(a.isAnyArray(e)){const s=e;if(e=s.length,t=e?s[0].length:0,typeof t!="number")throw new TypeError("Data must be a 2D array with at least one element");this.data=[];for(let n=0;n<e;n++){if(s[n].length!==t)throw new RangeError("Inconsistent array dimensions");if(!xe(s[n]))throw new TypeError("Input data contains non-numeric values");this.data.push(Float64Array.from(s[n]))}this.rows=e,this.columns=t}else throw new TypeError("First argument must be a positive number or an array")}set(e,t,s){return this.data[e][t]=s,this}get(e,t){return this.data[e][t]}removeRow(e){return G(this,e),this.data.splice(e,1),this.rows-=1,this}addRow(e,t){return t===void 0&&(t=e,e=this.rows),G(this,e,!0),t=Float64Array.from(st(this,t)),this.data.splice(e,0,t),this.rows+=1,this}removeColumn(e){Q(this,e);for(let t=0;t<this.rows;t++){const s=new Float64Array(this.columns-1);for(let n=0;n<e;n++)s[n]=this.data[t][n];for(let n=e+1;n<this.columns;n++)s[n-1]=this.data[t][n];this.data[t]=s}return this.columns-=1,this}addColumn(e,t){typeof t>"u"&&(t=e,e=this.columns),Q(this,e,!0),t=W(this,t);for(let s=0;s<this.rows;s++){const n=new Float64Array(this.columns+1);let i=0;for(;i<e;i++)n[i]=this.data[s][i];for(n[i++]=t[s];i<this.columns+1;i++)n[i]=this.data[s][i-1];this.data[s]=n}return this.columns+=1,this}};It=new WeakSet,Yt=function(e,t){if(this.data=[],Number.isInteger(t)&&t>=0)for(let s=0;s<e;s++)this.data.push(new Float64Array(t));else throw new TypeError("nColumns must be a positive integer");this.rows=e,this.columns=t};let I=$t;U(O,I);const Lt=class Lt extends O{constructor(e){super();Wt(this,rt);if(I.isMatrix(e)){if(!e.isSymmetric())throw new TypeError("not symmetric data");Ot(this,rt,I.copy(e,new I(e.rows,e.rows)))}else if(Number.isInteger(e)&&e>=0)Ot(this,rt,new I(e,e));else if(Ot(this,rt,new I(e)),!this.isSymmetric())throw new TypeError("not symmetric data")}get size(){return ht(this,rt).size}get rows(){return ht(this,rt).rows}get columns(){return ht(this,rt).columns}get diagonalSize(){return this.rows}static isSymmetricMatrix(e){return I.isMatrix(e)&&e.klassType==="SymmetricMatrix"}static zeros(e){return new this(e)}static ones(e){return new this(e).fill(1)}clone(){const e=new Lt(this.diagonalSize);for(const[t,s,n]of this.upperRightEntries())e.set(t,s,n);return e}toMatrix(){return new I(this)}get(e,t){return ht(this,rt).get(e,t)}set(e,t,s){return ht(this,rt).set(e,t,s),ht(this,rt).set(t,e,s),this}removeCross(e){return ht(this,rt).removeRow(e),ht(this,rt).removeColumn(e),this}addCross(e,t){t===void 0&&(t=e,e=this.diagonalSize);const s=t.slice();return s.splice(e,1),ht(this,rt).addRow(e,s),ht(this,rt).addColumn(e,t),this}applyMask(e){if(e.length!==this.diagonalSize)throw new RangeError("Mask size do not match with matrix size");const t=[];for(const[s,n]of e.entries())n||t.push(s);t.reverse();for(const s of t)this.removeCross(s);return this}toCompact(){const{diagonalSize:e}=this,t=new Array(e*(e+1)/2);for(let s=0,n=0,i=0;i<t.length;i++)t[i]=this.get(n,s),++s>=e&&(s=++n);return t}static fromCompact(e){const t=e.length,s=(Math.sqrt(8*t+1)-1)/2;if(!Number.isInteger(s))throw new TypeError(`This array is not a compact representation of a Symmetric Matrix, ${JSON.stringify(e)}`);const n=new Lt(s);for(let i=0,l=0,h=0;h<t;h++)n.set(i,l,e[h]),++i>=s&&(i=++l);return n}*upperRightEntries(){for(let e=0,t=0;e<this.diagonalSize;void 0){const s=this.get(e,t);yield[e,t,s],++t>=this.diagonalSize&&(t=++e)}}*upperRightValues(){for(let e=0,t=0;e<this.diagonalSize;void 0)yield this.get(e,t),++t>=this.diagonalSize&&(t=++e)}};rt=new WeakMap;let jt=Lt;jt.prototype.klassType="SymmetricMatrix";class qt extends jt{static isDistanceMatrix(r){return jt.isSymmetricMatrix(r)&&r.klassSubType==="DistanceMatrix"}constructor(r){if(super(r),!this.isDistance())throw new TypeError("Provided arguments do no produce a distance matrix")}set(r,e,t){return r===e&&(t=0),super.set(r,e,t)}addCross(r,e){return e===void 0&&(e=r,r=this.diagonalSize),e=e.slice(),e[r]=0,super.addCross(r,e)}toSymmetricMatrix(){return new jt(this)}clone(){const r=new qt(this.diagonalSize);for(const[e,t,s]of this.upperRightEntries())e!==t&&r.set(e,t,s);return r}toCompact(){const{diagonalSize:r}=this,e=(r-1)*r/2,t=new Array(e);for(let s=1,n=0,i=0;i<t.length;i++)t[i]=this.get(n,s),++s>=r&&(s=++n+1);return t}static fromCompact(r){const e=r.length;if(e===0)return new this(0);const t=(Math.sqrt(8*e+1)+1)/2;if(!Number.isInteger(t))throw new TypeError(`This array is not a compact representation of a DistanceMatrix, ${JSON.stringify(r)}`);const s=new this(t);for(let n=1,i=0,l=0;l<e;l++)s.set(n,i,r[l]),++n>=t&&(n=++i+1);return s}}qt.prototype.klassSubType="DistanceMatrix";class mt extends O{constructor(r,e,t){super(),this.matrix=r,this.rows=e,this.columns=t}}class Ce extends mt{constructor(r,e){Q(r,e),super(r,r.rows,1),this.column=e}set(r,e,t){return this.matrix.set(r,this.column,t),this}get(r){return this.matrix.get(r,this.column)}}class Te extends mt{constructor(r,e){kt(r,e),super(r,r.rows,e.length),this.columnIndices=e}set(r,e,t){return this.matrix.set(r,this.columnIndices[e],t),this}get(r,e){return this.matrix.get(r,this.columnIndices[e])}}class qe extends mt{constructor(r){super(r,r.rows,r.columns)}set(r,e,t){return this.matrix.set(r,this.columns-e-1,t),this}get(r,e){return this.matrix.get(r,this.columns-e-1)}}class Pe extends mt{constructor(r){super(r,r.rows,r.columns)}set(r,e,t){return this.matrix.set(this.rows-r-1,e,t),this}get(r,e){return this.matrix.get(this.rows-r-1,e)}}class Fe extends mt{constructor(r,e){G(r,e),super(r,1,r.columns),this.row=e}set(r,e,t){return this.matrix.set(this.row,e,t),this}get(r,e){return this.matrix.get(this.row,e)}}class De extends mt{constructor(r,e){ft(r,e),super(r,e.length,r.columns),this.rowIndices=e}set(r,e,t){return this.matrix.set(this.rowIndices[r],e,t),this}get(r,e){return this.matrix.get(this.rowIndices[r],e)}}class Pt extends mt{constructor(r,e,t){ft(r,e),kt(r,t),super(r,e.length,t.length),this.rowIndices=e,this.columnIndices=t}set(r,e,t){return this.matrix.set(this.rowIndices[r],this.columnIndices[e],t),this}get(r,e){return this.matrix.get(this.rowIndices[r],this.columnIndices[e])}}class ze extends mt{constructor(r,e,t,s,n){Nt(r,e,t,s,n),super(r,t-e+1,n-s+1),this.startRow=e,this.startColumn=s}set(r,e,t){return this.matrix.set(this.startRow+r,this.startColumn+e,t),this}get(r,e){return this.matrix.get(this.startRow+r,this.startColumn+e)}}class $e extends mt{constructor(r){super(r,r.columns,r.rows)}set(r,e,t){return this.matrix.set(e,r,t),this}get(r,e){return this.matrix.get(e,r)}}class At extends O{constructor(r,e={}){const{rows:t=1}=e;if(r.length%t!==0)throw new Error("the data length is not divisible by the number of rows");super(),this.rows=t,this.columns=r.length/t,this.data=r}set(r,e,t){let s=this._calculateIndex(r,e);return this.data[s]=t,this}get(r,e){let t=this._calculateIndex(r,e);return this.data[t]}_calculateIndex(r,e){return r*this.columns+e}}class nt extends O{constructor(r){super(),this.data=r,this.rows=r.length,this.columns=r[0].length}set(r,e,t){return this.data[r][e]=t,this}get(r,e){return this.data[r][e]}}function Le(o,r){if(a.isAnyArray(o))return o[0]&&a.isAnyArray(o[0])?new nt(o):new At(o,r);throw new Error("the argument is not an array")}class Ft{constructor(r){r=nt.checkMatrix(r);let e=r.clone(),t=e.rows,s=e.columns,n=new Float64Array(t),i=1,l,h,u,m,f,j,k,y,b;for(l=0;l<t;l++)n[l]=l;for(y=new Float64Array(t),h=0;h<s;h++){for(l=0;l<t;l++)y[l]=e.get(l,h);for(l=0;l<t;l++){for(b=Math.min(l,h),f=0,u=0;u<b;u++)f+=e.get(l,u)*y[u];y[l]-=f,e.set(l,h,y[l])}for(m=h,l=h+1;l<t;l++)Math.abs(y[l])>Math.abs(y[m])&&(m=l);if(m!==h){for(u=0;u<s;u++)j=e.get(m,u),e.set(m,u,e.get(h,u)),e.set(h,u,j);k=n[m],n[m]=n[h],n[h]=k,i=-i}if(h<t&&e.get(h,h)!==0)for(l=h+1;l<t;l++)e.set(l,h,e.get(l,h)/e.get(h,h))}this.LU=e,this.pivotVector=n,this.pivotSign=i}isSingular(){let r=this.LU,e=r.columns;for(let t=0;t<e;t++)if(r.get(t,t)===0)return!0;return!1}solve(r){r=I.checkMatrix(r);let e=this.LU;if(e.rows!==r.rows)throw new Error("Invalid matrix dimensions");if(this.isSingular())throw new Error("LU matrix is singular");let s=r.columns,n=r.subMatrixRow(this.pivotVector,0,s-1),i=e.columns,l,h,u;for(u=0;u<i;u++)for(l=u+1;l<i;l++)for(h=0;h<s;h++)n.set(l,h,n.get(l,h)-n.get(u,h)*e.get(l,u));for(u=i-1;u>=0;u--){for(h=0;h<s;h++)n.set(u,h,n.get(u,h)/e.get(u,u));for(l=0;l<u;l++)for(h=0;h<s;h++)n.set(l,h,n.get(l,h)-n.get(u,h)*e.get(l,u))}return n}get determinant(){let r=this.LU;if(!r.isSquare())throw new Error("Matrix must be square");let e=this.pivotSign,t=r.columns;for(let s=0;s<t;s++)e*=r.get(s,s);return e}get lowerTriangularMatrix(){let r=this.LU,e=r.rows,t=r.columns,s=new I(e,t);for(let n=0;n<e;n++)for(let i=0;i<t;i++)n>i?s.set(n,i,r.get(n,i)):n===i?s.set(n,i,1):s.set(n,i,0);return s}get upperTriangularMatrix(){let r=this.LU,e=r.rows,t=r.columns,s=new I(e,t);for(let n=0;n<e;n++)for(let i=0;i<t;i++)n<=i?s.set(n,i,r.get(n,i)):s.set(n,i,0);return s}get pivotPermutationVector(){return Array.from(this.pivotVector)}}function wt(o,r){let e=0;return Math.abs(o)>Math.abs(r)?(e=r/o,Math.abs(o)*Math.sqrt(1+e*e)):r!==0?(e=o/r,Math.abs(r)*Math.sqrt(1+e*e)):0}class _t{constructor(r){r=nt.checkMatrix(r);let e=r.clone(),t=r.rows,s=r.columns,n=new Float64Array(s),i,l,h,u;for(h=0;h<s;h++){let m=0;for(i=h;i<t;i++)m=wt(m,e.get(i,h));if(m!==0){for(e.get(h,h)<0&&(m=-m),i=h;i<t;i++)e.set(i,h,e.get(i,h)/m);for(e.set(h,h,e.get(h,h)+1),l=h+1;l<s;l++){for(u=0,i=h;i<t;i++)u+=e.get(i,h)*e.get(i,l);for(u=-u/e.get(h,h),i=h;i<t;i++)e.set(i,l,e.get(i,l)+u*e.get(i,h))}}n[h]=-m}this.QR=e,this.Rdiag=n}solve(r){r=I.checkMatrix(r);let e=this.QR,t=e.rows;if(r.rows!==t)throw new Error("Matrix row dimensions must agree");if(!this.isFullRank())throw new Error("Matrix is rank deficient");let s=r.columns,n=r.clone(),i=e.columns,l,h,u,m;for(u=0;u<i;u++)for(h=0;h<s;h++){for(m=0,l=u;l<t;l++)m+=e.get(l,u)*n.get(l,h);for(m=-m/e.get(u,u),l=u;l<t;l++)n.set(l,h,n.get(l,h)+m*e.get(l,u))}for(u=i-1;u>=0;u--){for(h=0;h<s;h++)n.set(u,h,n.get(u,h)/this.Rdiag[u]);for(l=0;l<u;l++)for(h=0;h<s;h++)n.set(l,h,n.get(l,h)-n.get(u,h)*e.get(l,u))}return n.subMatrix(0,i-1,0,s-1)}isFullRank(){let r=this.QR.columns;for(let e=0;e<r;e++)if(this.Rdiag[e]===0)return!1;return!0}get upperTriangularMatrix(){let r=this.QR,e=r.columns,t=new I(e,e),s,n;for(s=0;s<e;s++)for(n=0;n<e;n++)s<n?t.set(s,n,r.get(s,n)):s===n?t.set(s,n,this.Rdiag[s]):t.set(s,n,0);return t}get orthogonalMatrix(){let r=this.QR,e=r.rows,t=r.columns,s=new I(e,t),n,i,l,h;for(l=t-1;l>=0;l--){for(n=0;n<e;n++)s.set(n,l,0);for(s.set(l,l,1),i=l;i<t;i++)if(r.get(l,l)!==0){for(h=0,n=l;n<e;n++)h+=r.get(n,l)*s.get(n,i);for(h=-h/r.get(l,l),n=l;n<e;n++)s.set(n,i,s.get(n,i)+h*r.get(n,l))}}return s}}class St{constructor(r,e={}){if(r=nt.checkMatrix(r),r.isEmpty())throw new Error("Matrix must be non-empty");let t=r.rows,s=r.columns;const{computeLeftSingularVectors:n=!0,computeRightSingularVectors:i=!0,autoTranspose:l=!1}=e;let h=!!n,u=!!i,m=!1,f;if(t<s)if(!l)f=r.clone(),console.warn("Computing SVD on a matrix with more columns than rows. Consider enabling autoTranspose");else{f=r.transpose(),t=f.rows,s=f.columns,m=!0;let g=h;h=u,u=g}else f=r.clone();let j=Math.min(t,s),k=Math.min(t+1,s),y=new Float64Array(k),b=new I(t,j),R=new I(s,s),c=new Float64Array(s),v=new Float64Array(t),C=new Float64Array(k);for(let g=0;g<k;g++)C[g]=g;let $=Math.min(t-1,s),L=Math.max(0,Math.min(s-2,t)),X=Math.max($,L);for(let g=0;g<X;g++){if(g<$){y[g]=0;for(let S=g;S<t;S++)y[g]=wt(y[g],f.get(S,g));if(y[g]!==0){f.get(g,g)<0&&(y[g]=-y[g]);for(let S=g;S<t;S++)f.set(S,g,f.get(S,g)/y[g]);f.set(g,g,f.get(g,g)+1)}y[g]=-y[g]}for(let S=g+1;S<s;S++){if(g<$&&y[g]!==0){let x=0;for(let E=g;E<t;E++)x+=f.get(E,g)*f.get(E,S);x=-x/f.get(g,g);for(let E=g;E<t;E++)f.set(E,S,f.get(E,S)+x*f.get(E,g))}c[S]=f.get(g,S)}if(h&&g<$)for(let S=g;S<t;S++)b.set(S,g,f.get(S,g));if(g<L){c[g]=0;for(let S=g+1;S<s;S++)c[g]=wt(c[g],c[S]);if(c[g]!==0){c[g+1]<0&&(c[g]=0-c[g]);for(let S=g+1;S<s;S++)c[S]/=c[g];c[g+1]+=1}if(c[g]=-c[g],g+1<t&&c[g]!==0){for(let S=g+1;S<t;S++)v[S]=0;for(let S=g+1;S<t;S++)for(let x=g+1;x<s;x++)v[S]+=c[x]*f.get(S,x);for(let S=g+1;S<s;S++){let x=-c[S]/c[g+1];for(let E=g+1;E<t;E++)f.set(E,S,f.get(E,S)+x*v[E])}}if(u)for(let S=g+1;S<s;S++)R.set(S,g,c[S])}}let F=Math.min(s,t+1);if($<s&&(y[$]=f.get($,$)),t<F&&(y[F-1]=0),L+1<F&&(c[L]=f.get(L,F-1)),c[F-1]=0,h){for(let g=$;g<j;g++){for(let S=0;S<t;S++)b.set(S,g,0);b.set(g,g,1)}for(let g=$-1;g>=0;g--)if(y[g]!==0){for(let S=g+1;S<j;S++){let x=0;for(let E=g;E<t;E++)x+=b.get(E,g)*b.get(E,S);x=-x/b.get(g,g);for(let E=g;E<t;E++)b.set(E,S,b.get(E,S)+x*b.get(E,g))}for(let S=g;S<t;S++)b.set(S,g,-b.get(S,g));b.set(g,g,1+b.get(g,g));for(let S=0;S<g-1;S++)b.set(S,g,0)}else{for(let S=0;S<t;S++)b.set(S,g,0);b.set(g,g,1)}}if(u)for(let g=s-1;g>=0;g--){if(g<L&&c[g]!==0)for(let S=g+1;S<s;S++){let x=0;for(let E=g+1;E<s;E++)x+=R.get(E,g)*R.get(E,S);x=-x/R.get(g+1,g);for(let E=g+1;E<s;E++)R.set(E,S,R.get(E,S)+x*R.get(E,g))}for(let S=0;S<s;S++)R.set(S,g,0);R.set(g,g,1)}let D=F-1,J=Number.EPSILON;for(;F>0;){let g,S;for(g=F-2;g>=-1&&g!==-1;g--){const x=Number.MIN_VALUE+J*Math.abs(y[g]+Math.abs(y[g+1]));if(Math.abs(c[g])<=x||Number.isNaN(c[g])){c[g]=0;break}}if(g===F-2)S=4;else{let x;for(x=F-1;x>=g&&x!==g;x--){let E=(x!==F?Math.abs(c[x]):0)+(x!==g+1?Math.abs(c[x-1]):0);if(Math.abs(y[x])<=J*E){y[x]=0;break}}x===g?S=3:x===F-1?S=1:(S=2,g=x)}switch(g++,S){case 1:{let x=c[F-2];c[F-2]=0;for(let E=F-2;E>=g;E--){let Z=wt(y[E],x),B=y[E]/Z,Y=x/Z;if(y[E]=Z,E!==g&&(x=-Y*c[E-1],c[E-1]=B*c[E-1]),u)for(let K=0;K<s;K++)Z=B*R.get(K,E)+Y*R.get(K,F-1),R.set(K,F-1,-Y*R.get(K,E)+B*R.get(K,F-1)),R.set(K,E,Z)}break}case 2:{let x=c[g-1];c[g-1]=0;for(let E=g;E<F;E++){let Z=wt(y[E],x),B=y[E]/Z,Y=x/Z;if(y[E]=Z,x=-Y*c[E],c[E]=B*c[E],h)for(let K=0;K<t;K++)Z=B*b.get(K,E)+Y*b.get(K,g-1),b.set(K,g-1,-Y*b.get(K,E)+B*b.get(K,g-1)),b.set(K,E,Z)}break}case 3:{const x=Math.max(Math.abs(y[F-1]),Math.abs(y[F-2]),Math.abs(c[F-2]),Math.abs(y[g]),Math.abs(c[g])),E=y[F-1]/x,Z=y[F-2]/x,B=c[F-2]/x,Y=y[g]/x,K=c[g]/x,tt=((Z+E)*(Z-E)+B*B)/2,lt=E*B*(E*B);let A=0;(tt!==0||lt!==0)&&(tt<0?A=0-Math.sqrt(tt*tt+lt):A=Math.sqrt(tt*tt+lt),A=lt/(tt+A));let ct=(Y+E)*(Y-E)+A,pt=Y*K;for(let _=g;_<F-1;_++){let et=wt(ct,pt);et===0&&(et=Number.MIN_VALUE);let ot=ct/et,it=pt/et;if(_!==g&&(c[_-1]=et),ct=ot*y[_]+it*c[_],c[_]=ot*c[_]-it*y[_],pt=it*y[_+1],y[_+1]=ot*y[_+1],u)for(let H=0;H<s;H++)et=ot*R.get(H,_)+it*R.get(H,_+1),R.set(H,_+1,-it*R.get(H,_)+ot*R.get(H,_+1)),R.set(H,_,et);if(et=wt(ct,pt),et===0&&(et=Number.MIN_VALUE),ot=ct/et,it=pt/et,y[_]=et,ct=ot*c[_]+it*y[_+1],y[_+1]=-it*c[_]+ot*y[_+1],pt=it*c[_+1],c[_+1]=ot*c[_+1],h&&_<t-1)for(let H=0;H<t;H++)et=ot*b.get(H,_)+it*b.get(H,_+1),b.set(H,_+1,-it*b.get(H,_)+ot*b.get(H,_+1)),b.set(H,_,et)}c[F-2]=ct;break}case 4:{if(y[g]<=0&&(y[g]=y[g]<0?-y[g]:0,u))for(let x=0;x<=D;x++)R.set(x,g,-R.get(x,g));for(;g<D&&!(y[g]>=y[g+1]);){let x=y[g];if(y[g]=y[g+1],y[g+1]=x,u&&g<s-1)for(let E=0;E<s;E++)x=R.get(E,g+1),R.set(E,g+1,R.get(E,g)),R.set(E,g,x);if(h&&g<t-1)for(let E=0;E<t;E++)x=b.get(E,g+1),b.set(E,g+1,b.get(E,g)),b.set(E,g,x);g++}F--;break}}}if(m){let g=R;R=b,b=g}this.m=t,this.n=s,this.s=y,this.U=b,this.V=R}solve(r){let e=r,t=this.threshold,s=this.s.length,n=I.zeros(s,s);for(let j=0;j<s;j++)Math.abs(this.s[j])<=t?n.set(j,j,0):n.set(j,j,1/this.s[j]);let i=this.U,l=this.rightSingularVectors,h=l.mmul(n),u=l.rows,m=i.rows,f=I.zeros(u,m);for(let j=0;j<u;j++)for(let k=0;k<m;k++){let y=0;for(let b=0;b<s;b++)y+=h.get(j,b)*i.get(k,b);f.set(j,k,y)}return f.mmul(e)}solveForDiagonal(r){return this.solve(I.diag(r))}inverse(){let r=this.V,e=this.threshold,t=r.rows,s=r.columns,n=new I(t,this.s.length);for(let m=0;m<t;m++)for(let f=0;f<s;f++)Math.abs(this.s[f])>e&&n.set(m,f,r.get(m,f)/this.s[f]);let i=this.U,l=i.rows,h=i.columns,u=new I(t,l);for(let m=0;m<t;m++)for(let f=0;f<l;f++){let j=0;for(let k=0;k<h;k++)j+=n.get(m,k)*i.get(f,k);u.set(m,f,j)}return u}get condition(){return this.s[0]/this.s[Math.min(this.m,this.n)-1]}get norm2(){return this.s[0]}get rank(){let r=Math.max(this.m,this.n)*this.s[0]*Number.EPSILON,e=0,t=this.s;for(let s=0,n=t.length;s<n;s++)t[s]>r&&e++;return e}get diagonal(){return Array.from(this.s)}get threshold(){return Number.EPSILON/2*Math.max(this.m,this.n)*this.s[0]}get leftSingularVectors(){return this.U}get rightSingularVectors(){return this.V}get diagonalMatrix(){return I.diag(this.s)}}function Oe(o,r=!1){return o=nt.checkMatrix(o),r?new St(o).inverse():Ht(o,I.eye(o.rows))}function Ht(o,r,e=!1){return o=nt.checkMatrix(o),r=nt.checkMatrix(r),e?new St(o).solve(r):o.isSquare()?new Ft(o).solve(r):new _t(o).solve(r)}function Dt(o){if(o=I.checkMatrix(o),o.isSquare()){if(o.columns===0)return 1;let r,e,t,s;if(o.columns===2)return r=o.get(0,0),e=o.get(0,1),t=o.get(1,0),s=o.get(1,1),r*s-e*t;if(o.columns===3){let n,i,l;return n=new Pt(o,[1,2],[1,2]),i=new Pt(o,[1,2],[0,2]),l=new Pt(o,[1,2],[0,1]),r=o.get(0,0),e=o.get(0,1),t=o.get(0,2),r*Dt(n)-e*Dt(i)+t*Dt(l)}else return new Ft(o).determinant}else throw Error("determinant can only be calculated for a square matrix")}function Ve(o,r){let e=[];for(let t=0;t<o;t++)t!==r&&e.push(t);return e}function Ue(o,r,e,t=1e-9,s=1e-9){if(o>s)return new Array(r.rows+1).fill(0);{let n=r.addRow(e,[0]);for(let i=0;i<n.rows;i++)Math.abs(n.get(i,0))<t&&n.set(i,0,0);return n.to1DArray()}}function Ge(o,r={}){const{thresholdValue:e=1e-9,thresholdError:t=1e-9}=r;o=I.checkMatrix(o);let s=o.rows,n=new I(s,s);for(let i=0;i<s;i++){let l=I.columnVector(o.getRow(i)),h=o.subMatrixRow(Ve(s,i)).transpose(),m=new St(h).solve(l),f=I.sub(l,h.mmul(m)).abs().max();n.setRow(i,Ue(f,m,i,e,t))}return n}function _e(o,r=Number.EPSILON){if(o=I.checkMatrix(o),o.isEmpty())return o.transpose();let e=new St(o,{autoTranspose:!0}),t=e.leftSingularVectors,s=e.rightSingularVectors,n=e.diagonal;for(let i=0;i<n.length;i++)Math.abs(n[i])>r?n[i]=1/n[i]:n[i]=0;return s.mmul(I.diag(n).mmul(t.transpose()))}function Be(o,r=o,e={}){o=new I(o);let t=!1;if(typeof r=="object"&&!I.isMatrix(r)&&!a.isAnyArray(r)?(e=r,r=o,t=!0):r=new I(r),o.rows!==r.rows)throw new TypeError("Both matrices must have the same number of rows");const{center:s=!0}=e;s&&(o=o.center("column"),t||(r=r.center("column")));const n=o.transpose().mmul(r);for(let i=0;i<n.rows;i++)for(let l=0;l<n.columns;l++)n.set(i,l,n.get(i,l)*(1/(o.rows-1)));return n}function We(o,r=o,e={}){o=new I(o);let t=!1;if(typeof r=="object"&&!I.isMatrix(r)&&!a.isAnyArray(r)?(e=r,r=o,t=!0):r=new I(r),o.rows!==r.rows)throw new TypeError("Both matrices must have the same number of rows");const{center:s=!0,scale:n=!0}=e;s&&(o.center("column"),t||r.center("column")),n&&(o.scale("column"),t||r.scale("column"));const i=o.standardDeviation("column",{unbiased:!0}),l=t?i:r.standardDeviation("column",{unbiased:!0}),h=o.transpose().mmul(r);for(let u=0;u<h.rows;u++)for(let m=0;m<h.columns;m++)h.set(u,m,h.get(u,m)*(1/(i[u]*l[m]))*(1/(o.rows-1)));return h}class te{constructor(r,e={}){const{assumeSymmetric:t=!1}=e;if(r=nt.checkMatrix(r),!r.isSquare())throw new Error("Matrix is not a square matrix");if(r.isEmpty())throw new Error("Matrix must be non-empty");let s=r.columns,n=new I(s,s),i=new Float64Array(s),l=new Float64Array(s),h=r,u,m,f=!1;if(t?f=!0:f=r.isSymmetric(),f){for(u=0;u<s;u++)for(m=0;m<s;m++)n.set(u,m,h.get(u,m));Je(s,l,i,n),Qe(s,l,i,n)}else{let j=new I(s,s),k=new Float64Array(s);for(m=0;m<s;m++)for(u=0;u<s;u++)j.set(u,m,h.get(u,m));Ye(s,j,k,n),Xe(s,l,i,n,j)}this.n=s,this.e=l,this.d=i,this.V=n}get realEigenvalues(){return Array.from(this.d)}get imaginaryEigenvalues(){return Array.from(this.e)}get eigenvectorMatrix(){return this.V}get diagonalMatrix(){let r=this.n,e=this.e,t=this.d,s=new I(r,r),n,i;for(n=0;n<r;n++){for(i=0;i<r;i++)s.set(n,i,0);s.set(n,n,t[n]),e[n]>0?s.set(n,n+1,e[n]):e[n]<0&&s.set(n,n-1,e[n])}return s}}function Je(o,r,e,t){let s,n,i,l,h,u,m,f;for(h=0;h<o;h++)e[h]=t.get(o-1,h);for(l=o-1;l>0;l--){for(f=0,i=0,u=0;u<l;u++)f=f+Math.abs(e[u]);if(f===0)for(r[l]=e[l-1],h=0;h<l;h++)e[h]=t.get(l-1,h),t.set(l,h,0),t.set(h,l,0);else{for(u=0;u<l;u++)e[u]/=f,i+=e[u]*e[u];for(s=e[l-1],n=Math.sqrt(i),s>0&&(n=-n),r[l]=f*n,i=i-s*n,e[l-1]=s-n,h=0;h<l;h++)r[h]=0;for(h=0;h<l;h++){for(s=e[h],t.set(h,l,s),n=r[h]+t.get(h,h)*s,u=h+1;u<=l-1;u++)n+=t.get(u,h)*e[u],r[u]+=t.get(u,h)*s;r[h]=n}for(s=0,h=0;h<l;h++)r[h]/=i,s+=r[h]*e[h];for(m=s/(i+i),h=0;h<l;h++)r[h]-=m*e[h];for(h=0;h<l;h++){for(s=e[h],n=r[h],u=h;u<=l-1;u++)t.set(u,h,t.get(u,h)-(s*r[u]+n*e[u]));e[h]=t.get(l-1,h),t.set(l,h,0)}}e[l]=i}for(l=0;l<o-1;l++){if(t.set(o-1,l,t.get(l,l)),t.set(l,l,1),i=e[l+1],i!==0){for(u=0;u<=l;u++)e[u]=t.get(u,l+1)/i;for(h=0;h<=l;h++){for(n=0,u=0;u<=l;u++)n+=t.get(u,l+1)*t.get(u,h);for(u=0;u<=l;u++)t.set(u,h,t.get(u,h)-n*e[u])}}for(u=0;u<=l;u++)t.set(u,l+1,0)}for(h=0;h<o;h++)e[h]=t.get(o-1,h),t.set(o-1,h,0);t.set(o-1,o-1,1),r[0]=0}function Qe(o,r,e,t){let s,n,i,l,h,u,m,f,j,k,y,b,R,c,v,C;for(i=1;i<o;i++)r[i-1]=r[i];r[o-1]=0;let $=0,L=0,X=Number.EPSILON;for(u=0;u<o;u++){for(L=Math.max(L,Math.abs(e[u])+Math.abs(r[u])),m=u;m<o&&!(Math.abs(r[m])<=X*L);)m++;if(m>u)do{for(s=e[u],f=(e[u+1]-s)/(2*r[u]),j=wt(f,1),f<0&&(j=-j),e[u]=r[u]/(f+j),e[u+1]=r[u]*(f+j),k=e[u+1],n=s-e[u],i=u+2;i<o;i++)e[i]-=n;for($=$+n,f=e[m],y=1,b=y,R=y,c=r[u+1],v=0,C=0,i=m-1;i>=u;i--)for(R=b,b=y,C=v,s=y*r[i],n=y*f,j=wt(f,r[i]),r[i+1]=v*j,v=r[i]/j,y=f/j,f=y*e[i]-v*s,e[i+1]=n+v*(y*s+v*e[i]),h=0;h<o;h++)n=t.get(h,i+1),t.set(h,i+1,v*t.get(h,i)+y*n),t.set(h,i,y*t.get(h,i)-v*n);f=-v*C*R*c*r[u]/k,r[u]=v*f,e[u]=y*f}while(Math.abs(r[u])>X*L);e[u]=e[u]+$,r[u]=0}for(i=0;i<o-1;i++){for(h=i,f=e[i],l=i+1;l<o;l++)e[l]<f&&(h=l,f=e[l]);if(h!==i)for(e[h]=e[i],e[i]=f,l=0;l<o;l++)f=t.get(l,i),t.set(l,i,t.get(l,h)),t.set(l,h,f)}}function Ye(o,r,e,t){let s=0,n=o-1,i,l,h,u,m,f,j;for(f=s+1;f<=n-1;f++){for(j=0,u=f;u<=n;u++)j=j+Math.abs(r.get(u,f-1));if(j!==0){for(h=0,u=n;u>=f;u--)e[u]=r.get(u,f-1)/j,h+=e[u]*e[u];for(l=Math.sqrt(h),e[f]>0&&(l=-l),h=h-e[f]*l,e[f]=e[f]-l,m=f;m<o;m++){for(i=0,u=n;u>=f;u--)i+=e[u]*r.get(u,m);for(i=i/h,u=f;u<=n;u++)r.set(u,m,r.get(u,m)-i*e[u])}for(u=0;u<=n;u++){for(i=0,m=n;m>=f;m--)i+=e[m]*r.get(u,m);for(i=i/h,m=f;m<=n;m++)r.set(u,m,r.get(u,m)-i*e[m])}e[f]=j*e[f],r.set(f,f-1,j*l)}}for(u=0;u<o;u++)for(m=0;m<o;m++)t.set(u,m,u===m?1:0);for(f=n-1;f>=s+1;f--)if(r.get(f,f-1)!==0){for(u=f+1;u<=n;u++)e[u]=r.get(u,f-1);for(m=f;m<=n;m++){for(l=0,u=f;u<=n;u++)l+=e[u]*t.get(u,m);for(l=l/e[f]/r.get(f,f-1),u=f;u<=n;u++)t.set(u,m,t.get(u,m)+l*e[u])}}}function Xe(o,r,e,t,s){let n=o-1,i=0,l=o-1,h=Number.EPSILON,u=0,m=0,f=0,j=0,k=0,y=0,b=0,R=0,c,v,C,$,L,X,F,D,J,g,S,x,E,Z,B;for(c=0;c<o;c++)for((c<i||c>l)&&(e[c]=s.get(c,c),r[c]=0),v=Math.max(c-1,0);v<o;v++)m=m+Math.abs(s.get(c,v));for(;n>=i;){for($=n;$>i&&(y=Math.abs(s.get($-1,$-1))+Math.abs(s.get($,$)),y===0&&(y=m),!(Math.abs(s.get($,$-1))<h*y));)$--;if($===n)s.set(n,n,s.get(n,n)+u),e[n]=s.get(n,n),r[n]=0,n--,R=0;else if($===n-1){if(F=s.get(n,n-1)*s.get(n-1,n),f=(s.get(n-1,n-1)-s.get(n,n))/2,j=f*f+F,b=Math.sqrt(Math.abs(j)),s.set(n,n,s.get(n,n)+u),s.set(n-1,n-1,s.get(n-1,n-1)+u),D=s.get(n,n),j>=0){for(b=f>=0?f+b:f-b,e[n-1]=D+b,e[n]=e[n-1],b!==0&&(e[n]=D-F/b),r[n-1]=0,r[n]=0,D=s.get(n,n-1),y=Math.abs(D)+Math.abs(b),f=D/y,j=b/y,k=Math.sqrt(f*f+j*j),f=f/k,j=j/k,v=n-1;v<o;v++)b=s.get(n-1,v),s.set(n-1,v,j*b+f*s.get(n,v)),s.set(n,v,j*s.get(n,v)-f*b);for(c=0;c<=n;c++)b=s.get(c,n-1),s.set(c,n-1,j*b+f*s.get(c,n)),s.set(c,n,j*s.get(c,n)-f*b);for(c=i;c<=l;c++)b=t.get(c,n-1),t.set(c,n-1,j*b+f*t.get(c,n)),t.set(c,n,j*t.get(c,n)-f*b)}else e[n-1]=D+f,e[n]=D+f,r[n-1]=b,r[n]=-b;n=n-2,R=0}else{if(D=s.get(n,n),J=0,F=0,$<n&&(J=s.get(n-1,n-1),F=s.get(n,n-1)*s.get(n-1,n)),R===10){for(u+=D,c=i;c<=n;c++)s.set(c,c,s.get(c,c)-D);y=Math.abs(s.get(n,n-1))+Math.abs(s.get(n-1,n-2)),D=J=.75*y,F=-.4375*y*y}if(R===30&&(y=(J-D)/2,y=y*y+F,y>0)){for(y=Math.sqrt(y),J<D&&(y=-y),y=D-F/((J-D)/2+y),c=i;c<=n;c++)s.set(c,c,s.get(c,c)-y);u+=y,D=J=F=.964}for(R=R+1,L=n-2;L>=$&&(b=s.get(L,L),k=D-b,y=J-b,f=(k*y-F)/s.get(L+1,L)+s.get(L,L+1),j=s.get(L+1,L+1)-b-k-y,k=s.get(L+2,L+1),y=Math.abs(f)+Math.abs(j)+Math.abs(k),f=f/y,j=j/y,k=k/y,!(L===$||Math.abs(s.get(L,L-1))*(Math.abs(j)+Math.abs(k))<h*(Math.abs(f)*(Math.abs(s.get(L-1,L-1))+Math.abs(b)+Math.abs(s.get(L+1,L+1))))));)L--;for(c=L+2;c<=n;c++)s.set(c,c-2,0),c>L+2&&s.set(c,c-3,0);for(C=L;C<=n-1&&(Z=C!==n-1,C!==L&&(f=s.get(C,C-1),j=s.get(C+1,C-1),k=Z?s.get(C+2,C-1):0,D=Math.abs(f)+Math.abs(j)+Math.abs(k),D!==0&&(f=f/D,j=j/D,k=k/D)),D!==0);C++)if(y=Math.sqrt(f*f+j*j+k*k),f<0&&(y=-y),y!==0){for(C!==L?s.set(C,C-1,-y*D):$!==L&&s.set(C,C-1,-s.get(C,C-1)),f=f+y,D=f/y,J=j/y,b=k/y,j=j/f,k=k/f,v=C;v<o;v++)f=s.get(C,v)+j*s.get(C+1,v),Z&&(f=f+k*s.get(C+2,v),s.set(C+2,v,s.get(C+2,v)-f*b)),s.set(C,v,s.get(C,v)-f*D),s.set(C+1,v,s.get(C+1,v)-f*J);for(c=0;c<=Math.min(n,C+3);c++)f=D*s.get(c,C)+J*s.get(c,C+1),Z&&(f=f+b*s.get(c,C+2),s.set(c,C+2,s.get(c,C+2)-f*k)),s.set(c,C,s.get(c,C)-f),s.set(c,C+1,s.get(c,C+1)-f*j);for(c=i;c<=l;c++)f=D*t.get(c,C)+J*t.get(c,C+1),Z&&(f=f+b*t.get(c,C+2),t.set(c,C+2,t.get(c,C+2)-f*k)),t.set(c,C,t.get(c,C)-f),t.set(c,C+1,t.get(c,C+1)-f*j)}}}if(m!==0){for(n=o-1;n>=0;n--)if(f=e[n],j=r[n],j===0)for($=n,s.set(n,n,1),c=n-1;c>=0;c--){for(F=s.get(c,c)-f,k=0,v=$;v<=n;v++)k=k+s.get(c,v)*s.get(v,n);if(r[c]<0)b=F,y=k;else if($=c,r[c]===0?s.set(c,n,F!==0?-k/F:-k/(h*m)):(D=s.get(c,c+1),J=s.get(c+1,c),j=(e[c]-f)*(e[c]-f)+r[c]*r[c],X=(D*y-b*k)/j,s.set(c,n,X),s.set(c+1,n,Math.abs(D)>Math.abs(b)?(-k-F*X)/D:(-y-J*X)/b)),X=Math.abs(s.get(c,n)),h*X*X>1)for(v=c;v<=n;v++)s.set(v,n,s.get(v,n)/X)}else if(j<0)for($=n-1,Math.abs(s.get(n,n-1))>Math.abs(s.get(n-1,n))?(s.set(n-1,n-1,j/s.get(n,n-1)),s.set(n-1,n,-(s.get(n,n)-f)/s.get(n,n-1))):(B=zt(0,-s.get(n-1,n),s.get(n-1,n-1)-f,j),s.set(n-1,n-1,B[0]),s.set(n-1,n,B[1])),s.set(n,n-1,0),s.set(n,n,1),c=n-2;c>=0;c--){for(g=0,S=0,v=$;v<=n;v++)g=g+s.get(c,v)*s.get(v,n-1),S=S+s.get(c,v)*s.get(v,n);if(F=s.get(c,c)-f,r[c]<0)b=F,k=g,y=S;else if($=c,r[c]===0?(B=zt(-g,-S,F,j),s.set(c,n-1,B[0]),s.set(c,n,B[1])):(D=s.get(c,c+1),J=s.get(c+1,c),x=(e[c]-f)*(e[c]-f)+r[c]*r[c]-j*j,E=(e[c]-f)*2*j,x===0&&E===0&&(x=h*m*(Math.abs(F)+Math.abs(j)+Math.abs(D)+Math.abs(J)+Math.abs(b))),B=zt(D*k-b*g+j*S,D*y-b*S-j*g,x,E),s.set(c,n-1,B[0]),s.set(c,n,B[1]),Math.abs(D)>Math.abs(b)+Math.abs(j)?(s.set(c+1,n-1,(-g-F*s.get(c,n-1)+j*s.get(c,n))/D),s.set(c+1,n,(-S-F*s.get(c,n)-j*s.get(c,n-1))/D)):(B=zt(-k-J*s.get(c,n-1),-y-J*s.get(c,n),b,j),s.set(c+1,n-1,B[0]),s.set(c+1,n,B[1]))),X=Math.max(Math.abs(s.get(c,n-1)),Math.abs(s.get(c,n))),h*X*X>1)for(v=c;v<=n;v++)s.set(v,n-1,s.get(v,n-1)/X),s.set(v,n,s.get(v,n)/X)}for(c=0;c<o;c++)if(c<i||c>l)for(v=c;v<o;v++)t.set(c,v,s.get(c,v));for(v=o-1;v>=i;v--)for(c=i;c<=l;c++){for(b=0,C=i;C<=Math.min(v,l);C++)b=b+t.get(c,C)*s.get(C,v);t.set(c,v,b)}}}function zt(o,r,e,t){let s,n;return Math.abs(e)>Math.abs(t)?(s=t/e,n=e+s*t,[(o+s*r)/n,(r-s*o)/n]):(s=e/t,n=t+s*e,[(s*o+r)/n,(s*r-o)/n])}class ee{constructor(r){if(r=nt.checkMatrix(r),!r.isSymmetric())throw new Error("Matrix is not symmetric");let e=r,t=e.rows,s=new I(t,t),n=!0,i,l,h;for(l=0;l<t;l++){let u=0;for(h=0;h<l;h++){let m=0;for(i=0;i<h;i++)m+=s.get(h,i)*s.get(l,i);m=(e.get(l,h)-m)/s.get(h,h),s.set(l,h,m),u=u+m*m}for(u=e.get(l,l)-u,n&&(n=u>0),s.set(l,l,Math.sqrt(Math.max(u,0))),h=l+1;h<t;h++)s.set(l,h,0)}this.L=s,this.positiveDefinite=n}isPositiveDefinite(){return this.positiveDefinite}solve(r){r=nt.checkMatrix(r);let e=this.L,t=e.rows;if(r.rows!==t)throw new Error("Matrix dimensions do not match");if(this.isPositiveDefinite()===!1)throw new Error("Matrix is not positive definite");let s=r.columns,n=r.clone(),i,l,h;for(h=0;h<t;h++)for(l=0;l<s;l++){for(i=0;i<h;i++)n.set(h,l,n.get(h,l)-n.get(i,l)*e.get(h,i));n.set(h,l,n.get(h,l)/e.get(h,h))}for(h=t-1;h>=0;h--)for(l=0;l<s;l++){for(i=h+1;i<t;i++)n.set(h,l,n.get(h,l)-n.get(i,l)*e.get(i,h));n.set(h,l,n.get(h,l)/e.get(h,h))}return n}get lowerTriangularMatrix(){return this.L}}class se{constructor(r,e={}){r=nt.checkMatrix(r);let{Y:t}=e;const{scaleScores:s=!1,maxIterations:n=1e3,terminationCriteria:i=1e-10}=e;let l;if(t){if(a.isAnyArray(t)&&typeof t[0]=="number"?t=I.columnVector(t):t=nt.checkMatrix(t),t.rows!==r.rows)throw new Error("Y should have the same number of rows as X");l=t.getColumnVector(0)}else l=r.getColumnVector(0);let h=1,u,m,f,j;for(let k=0;k<n&&h>i;k++)f=r.transpose().mmul(l).div(l.transpose().mmul(l).get(0,0)),f=f.div(f.norm()),u=r.mmul(f).div(f.transpose().mmul(f).get(0,0)),k>0&&(h=u.clone().sub(j).pow(2).sum()),j=u.clone(),t?(m=t.transpose().mmul(u).div(u.transpose().mmul(u).get(0,0)),m=m.div(m.norm()),l=t.mmul(m).div(m.transpose().mmul(m).get(0,0))):l=u;if(t){let k=r.transpose().mmul(u).div(u.transpose().mmul(u).get(0,0));k=k.div(k.norm());let y=r.clone().sub(u.clone().mmul(k.transpose())),b=l.transpose().mmul(u).div(u.transpose().mmul(u).get(0,0)),R=t.clone().sub(u.clone().mulS(b.get(0,0)).mmul(m.transpose()));this.t=u,this.p=k.transpose(),this.w=f.transpose(),this.q=m,this.u=l,this.s=u.transpose().mmul(u),this.xResidual=y,this.yResidual=R,this.betas=b}else this.w=f.transpose(),this.s=u.transpose().mmul(u).sqrt(),s?this.t=u.clone().div(this.s.get(0,0)):this.t=u,this.xResidual=r.sub(u.mmul(f.transpose()))}}return V.AbstractMatrix=O,V.CHO=ee,V.CholeskyDecomposition=ee,V.DistanceMatrix=qt,V.EVD=te,V.EigenvalueDecomposition=te,V.LU=Ft,V.LuDecomposition=Ft,V.Matrix=I,V.MatrixColumnSelectionView=Te,V.MatrixColumnView=Ce,V.MatrixFlipColumnView=qe,V.MatrixFlipRowView=Pe,V.MatrixRowSelectionView=De,V.MatrixRowView=Fe,V.MatrixSelectionView=Pt,V.MatrixSubView=ze,V.MatrixTransposeView=$e,V.NIPALS=se,V.Nipals=se,V.QR=_t,V.QrDecomposition=_t,V.SVD=St,V.SingularValueDecomposition=St,V.SymmetricMatrix=jt,V.WrapperMatrix1D=At,V.WrapperMatrix2D=nt,V.correlation=We,V.covariance=Be,V.default=I,V.determinant=Dt,V.inverse=Oe,V.linearDependencies=Ge,V.pseudoInverse=_e,V.solve=Ht,V.wrap=Le,V}var Xt=Fs();const ie=us(Xt),Mt=Xt.Matrix;ie.Matrix?ie.Matrix:Xt.Matrix;const le=8,Ds=1/16777216,zs=15,$s=18,Ls=11;function Os(a,w){a>>>=0,w>>>=0;const p=a&65535;return((a-p)*w>>>0)+p*w>>>0}class Vs{constructor(w=Date.now()){this.state=new Uint32Array(4),this.init(w),this.random=this.getFloat.bind(this)}getUint32(){return this.nextState(),this.state[3]+this.state[2]>>>0}getFloat(){return(this.getUint32()>>>8)*Ds}init(w){if(!Number.isInteger(w))throw new TypeError("seed must be an integer");this.state[0]=w,this.state[1]=0,this.state[2]=0,this.state[3]=0;for(let p=1;p<le;p++)this.state[p&3]^=p+Os(1812433253,this.state[p-1&3]^this.state[p-1&3]>>>30>>>0)>>>0;this.periodCertification();for(let p=0;p<le;p++)this.nextState()}periodCertification(){this.state[0]===0&&this.state[1]===0&&this.state[2]===0&&this.state[3]===0&&(this.state[0]=88,this.state[1]=83,this.state[2]=65,this.state[3]=68)}nextState(){let w=this.state[0];w^=w<<zs,w^=w>>>$s,w^=this.state[3]<<Ls,this.state[0]=this.state[1],this.state[1]=this.state[2],this.state[2]=this.state[3],this.state[3]=w}}const Us=1e-8;function he(a,w={},p=Math.random){const{size:d=1,replace:M=!1,probabilities:q}=w;let T,N;if(typeof a=="number"?T=Gs(a):T=a.slice(),q){if(!M)throw new Error("choice with probabilities and no replacement is not implemented");if(q.length!==T.length)throw new Error("the length of probabilities option should be equal to the number of choices");N=[q[0]];for(let U=1;U<q.length;U++)N[U]=N[U-1]+q[U];if(Math.abs(1-N[N.length-1])>Us)throw new Error(`probabilities should sum to 1, but instead sums to ${N[N.length-1]}`)}if(M===!1&&d>T.length)throw new Error("size option is too large");const z=[];for(let U=0;U<d;U++){const G=_s(T.length,p,N);z.push(T[G]),M||T.splice(G,1)}return z}function Gs(a){const w=[];for(let p=0;p<a;p++)w.push(p);return w}function _s(a,w,p){const d=w();if(p){let M=0;for(;d>p[M];)M++;return M}else return Math.floor(d*a)}class Zt{constructor(w=Math.random){if(typeof w=="number"){const p=new Vs(w);this.randomGenerator=p.random}else this.randomGenerator=w}choice(w,p){return typeof w=="number"?he(w,p,this.randomGenerator):he(w,p,this.randomGenerator)}random(){return this.randomGenerator()}randInt(w,p){return p===void 0&&(p=w,w=0),w+Math.floor(this.randomGenerator()*(p-w))}randomSample(w){const p=[];for(let d=0;d<w;d++)p.push(this.random());return p}}function Bs(a,w,p){return new Zt(p).choice(a,{size:w})}function Ws(a,w,p,d){const M=new Zt(d);let q=new Array(w);q[0]=Math.floor(M.random()*a.length);{let T={dist:-1,index:-1};for(let N=0;N<a.length;++N)p[q[0]][N]>T.dist&&(T.dist=p[q[0]][N],T.index=N);q[1]=T.index;for(let N=2;N<w;++N){let z={dist:-1,index:-1};for(let U=0;U<a.length;++U){let G={dist:Number.MAX_VALUE,index:-1};for(let Q=0;Q<N;++Q)p[Q][U]<G.dist&&!q.includes(U)&&(G={dist:p[Q][U],index:U});G.dist!==Number.MAX_VALUE&&G.dist>z.dist&&(z={...G})}q[N]=z.index}}return q.map(T=>a[T])}function Js(a,w,p={}){const d=new Mt(a),M=d.rows,q=new Zt(p.seed),T=[],N=p.localTrials||2+Math.floor(Math.log(w)),z=q.randInt(M);T.push(d.getRow(z));let U=new Mt(1,d.rows);for(let W=0;W<d.rows;W++)U.set(0,W,Gt(d.getRow(W),T[0]));let G=[ue(U.getRow(0))];const Q=1/G[0][M-1];let st=Mt.mul(U,Q);for(let W=1;W<w;W++){const ft=q.choice(M,{replace:!0,size:N,probabilities:st.getRow(0)}),kt=d.selection(ft,Ys(d.columns)),Nt=Qs(kt,d);let dt=1/0,yt=1/0,gt=U;for(let bt=0;bt<N;bt++){const Ct=Mt.min(U,[Nt.getRow(bt)]),Tt=Ct.sum();Tt<yt&&(dt=ft[bt],yt=Tt,gt=Ct)}T[W]=d.getRow(dt),U=gt,G=[ue(U.getRow(0))],st=Mt.mul(U,1/G[0][M-1])}return T}function Qs(a,w){const p=new Mt(a.rows,w.rows);for(let d=0;d<a.rows;d++)for(let M=0;M<w.rows;M++)p.set(d,M,Gt(a.getRow(d),w.getRow(M)));return p}function Ys(a){let w=[];for(let p=0;p<a;p++)w.push(p);return w}function ue(a){let w=[a[0]];for(let p=1;p<a.length;p++)w[p]=w[p-1]+a[p];return w}const Xs={maxIterations:100,tolerance:1e-6,initialization:"kmeans++",distanceFunction:Gt};function Zs(a,w,p,d,M,q){p=ge(w,a,p,M.distanceFunction);let T=Ss(a,w,p,d),N=Ms(T,a,M.distanceFunction,M.tolerance);return new Es(p,T,N,q,M.distanceFunction)}function Ks(a,w,p){const d=Hs(p);ks(a,w);let M=As(a,w,d);d.maxIterations===0&&(d.maxIterations=Number.MAX_VALUE);let q=new Array(a.length),T=!1,N=0,z;for(;!T&&N<d.maxIterations;)z=Zs(M,a,q,w,d,++N),T=z.converged,M=z.centroids;if(!z)throw new Error("unreachable: no kmeans step executed");return z}function As(a,w,p){let d;if(Array.isArray(p.initialization)){if(p.initialization.length!==w)throw new Error("The initial centers should have the same length as K");d=p.initialization}else switch(p.initialization){case"kmeans++":d=Js(a,w,p);break;case"random":d=Bs(a,w,p.seed);break;case"mostDistant":d=Ws(a,w,bs(a,p.distanceFunction),p.seed);break;default:vs(p.initialization,"Unknown initialization method")}return d}function Hs(a){return{...Xs,...a}}function tr([a,w,p]){return`#${(1<<24|a<<16|w<<8|p).toString(16).slice(1).toUpperCase()}`}function er(a){return Ks(a,4,{}).centroids.map(tr)}function sr(a){return new Promise((w,p)=>{const d=document.createElement("canvas"),M=new Image;M.src=a,M.onload=()=>{d.width=M.width,d.height=M.height;const q=d.getContext("2d",{willReadFrequently:!0});if(!q)return p("Could not get canvas context");q.drawImage(M,0,0,M.width,M.height);const T=q.getImageData(0,0,M.width,M.height).data,N=[];for(let U=0;U<T.length;U+=4){const G=T[U],Q=T[U+1],st=T[U+2];N.push([G,Q,st])}const z=er(N);w(z)},M.onerror=()=>p("Failed to load image")})}function rr(){const{loading:a,preview:w,palette:p,image:d,isGenerating:M,fileInputRef:q,setIsGenerating:T,setPalette:N,setInitialState:z}=Ut(),{onChangeAction:U}=vt(),G=()=>{var W;(W=q.current)==null||W.click()},Q=async()=>{try{if(T(!0),!w)throw new Error("Image has not loaded!");const W=await sr(w);N(W),T(!1)}catch(W){console.error(W)}},st=()=>{T(!0);const W=localStorage.getItem("saved_palettes");let ft=W?JSON.parse(W):[];localStorage.setItem("saved_palettes",JSON.stringify([...ft,{name:d==null?void 0:d.name,palette:p}])),setTimeout(()=>{z(),U(Vt.SAVELIST)},500)};return M?null:P.jsxs("div",{className:"flex flex-col gap-5 justify-center",children:[!p&&!d&&P.jsx(at,{className:"!text-gray-500 text-center",children:"Upload a photo to generate its palette"}),P.jsxs("div",{className:"flex items-center justify-center gap-2",children:[d&&!p&&P.jsx(Et,{className:"rounded-full bg-purple-500 !py-[0.5rem]",icon:fe,onClick:Q,disabled:a,children:P.jsx(at,{children:"Generate"})}),p&&P.jsx(Et,{className:"rounded-full bg-purple-500 !py-[0.5rem]",icon:hs,onClick:st,children:P.jsx(at,{children:"Save"})}),P.jsx(Et,{className:"rounded-full bg-purple-500 !py-[0.5rem]",icon:ys,onClick:G,children:P.jsx(at,{children:d?"Replace":"Upload"})})]})]})}function nr(){return P.jsxs(ms,{children:[P.jsx(ws,{}),P.jsx(ds,{}),P.jsx(ps,{}),P.jsx(rr,{})]})}function or(){const{onChangeAction:a}=vt(),[w,p]=ut.useState([]);return ut.useEffect(()=>{const d=localStorage.getItem("saved_palettes");d&&p(JSON.parse(d))},[]),P.jsxs("div",{className:"h-full w-full flex flex-wrap py-[2rem]",children:[w.length<1&&P.jsxs("div",{className:"flex flex-col items-center gap-5 w-full",children:[P.jsx(at,{className:"text-center align-self-center justify-self-center h-fit !text-gray-500",children:"No Saved Palettes"}),P.jsx(Et,{className:"rounded-full bg-purple-500 !py-[0.5rem]",icon:fe,onClick:()=>a(Vt.GENERATE),children:P.jsx(at,{children:"Generate Palette"})})]}),w.map(d=>P.jsxs("div",{className:"flex flex-col items-center justify-center h-fit w-1/2 p-[1rem] cursor-pointer",children:[P.jsx(xt,{className:"h-10 w-10 mb-10 cursorpointer",colorPaths:d.palette}),P.jsx(at,{className:"w-full !text-gray-500 truncate text-ellipsis",children:d.name})]},JSON.stringify(d.palette)))]})}function hr(){const{action:a}=vt(),w=()=>{if(a===Vt.GENERATE)return P.jsx(nr,{});if(a===Vt.SAVELIST)return P.jsx(or,{})};return P.jsxs(gs,{children:[P.jsx(cs,{}),P.jsx(as,{children:w()})]})}export{hr as default};
